!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){var n,r=t("ractive"),i=t("./fetcher"),o=t("./store"),s=t("./dropbox"),a=(t("./ractivedrop"),t("./spotify")),u={r:{},nots:[],init:function(){u.r=new r({el:"notificationsc",template:"#notifications",data:{nots:u.nots}}),console.log("nots init")},add:function(t,e){u.nots.push({msg:t,type:e}),window.setTimeout(function(){u.nots.splice(0,1)},3e3)}},l={rmenu:{},set:function(){l.rmenu=new r({el:"menu",template:"#menutpl",data:{active:"",loading:!1}}),l.rmenu.on("filedrop",function(t){console.log(t.contents);var e=t.contents,r=e.substring(e.lastIndexOf("/")+1);a.lookup("spotify:artist:"+r).then(function(t){console.log(t),n.addNews(t.artist)}).fail(function(t){console.log(t)})})}};n={rnews:{},setNews:function(){n.rnews=new r({el:"main",template:"#news",data:{news:[],newsImgs:[],findings:[]}}),n.rnews.on({add:function(){o.addNews(n.rnews.get("addnews")).then(function(){u.add("Added "+n.rnews.get("addnews"),"info"),n.rnews.set("addnews","")}).fail(function(t){console.log(t),u.add(t.message,"error")})},rm:function(t){t.original.preventDefault();var e=t.node.getAttribute("data-index");console.log("rm at "+e),o.rmNews(e),u.add("Removed","info")}}),console.log("setNews complete")},populate:function(){console.log("start pop news"),l.rmenu.set("loading",!0),n.rnews.set("news",o.data.news),i.populateNews(o.data.news,o.data.ignoreReleaseList,function(){n.rnews.set("newsImgs",i.artistNewsModel.imgs),n.rnews.set("findings",i.artistNewsModel.artistNewsFindings),l.rmenu.set("loading",!1),console.log("pop news")})},addNews:function(t){o.addNews(t).then(function(){u.add("Added "+t,"info")}).fail(function(t){console.log(t),u.add(t.message,"error")})}};var h={ralbums:{},setAA:function(){h.ralbums=new r({el:"main",template:"#albums",data:{albums:o.data.artistAlbums,albumImgs:i.artistAlbumModel.imgs,findings:i.artistAlbumModel.artistAlbumsFindings}}),h.ralbums.on({add:function(){o.addArtistAlbum(h.ralbums.get("addartist"),h.ralbums.get("addalbum")).then(function(){u.add("Added "+n.rnews.get("addnews")+" - "+n.rnews.get("addalbum"),"info"),h.ralbums.set("addartist",""),h.ralbums.set("addalbum","")}).fail(function(t){console.log(t)})},rm:function(t){t.original.preventDefault();var e=t.node.getAttribute("data-index");console.log("rm at "+e),u.add("Removed","info"),o.rmAristAlbum(e)}}),console.log("setAA complete")},populate:function(){console.log("start pop AA"),l.rmenu.set("loading",!0),h.ralbums.set("albums",o.data.artistAlbums),i.populateArtistAlbums(o.data.artistAlbums,function(){h.ralbums.set("albumImgs",i.artistAlbumModel.imgs),h.ralbums.set("findings",i.artistAlbumModel.artistAlbumsFindings),l.rmenu.set("loading",!1),console.log("pop ralbums")})}},c={rlfm:{},setLastFM:function(){c.rlfm=new r({el:"main",template:"#lfm",data:{albumsOn:[],albumsSuggs:[],lastfmusername:""}}),c.rlfm.on("setlfmun",function(){console.log(c.rlfm.get("lastfmusername"))}),c.rlfm.on("addAA",function(t){t.original.preventDefault(),console.log("add",t.node.getAttribute("data-artist"),t.node.getAttribute("data-album"))})},populate:function(){l.rmenu.set("loading",!0),i.getSuggsOnSpot("saerdnakire").then(function(t){c.rlfm.set("albumsOn",t.onspot),c.rlfm.set("albumsSuggs",t.suggs),l.rmenu.set("loading",!1)}).fail(function(t){console.log(t)})}},f={rs:{},set:function(){f.rs=new r({el:"main",template:"#settings",data:{exportdata:JSON.stringify(o.data),importdata:"",conBtnTxt:s.isAuth()?"Connected":"Connect"}}),f.rs.on({connect:function(){s.sendAuth()},importData:function(){console.log(f.rs.get("importdata"))},dragExport:function(t){t.node.focus(),t.node.select(),t.node.draggable=!0,t.node.addEventListener("dragstart",function(e){var n=o.dformat();e.dataTransfer.setData("DownloadURL","text/plain; charset=UTF-8:WatchList.backup."+n+".txt:data:image/png;base64,"+btoa(window.unescape(encodeURIComponent(t.node.value))))})},filedrop:function(t){f.rs.set("importdata",t.contents)}})}};e.exports.nc=n,e.exports.aac=h,e.exports.lfmc=c,e.exports.sc=f,e.exports.notc=u,e.exports.mc=l},{"./dropbox":2,"./fetcher":3,"./ractivedrop":6,"./spotify":7,"./store":8,ractive:17}],2:[function(t,e){var n,r,i=t("./vendor/dropbox-datastores-1.0-latest"),o=new i.Client({key:"u76dx4vjx6bke01"}),s=t("q"),a={sendAuth:function(){o.authenticate()},authenticate:function(t){var e=s.defer();return o.authenticate({interactive:!1},function(t){t?e.reject(t):e.resolve()}),e.promise.nodeify(t)},getTable:function(){var t=s.defer();return n?(console.log("already got it"),t.resolve(n)):(console.log("will open"),a.getDS().then(function(e){n=e.getTable("swl"),t.resolve(n)}).fail(function(e){t.reject(e)})),t.promise},getDS:function(){var t=s.defer();if(r)t.resolve(r);else{console.log("try open ds");var e=o.getDatastoreManager();e.openDefaultDatastore(function(e,n){e?(console.error("ds fail",e),t.reject(e)):(console.log("ds open"),r=n,t.resolve(r))})}return t.promise},isAuth:function(){return o.isAuthenticated()},get:function(){return a.getTable().then(function(t){var e=t.getOrInsert("1",{data:'{"news":[],"artistAlbums":[],"ignoreReleaseList":[],"updatedAt":{}}'}),n=JSON.parse(e.get("data"));return console.log("get dropbox"),n})},set:function(t){return a.getTable().then(function(e){var n=e.get("1");n.set("data",t),console.log("set dropbox")})},addListener:function(t){a.getDS().then(function(e){e.recordsChanged.addListener(t),console.log("dbx listener added")})}};e.exports=a},{"./vendor/dropbox-datastores-1.0-latest":9,q:16}],3:[function(t,e){var n=t("./spotify"),r=t("./lastfm"),i=t("q"),o={artistNewsModel:{imgs:[],artistNewsFindings:[]},artistAlbumModel:{imgs:[],artistAlbumsFindings:[]},populateNews:function(t,e,i){var s=t.length,a=0;o.artistNewsModel.imgs=[],o.artistNewsModel.artistNewsFindings=[];for(var u=0;u<t.length;u++)n.searchNews(t[u].artist,e,u).then(function(t){if(t.findings&&t.findings.length>0){o.artistNewsModel.imgs[t.ref]="img/spotify32bw.png";for(var e=0;e<t.findings.length;e++)e>0&&s++,console.log("will push",t.findings),o.artistNewsModel.artistNewsFindings.push(t.findings[e]),console.log("pushed"),r.albumCover("00198b31b392d0750f88819830e49680",t.findings[e].artist,t.findings[e].album,o.artistNewsModel.artistNewsFindings.length).then(function(t){t.img&&t.img.length>0&&(o.artistNewsModel.artistNewsFindings[t.ref-1].img=t.img),a++,console.log(a,s),s===a&&i()}).fail(function(t){console.log("lfm",t)})}else o.artistNewsModel.imgs[t.ref]="img/delete-32.png",a++,s===a&&i()}).fail(function(t){console.error(t)})},populateArtistAlbums:function(t,e){var i=t.length,s=0;o.artistAlbumModel.imgs=[],o.artistAlbumModel.artistAlbumsFindings=[];for(var a=0;a<t.length;a++)n.searchArtistAlbum(t[a],a).then(function(t){if(t.findings&&t.findings.length>0){o.artistAlbumModel.imgs[t.ref]="img/spotify32bw.png";for(var n=0;n<t.findings.length;n++)n>0&&i++,o.artistAlbumModel.artistAlbumsFindings.push(t.findings[n]),r.albumCover("00198b31b392d0750f88819830e49680",t.findings[n].artist,t.findings[n].album,o.artistAlbumModel.artistAlbumsFindings.length).then(function(t){t.img&&t.img.length>0&&(o.artistAlbumModel.artistAlbumsFindings[t.ref-1].img=t.img),s++,i===s&&e()})}else o.artistAlbumModel.imgs[t.ref]="img/delete-32.png",s++,i===s&&e()}).fail(function(t){console.error(t)})},getSuggsOnSpot:function(t,e){var o=r.getNews(t,"00198b31b392d0750f88819830e49680").then(function(t){for(var e=[],r=[],o=function(t){var n=t.findings,i=t.artistAlbum;if(n.length>0)for(var o=0;o<n.length;o++)e.push({artist:n[o].artist,album:n[o].album,href:n[o].href,img:n[o].img});else r.push({artist:i.artist,album:i.album,img:i.img})},s=[],a=0;a<t.length;a++)s.push(n.searchArtistAlbum({artist:t[a].artist,album:t[a].album,img:t[a].image}));return i.all(s).then(function(t){for(var n=0;n<t.length;n++)o(t[n]);return{suggs:r,onspot:e}})});return o.nodeify(e)}};e.exports=o},{"./lastfm":5,"./spotify":7,q:16}],4:[function(t){function e(t,e){if(console.log(t,e),t){var r=t.affectedRecordsForTable("swl");console.log(t.isLocal(),r),n.getData()}else e===n.events.STORE?("#/albums"===window.location.hash?i.aac.populate():"#/news"===window.location.hash?i.nc.populate():"#/"===window.location.hash?i.lfmc.populate():"#/settings"===window.location.hash&&i.sc.set(),console.log("has changed populated")):e===n.events.ALBUM_ADDED||e===n.events.ALBUM_REMOVED?(i.aac.setAA(),i.aac.populate()):(e===n.events.NEWS_ADDED||e===n.events.NEWS_REMOVED)&&(i.nc.setNews(),i.nc.populate())}var n=(t("ractive"),t("./fetcher"),t("./store")),r=t("./vendor/routie"),i=t("./controller");n.auth().then(function(){console.log("authed")}).fail(function(t){console.log("auth fail",t)}),n.getData().then(function(){n.setRemoteChangedListener(e),console.log("index done getData")}),n.setStoreChangedListener(e),i.mc.set(),i.notc.init(),r({"/albums":function(){console.log("route: albums"),i.aac.setAA(),i.aac.populate(),i.mc.rmenu.set("active","albums")},"/news":function(){console.log("route: news"),i.nc.setNews(),i.nc.populate(),i.mc.rmenu.set("active","news")},"/settings":function(){console.log("route: settings"),i.sc.set(),i.mc.rmenu.set("active","settings")},"*":function(){console.log("route: *"),i.lfmc.setLastFM(),i.lfmc.populate(),i.mc.rmenu.set("active","/")}})},{"./controller":1,"./fetcher":3,"./store":8,"./vendor/routie":10,ractive:17}],5:[function(t,e){function n(t,e){this.message=t,this.error=e}var r=t("superagent"),i=t("q");n.prototype=new Error;var o={rejectResolve:function(t,e,r){t?r.reject(t):e.error?r.reject(e.error):e.body.error?r.reject(new n(e.body.message,e.body.error)):r.resolve(e.body)},getNews:function(t,e,n){var s=i.defer();r.get("https://ws.audioscrobbler.com/2.0/?method=user.getnewreleases&format=json&userecs=0&user="+t+"&api_key="+e,function(t,e){o.rejectResolve(t,e,s)});var a=i.defer();r.get("https://ws.audioscrobbler.com/2.0/?method=user.getnewreleases&format=json&userecs=1&user="+t+"&api_key="+e,function(t,e){o.rejectResolve(t,e,a)});var u=i.all([s.promise,a.promise]).then(function(t){for(var e=[],n=0;n<t.length;n++)for(var r=0;t[n].albums&&t[n].albums.album&&r<t[n].albums.album.length;r++)e.push({artist:t[n].albums.album[r].artist.name,album:t[n].albums.album[r].name,image:t[n].albums.album[r].image[2]["#text"]});return e});return u.nodeify(n)},albumCover:function(t,e,o,s,a){var u=i.defer();return r.get("//ws.audioscrobbler.com/2.0/?method=album.getInfo&format=json&artist="+e.replace(/&/g,"%26")+"&album="+o.replace(/&/g,"%26")+"&api_key="+t,function(t,e){if(t)u.reject(t);else if(e.error)u.reject(e.error);else if(e.body.error)u.reject(new n(e.body.message,e.body.error));else{var r={};r=e.body.album&&e.body.album.image[2]["#text"].length>0?e.body.album.image[2]["#text"]:"img/vinyl.png",u.resolve({img:r,ref:s})}}),u.promise.nodeify(a)}};e.exports=o},{q:16,superagent:18}],6:[function(t,e){var n=t("ractive");n.events.filedrop=function(t,e){function n(t){t.preventDefault(),t.stopPropagation()}function r(n){n.preventDefault(),n.stopPropagation(),console.log("drop");var r=n.dataTransfer.files,i=r[0];if(i){console.log("filename",i.name);var o=new FileReader;o.onload=function(n){var r=n.target.result;e({node:t,contents:r})},o.onerror=function(t){console.log(t)},o.readAsText(i)}else e({node:t,contents:n.dataTransfer.getData("text/uri-list")})}return t.addEventListener("dragenter",n),t.addEventListener("dragover",n),t.addEventListener("drop",r),{teardown:function(){t.removeEventListener("dragenter",n),t.removeEventListener("dragover",n),t.removeEventListener("drop",r)}}},e.exports.filedrop=n.events.filedrop},{ractive:17}],7:[function(t,e){var n=t("superagent"),r=t("q"),i={userCountry:"SE",searchNews:function(t,e,o,s){var a=r.defer();return n.get("http://ws.spotify.com/search/1/album.json?q=tag:new%20AND%20artist:%22"+t.replace(/&/g,"%26")+"%22",function(n,r){if(n)a.reject(n);else if(r.error)a.reject(r.error);else{var s=r.body,u=[];if(s.info.num_results>0)for(var l=0;l<s.albums.length;l++)s.albums[l].artists[0].name.toLowerCase()===t.toLowerCase()&&i.checkAvail(s.albums[l].availability.territories)&&!i.shouldIgnore(e,s.albums[l].href)&&u.push({artist:s.albums[l].artists[0].name,album:s.albums[l].name,href:s.albums[l].href});a.resolve({findings:u,ref:o})}}),a.promise.nodeify(s)},searchArtistAlbum:function(t,e,o){var s=r.defer();return n.get("http://ws.spotify.com/search/1/album.json?q="+t.album.replace(/&/g,"%26")+"%20AND%20artist:%22"+t.artist.replace(/&/g,"%26")+"%22",function(n,r){if(n)s.reject(n);else if(r.error)s.reject(r.error);else{var o=r.body,a=[];if(o.info.num_results>0)for(var u=0;u<o.albums.length;u++)o.albums[u].artists[0].name.toLowerCase()===t.artist.toLowerCase()&&i.checkAvail(o.albums[u].availability.territories)&&a.push({artist:o.albums[u].artists[0].name,album:o.albums[u].name,href:o.albums[u].href,img:t.img});s.resolve({findings:a,artistAlbum:t,ref:e})}}),s.promise.nodeify(o)},lookup:function(t,e){var i=r.defer();return n.get("http://ws.spotify.com/lookup/1/.json?uri="+t,function(t,e){t?i.reject(t):e.error?i.reject(e.error):e.body.artist?i.resolve({artist:e.body.artist.name}):e.body.album&&i.resolve({artist:e.body.album.artist,album:e.body.album.name})}),i.promise.nodeify(e)},checkAvail:function(t){return t.indexOf(i.userCountry)>=0||"worldwide"===t},shouldIgnore:function(t,e){for(var n=0;t&&n<t.length;n++)if(e&&t[n].toLowerCase()===e.toLowerCase())return console.log("ignoring release "+e),!0;return!1}};e.exports=i},{q:16,superagent:18}],8:[function(t,e){var n=t("./dropbox"),r=t("q"),i=t("events"),o=new i.EventEmitter,s={};o.on("change",function(t){console.log("store changed",t),s(null,t)});var a={setStoreChangedListener:function(t){s=t},setRemoteChangedListener:function(t){n.addListener(t)},events:{STORE:"STORE",NEWS_ADDED:"NEWS_ADDED",NEWS_REMOVED:"NEWS_REMOVED",IGNORE_ADDED:"IGNORE_ADDED",ALBUM_ADDED:"ALBUM_ADDED",ALBUM_REMOVED:"ALBUM_REMOVED"},data:{news:[],artistAlbums:[],ignoreReleaseList:[],updatedAt:{}},auth:function(){return n.authenticate()},getData:function(){var t=r.defer();if(n.isAuth())n.get().then(function(e){a.data=e,t.resolve(),o.emit("change",a.events.STORE)}).fail(function(e){t.reject(e)});else{var e=localStorage.getItem("WL-data");e&&(a.data=JSON.parse(e)),t.resolve()}return t.promise},save:function(){},addNews:function(t){var e=r.defer();return a.containsNews(t)?e.reject(new Error("Already in list: "+t)):(a.data.news.push({artist:t,added:a.dformat()}),o.emit("change",a.events.NEWS_ADDED),e.resolve()),e.promise},rmNews:function(t){a.data.news.splice(t,1),o.emit("change",a.events.NEWS_REMOVED)},addIgnore:function(t){a.data.ignoreReleaseList.push(t),o.emit("change",a.events.IGNORE_ADDED)},containsNews:function(t){for(var e=a.data.news,n=0;n<e.length;n++)if(t.toLowerCase()===e[n].artist.toLowerCase())return!0;return!1},addArtistAlbum:function(t,e){var n=r.defer();return a.containsArtistAlbum(t,e)?n.reject(new Error("Already in list: "+t+" - "+e)):(a.data.artistAlbums.push({artist:t,album:e,added:a.dformat()}),o.emit("change",a.events.ALBUM_ADDED),n.resolve()),n.promise},rmAristAlbum:function(t){a.data.artistAlbums.splice(t,1),o.emit("change",a.events.ALBUM_REMOVED)},containsArtistAlbum:function(t,e){for(var n=a.data.artistAlbums,r=0;r<n.length;r++)if(t.toLowerCase()===n[r].artist.toLowerCase()&&e.toLowerCase()===n[r].album.toLowerCase())return!0;return!1},dformat:function(t){t||(t=new Date);var e=t.getDate(),n=t.getMonth()+1,r=t.getFullYear();return 10>e&&(e="0"+e),10>n&&(n="0"+n),r+"-"+n+"-"+e}};e.exports=a},{"./dropbox":2,events:14,q:16}],9:[function(t,e){(function(n,r,i){__browserify_shim_require__=t,function(t,e,o,s,a){!function(){var e,o,s,a,u,l,h,c,f,p,d,g,v,m,_,y,w,b,E,x,S,A,T,k,O,N,L,R,C,D,I,U,M,P,j,F,B,z,q,X,H,W,V,J,G,K,$,Q,Y,Z,te,ee,ne,re,ie,oe,se,ae,ue,le,he={}.hasOwnProperty,ce=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},fe=function(t,e){function n(){this.constructor=t}for(var r in e)he.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},pe=[].slice;if(L=function(){function t(){}return t}(),L.Util=function(){function t(){}return t}(),L.Http=function(){function t(){}return t}(),L.File=function(){function t(){}return t}(),f="1.0.0","undefined"!=typeof r&&"undefined"!=typeof t&&"exports"in t)_=r,y=t.require.bind(t),t.exports=L;else if("undefined"!=typeof window&&"undefined"!=typeof navigator)_=window,y=null,window.Dropbox&&function(){var t,e,n,r;n=window.Dropbox,r=[];for(t in n)he.call(n,t)&&(e=n[t],r.push(L[t]=e));return r}(),window.Dropbox=L;else{if("undefined"==typeof self||"undefined"==typeof navigator)throw new Error("dropbox.js loaded in an unsupported JavaScript environment.");_=self,y=self.importScripts.bind(self),self.Dropbox=L}if(L.Env=function(){function t(){}return t.global=_,t.require=y,t}(),L.Util.EventSource=function(){function t(t){this._cancelable=t&&t.cancelable,this._listeners=[]}return t.prototype.addListener=function(t){if("function"!=typeof t)throw new TypeError("Invalid listener type; expected function");return ce.call(this._listeners,t)<0&&this._listeners.push(t),this},t.prototype.removeListener=function(t){var e,n,r,i,o,s;if(this._listeners.indexOf)n=this._listeners.indexOf(t),-1!==n&&this._listeners.splice(n,1);else for(s=this._listeners,e=i=0,o=s.length;o>i;e=++i)if(r=s[e],r===t){this._listeners.splice(e,1);break}return this},t.prototype.dispatch=function(t){var e,n,r,i,o;for(o=this._listeners,r=0,i=o.length;i>r;r++)if(e=o[r],n=e(t),this._cancelable&&n===!1)return!1;return!0},t}(),L.AccountInfo=function(){function t(t){var e;this._json=t,this.name=t.display_name,this.email=t.email,this.countryCode=t.country||null,this.uid=t.uid.toString(),t.public_app_url?(this.publicAppUrl=t.public_app_url,e=this.publicAppUrl.length-1,e>=0&&"/"===this.publicAppUrl.substring(e)&&(this.publicAppUrl=this.publicAppUrl.substring(0,e))):this.publicAppUrl=null,this.referralUrl=t.referral_link,this.quota=t.quota_info.quota,this.privateBytes=t.quota_info.normal||0,this.sharedBytes=t.quota_info.shared||0,this.usedQuota=this.privateBytes+this.sharedBytes}return t.parse=function(t){return t&&"object"==typeof t?new L.AccountInfo(t):t},t.prototype.name=null,t.prototype.email=null,t.prototype.countryCode=null,t.prototype.uid=null,t.prototype.referralUrl=null,t.prototype.publicAppUrl=null,t.prototype.quota=null,t.prototype.usedQuota=null,t.prototype.privateBytes=null,t.prototype.sharedBytes=null,t.prototype.json=function(){return this._json},t}(),L.ApiError=function(){function t(t,e,n){var r,i;if(this.method=e,this.url=n,this.status=t.status,t.responseType)try{r=t.response||t.responseText}catch(o){i=o;try{r=t.responseText}catch(o){i=o,r=null}}else try{r=t.responseText}catch(o){i=o,r=null}if(r)try{this.responseText=r.toString(),this.response=JSON.parse(r)}catch(o){i=o,this.response=null}else this.responseText="(no response)",this.response=null}return t.prototype.status=null,t.prototype.method=null,t.prototype.url=null,t.prototype.responseText=null,t.prototype.response=null,t.NETWORK_ERROR=0,t.NO_CONTENT=304,t.INVALID_PARAM=400,t.INVALID_TOKEN=401,t.OAUTH_ERROR=403,t.NOT_FOUND=404,t.INVALID_METHOD=405,t.NOT_ACCEPTABLE=406,t.CONFLICT=409,t.RATE_LIMITED=429,t.SERVER_ERROR=503,t.OVER_QUOTA=507,t.prototype.toString=function(){return"Dropbox API error "+this.status+" from "+this.method+" "+this.url+" :: "+this.responseText},t.prototype.inspect=function(){return this.toString()},t}(),L.AuthDriver=function(){function t(){}return t.prototype.authType=function(){return"code"},t.prototype.url=function(){return"https://some.url"},t.prototype.doAuthorize=function(t,e,n,r){return r({code:"access-code"})},t.prototype.getStateParam=function(t,e){return e(L.Util.Oauth.randomAuthStateParam())},t.prototype.resumeAuthorize=function(t,e,n){return n({code:"access-code"})},t.prototype.onAuthStateChange=function(t,e){return e()},t.oauthQueryParams=["access_token","expires_in","scope","token_type","code","error","error_description","error_uri","mac_key","mac_algorithm"].sort(),t}(),L.AuthDriver.autoConfigure=function(t){if("undefined"!=typeof chrome&&(chrome.extension||chrome.app&&chrome.app.runtime))return void t.authDriver(new L.AuthDriver.Chrome);if("undefined"!=typeof window){if(window.cordova)return void t.authDriver(new L.AuthDriver.Cordova);window&&window.navigator&&t.authDriver(new L.AuthDriver.Redirect)}},L.AuthDriver.BrowserBase=function(){function t(t){t?(this.rememberUser="rememberUser"in t?t.rememberUser:!0,this.scope=t.scope||"default"):(this.rememberUser=!0,this.scope="default"),this.storageKey=null,this.stateRe=/^[^#]+\#(.*&)?state=([^&]+)(&|$)/}return t.prototype.authType=function(){return"token"},t.prototype.onAuthStepChange=function(t,e){var n=this;switch(this.setStorageKey(t),t.authStep){case L.Client.RESET:return this.loadCredentials(function(r){return r?(t.setCredentials(r),t.authStep!==L.Client.DONE?e():n.rememberUser?(t.setCredentials(r),t.getAccountInfo(function(r){return r&&r.status===L.ApiError.INVALID_TOKEN?(t.reset(),n.forgetCredentials(e)):e()})):n.forgetCredentials(e)):e()});case L.Client.DONE:return this.rememberUser?this.storeCredentials(t.credentials(),e):this.forgetCredentials(e);case L.Client.SIGNED_OUT:return this.forgetCredentials(e);case L.Client.ERROR:return this.forgetCredentials(e);default:return e(),this}},t.prototype.setStorageKey=function(t){return this.storageKey="dropbox-auth:"+this.scope+":"+t.appHash(),this},t.prototype.storeCredentials=function(t,e){return localStorage.setItem(this.storageKey,JSON.stringify(t)),e(),this},t.prototype.loadCredentials=function(t){var e,n;if(n=localStorage.getItem(this.storageKey),!n)return t(null),this;try{t(JSON.parse(n))}catch(r){e=r,t(null)}return this},t.prototype.forgetCredentials=function(t){return localStorage.removeItem(this.storageKey),t(),this},t.prototype.locationStateParam=function(t){var e,n;return e=t||L.AuthDriver.BrowserBase.currentLocation(),n=this.stateRe.exec(e),n?decodeURIComponent(n[2]):null},t.prototype.replaceUrlBasename=function(t,e){var n,r,i;return r=t.indexOf("#"),-1!==r&&(t=t.substring(0,r)),i=t.indexOf("?"),-1!==i&&(t=t.substring(0,i)),n=t.split("/"),n[n.length-1]=e,n.join("/")},t.currentLocation=function(){return window.location.href},t.cleanupLocation=function(){var t,e;window.history&&window.history.replaceState?(e=this.currentLocation(),t=e.indexOf("#"),window.history.replaceState({},document.title,e.substring(0,t))):window.location.hash=""},t}(),L.AuthDriver.Redirect=function(t){function e(t){e.__super__.constructor.call(this,t),this.receiverUrl=this.baseUrl(t)}return fe(e,t),e.prototype.baseUrl=function(t){var e,n;if(n=L.AuthDriver.BrowserBase.currentLocation(),t){if(t.redirectUrl)return t.redirectUrl;if(t.redirectFile)return this.replaceUrlBasename(n,t.redirectFile)}return e=n.indexOf("#"),-1!==e&&(n=n.substring(0,e)),n},e.prototype.url=function(){return this.receiverUrl},e.prototype.doAuthorize=function(t,e,n){return this.storeCredentials(n.credentials(),function(){return window.location.assign(t)})},e.prototype.resumeAuthorize=function(t,e,n){var r;return this.locationStateParam()===t?(r=L.AuthDriver.BrowserBase.currentLocation(),L.AuthDriver.BrowserBase.cleanupLocation(),n(L.Util.Oauth.queryParamsFromUrl(r))):this.forgetCredentials(function(){return n({error:"Authorization error"})})},e}(L.AuthDriver.BrowserBase),L.AuthDriver.Popup=function(t){function e(t){e.__super__.constructor.call(this,t),this.receiverUrl=this.baseUrl(t)}return fe(e,t),e.prototype.url=function(){return this.receiverUrl},e.prototype.doAuthorize=function(t,e,n,r){return this.listenForMessage(e,r),this.openWindow(t)},e.prototype.baseUrl=function(t){var e;if(e=L.AuthDriver.BrowserBase.currentLocation(),t){if(t.receiverUrl)return t.receiverUrl;if(t.receiverFile)return this.replaceUrlBasename(e,t.receiverFile)}return e},e.prototype.openWindow=function(t){return window.open(t,"_dropboxOauthSigninWindow",this.popupWindowSpec(980,700))},e.prototype.popupWindowSpec=function(t,e){var n,r,i,o,s,a,u,l,h,c;return s=null!=(u=window.screenX)?u:window.screenLeft,a=null!=(l=window.screenY)?l:window.screenTop,o=null!=(h=window.outerWidth)?h:document.documentElement.clientWidth,n=null!=(c=window.outerHeight)?c:document.documentElement.clientHeight,r=Math.round(s+(o-t)/2),i=Math.round(a+(n-e)/2.5),s>r&&(r=s),a>i&&(i=a),"width="+t+",height="+e+","+("left="+r+",top="+i)+"dialog=yes,dependent=yes,scrollbars=yes,location=yes"},e.prototype.listenForMessage=function(t,e){var n,r=this;return n=function(i){var o,s,a;o=i.data?i.data:i;try{a=JSON.parse(o)._dropboxjs_oauth_info}catch(u){return void(s=u)}return a&&r.locationStateParam(a)===t?(t=!1,window.removeEventListener("message",n),L.AuthDriver.Popup.onMessage.removeListener(n),e(L.Util.Oauth.queryParamsFromUrl(o))):void 0},window.addEventListener("message",n,!1),L.AuthDriver.Popup.onMessage.addListener(n)},e.locationOrigin=function(t){var e;return(e=/^(file:\/\/[^\?\#]*)(\?|\#|$)/.exec(t))?e[1]:(e=/^([^\:]+\:\/\/[^\/\?\#]*)(\/|\?|\#|$)/.exec(t),e?e[1]:t)},e.oauthReceiver=function(){window.addEventListener("load",function(){var t,e,n,r,i,o;if(o=window.location.href,n=JSON.stringify({_dropboxjs_oauth_info:o}),L.AuthDriver.BrowserBase.cleanupLocation(),r=window.opener,window.parent!==window.top&&(r||(r=window.parent)),r){try{i=window.location.origin||locationOrigin(o),r.postMessage(n,i),window.close()}catch(s){e=s}try{return r.Dropbox.AuthDriver.Popup.onMessage.dispatch(n),window.close()}catch(s){t=s}}})},e.onMessage=new L.Util.EventSource,e}(L.AuthDriver.BrowserBase),g=null,v=null,"undefined"!=typeof chrome&&null!==chrome&&(chrome.runtime&&(chrome.runtime.onMessage&&(g=chrome.runtime.onMessage),chrome.runtime.sendMessage&&(v=chrome.runtime.sendMessage.bind(chrome.runtime))),chrome.extension&&(chrome.extension.onMessage&&(g||(g=chrome.extension.onMessage)),chrome.extension.sendMessage&&(v||(v=chrome.extension.sendMessage.bind(chrome.extension))))),L.AuthDriver.Chrome=function(t){function e(t){var n;e.__super__.constructor.call(this,t),n=t&&t.receiverPath||"chrome_oauth_receiver.html",this.useQuery=!0,this.receiverUrl=this.expandUrl(n),this.storageKey="dropbox_js_"+this.scope+"_credentials"}return fe(e,t),e.prototype.onMessage=g,e.prototype.sendMessage=v,e.prototype.expandUrl=function(t){return chrome.runtime&&chrome.runtime.getURL?chrome.runtime.getURL(t):chrome.extension&&chrome.extension.getURL?chrome.extension.getURL(t):t},e.prototype.onAuthStepChange=function(t,e){var n=this;switch(t.authStep){case L.Client.RESET:return this.loadCredentials(function(r){if(r){if(r.authStep)return n.forgetCredentials(e);t.setCredentials(r)}return e()});case L.Client.DONE:return this.storeCredentials(t.credentials(),e);case L.Client.SIGNED_OUT:return this.forgetCredentials(e);case L.Client.ERROR:return this.forgetCredentials(e);default:return e()}},e.prototype.doAuthorize=function(t,e,n,r){var i,o,s,a,u=this;return(null!=(o=chrome.identity)?o.launchWebAuthFlow:void 0)?chrome.identity.launchWebAuthFlow({url:t,interactive:!0},function(t){return u.locationStateParam(t)===e?(e=!1,r(L.Util.Oauth.queryParamsFromUrl(t))):void 0}):(null!=(s=chrome.experimental)&&null!=(a=s.identity)?a.launchWebAuthFlow:void 0)?chrome.experimental.identity.launchWebAuthFlow({url:t,interactive:!0},function(t){return u.locationStateParam(t)===e?(e=!1,r(L.Util.Oauth.queryParamsFromUrl(t))):void 0}):(i={handle:null},this.listenForMessage(e,i,r),this.openWindow(t,function(t){return i.handle=t}))},e.prototype.openWindow=function(t,e){return chrome.tabs&&chrome.tabs.create?(chrome.tabs.create({url:t,active:!0,pinned:!1},function(t){return e(t)}),this):this},e.prototype.closeWindow=function(t){return chrome.tabs&&chrome.tabs.remove&&t.id?(chrome.tabs.remove(t.id),this):chrome.app&&chrome.app.window&&t.close?(t.close(),this):this},e.prototype.url=function(){return this.receiverUrl},e.prototype.listenForMessage=function(t,e,n){var r,i=this;return r=function(o,s){var a;return s&&s.tab&&s.tab.url.substring(0,i.receiverUrl.length)!==i.receiverUrl||!o.dropbox_oauth_receiver_href?void 0:(a=o.dropbox_oauth_receiver_href,i.locationStateParam(a)===t?(t=!1,e.handle&&i.closeWindow(e.handle),i.onMessage.removeListener(r),n(L.Util.Oauth.queryParamsFromUrl(a))):void 0)},this.onMessage.addListener(r)},e.prototype.storeCredentials=function(t,e){var n;return n={},n[this.storageKey]=t,chrome.storage.local.set(n,e),this},e.prototype.loadCredentials=function(t){var e=this;return chrome.storage.local.get(this.storageKey,function(n){return t(n[e.storageKey]||null)}),this},e.prototype.forgetCredentials=function(t){return chrome.storage.local.remove(this.storageKey,t),this},e.oauthReceiver=function(){return window.addEventListener("load",function(){var t,e;return t=new L.AuthDriver.Chrome,e=window.location.href,window.location.hash="",t.sendMessage({dropbox_oauth_receiver_href:e}),window.close?window.close():void 0})},e}(L.AuthDriver.BrowserBase),L.AuthDriver.Cordova=function(t){function e(t){e.__super__.constructor.call(this,t)}return fe(e,t),e.prototype.url=function(){return"https://www.dropbox.com/1/oauth2/redirect_receiver"},e.prototype.doAuthorize=function(t,e,n,r){var i,o,s,a,u,l=this;return o=window.open(t,"_blank","location=yes,closebuttoncaption=Cancel"),a=!1,i=/^[^/]*\/\/[^/]*\//.exec(t)[0],u=!1,s=function(t){if(t.url&&l.locationStateParam(t.url)===e){if(u)return;return o.removeEventListener("loadstart",s),o.removeEventListener("loaderror",s),o.removeEventListener("loadstop",s),o.removeEventListener("exit",s),u=!0,window.setTimeout(function(){return o.close()},10),void r(L.Util.Oauth.queryParamsFromUrl(t.url))}if("exit"===t.type){if(u)return;o.removeEventListener("loadstart",s),o.removeEventListener("loaderror",s),o.removeEventListener("loadstop",s),o.removeEventListener("exit",s),u=!0,r(new AuthError("error=access_denied&error_description=User+closed+browser+window"))}},o.addEventListener("loadstart",s),o.addEventListener("loaderror",s),o.addEventListener("loadstop",s),o.addEventListener("exit",s)},e}(L.AuthDriver.BrowserBase),L.AuthDriver.NodeServer=function(){function t(t){this._port=(null!=t?t.port:void 0)||8912,(null!=t?t.tls:void 0)?(this._tlsOptions=t.tls,("string"==typeof this._tlsOptions||this._tlsOptions instanceof i)&&(this._tlsOptions={key:this._tlsOptions,cert:this._tlsOptions})):this._tlsOptions=null,this._fs=L.Env.require("fs"),this._http=L.Env.require("http"),this._https=L.Env.require("https"),this._open=L.Env.require("open"),this._callbacks={},this._nodeUrl=L.Env.require("url"),this.createApp()}return t.prototype.authType=function(){return"code"},t.prototype.url=function(){var t;return t=null===this._tlsOptions?"http":"https",""+t+"://localhost:"+this._port+"/oauth_callback"},t.prototype.doAuthorize=function(t,e,n,r){return this._callbacks[e]=r,this.openBrowser(t)},t.prototype.openBrowser=function(t){if(!t.match(/^https?:\/\//))throw new Error("Not a http/https URL: "+t);return"BROWSER"in n.env?this._open(t,n.env.BROWSER):this._open(t)},t.prototype.createApp=function(){var t=this;return this._app=this._tlsOptions?this._https.createServer(this._tlsOptions,function(e,n){return t.doRequest(e,n)}):this._http.createServer(function(e,n){return t.doRequest(e,n)}),this._app.listen(this._port)},t.prototype.closeServer=function(){return this._app.close()},t.prototype.doRequest=function(t,e){var n,r,i,o=this;return i=this._nodeUrl.parse(t.url,!0),"/oauth_callback"===i.pathname&&(r=i.query.state,this._callbacks[r]&&(this._callbacks[r](i.query),delete this._callbacks[r])),n="",t.on("data",function(t){return n+=t}),t.on("end",function(){return o.closeBrowser(e)})},t.prototype.closeBrowser=function(t){var e;return e='<!doctype html>\n<script type="text/javascript">window.close();</script>\n<p>Please close this window.</p>',t.writeHead(200,{"Content-Length":e.length,"Content-Type":"text/html"}),t.write(e),t.end()
},t}(),L.AuthError=function(){function t(t){var e;if(!t.error)throw new Error("Not an OAuth 2.0 error: "+JSON.stringify(t));e="object"==typeof t.error&&t.error.error?t.error:t,this.code=e.error,this.description=e.error_description||null,this.uri=e.error_uri||null}return t.prototype.code=null,t.prototype.description=null,t.prototype.uri=null,t.ACCESS_DENIED="access_denied",t.INVALID_REQUEST="invalid_request",t.UNAUTHORIZED_CLIENT="unauthorized_client",t.INVALID_GRANT="invalid_grant",t.INVALID_SCOPE="invalid_scope",t.UNSUPPORTED_GRANT_TYPE="unsupported_grant_type",t.UNSUPPORTED_RESPONSE_TYPE="unsupported_response_type",t.SERVER_ERROR="server_error",t.TEMPORARILY_UNAVAILABLE="temporarily_unavailable",t.prototype.toString=function(){return"Dropbox OAuth error "+this.code+" :: "+this.description},t.prototype.inspect=function(){return this.toString()},t}(),L.Client=function(){function t(t){var e=this;this.serverRoot=t.server||this.defaultServerRoot(),this.maxApiServer="maxApiServer"in t?t.maxApiServer:this.defaultMaxApiServer(),this.authServer=t.authServer||this.defaultAuthServer(),this.fileServer=t.fileServer||this.defaultFileServer(),this.downloadServer=t.downloadServer||this.defaultDownloadServer(),this.onXhr=new L.Util.EventSource({cancelable:!0}),this.onError=new L.Util.EventSource,this.onAuthStepChange=new L.Util.EventSource,this.xhrOnErrorHandler=function(t,n){return e.handleXhrError(t,n)},this.oauth=new L.Util.Oauth(t),this.uid=t.uid||null,this.authStep=this.oauth.step(),this.driver=null,this.filter=null,this.authError=null,this._credentials=null,this._datastoreManager=null,this.setupUrls()}return t.prototype.onXhr=null,t.prototype.onError=null,t.prototype.onAuthStepChange=null,t.prototype.authDriver=function(t){return this.driver=t,this},t.prototype.dropboxUid=function(){return this.uid},t.prototype.credentials=function(){return this._credentials||this.computeCredentials(),this._credentials},t.prototype.authenticate=function(t,e){var n,r,i,o,s,a=this;if(e||"function"!=typeof t||(e=t,t=null),n=t&&"interactive"in t?t.interactive:!0,!this.driver&&this.authStep!==m.DONE&&(L.AuthDriver.autoConfigure(this),!this.driver))throw new Error("OAuth driver auto-configuration failed. Call authDriver.");if(this.authStep===m.ERROR)throw new Error("Client got in an error state. Call reset() to reuse it!");return o=function(){return a.authStep=a.oauth.step(),a.authStep===m.ERROR&&(a.authError=a.oauth.error()),a._credentials=null,a.onAuthStepChange.dispatch(a),s()},i=function(){return a.authStep=m.ERROR,a._credentials=null,a.onAuthStepChange.dispatch(a),s()},r=null,s=function(){var t;if(r!==a.authStep&&(r=a.authStep,a.driver&&a.driver.onAuthStepChange))return void a.driver.onAuthStepChange(a,s);switch(a.authStep){case m.RESET:return n?(a.driver.getStateParam&&a.driver.getStateParam(function(t){return a.client.authStep===m.RESET&&a.oauth.setAuthStateParam(t),o()}),a.oauth.setAuthStateParam(L.Util.Oauth.randomAuthStateParam()),o()):void(e&&e(null,a));case m.PARAM_SET:return n?(t=a.authorizeUrl(),a.driver.doAuthorize(t,a.oauth.authStateParam(),a,function(t){return a.oauth.processRedirectParams(t),t.uid&&(a.uid=t.uid),o()})):void(e&&e(null,a));case m.PARAM_LOADED:return a.driver.resumeAuthorize?a.driver.resumeAuthorize(a.oauth.authStateParam(),a,function(t){return a.oauth.processRedirectParams(t),t.uid&&(a.uid=t.uid),o()}):(a.oauth.setAuthStateParam(a.oauth.authStateParam()),void o());case m.AUTHORIZED:return a.getAccessToken(function(t,e){return t?(a.authError=t,i()):(a.oauth.processRedirectParams(e),a.uid=e.uid,o())});case m.DONE:e&&e(null,a);break;case m.SIGNED_OUT:return a.authStep=m.RESET,a.reset(),s();case m.ERROR:e&&e(a.authError,a)}},s(),this},t.prototype.isAuthenticated=function(){return this.authStep===m.DONE},t.prototype.signOut=function(t,e){var n,r,i=this;if(e||"function"!=typeof t||(e=t,t=null),n=t&&t.mustInvalidate,this.authStep!==m.DONE)throw new Error("This client doesn't have a user's token");return r=new L.Util.Xhr("POST",this.urls.signOut),r.signWithOauth(this.oauth),this.dispatchXhr(r,function(t){if(t)if(t.status===L.ApiError.INVALID_TOKEN)t=null;else if(n)return void(e&&e(t));return i.authStep=m.RESET,i.reset(),i.authStep=m.SIGNED_OUT,i.onAuthStepChange.dispatch(i),i.driver&&i.driver.onAuthStepChange?i.driver.onAuthStepChange(i,function(){return e?e(null):void 0}):e?e(null):void 0})},t.prototype.signOff=function(t,e){return this.signOut(t,e)},t.prototype.getAccountInfo=function(t,e){var n,r;return e||"function"!=typeof t||(e=t,t=null),n=!1,t&&t.httpCache&&(n=!0),r=new L.Util.Xhr("GET",this.urls.accountInfo),r.signWithOauth(this.oauth,n),this.dispatchXhr(r,function(t,n){return e(t,L.AccountInfo.parse(n),n)})},t.prototype.getUserInfo=function(t,e){return this.getAccountInfo(t,e)},t.prototype.readFile=function(t,e,n){var r,i,o,s,a,u,l;return n||"function"!=typeof e||(n=e,e=null),i={},u="text",s=null,r=!1,e&&(e.versionTag?i.rev=e.versionTag:e.rev&&(i.rev=e.rev),e.arrayBuffer?u="arraybuffer":e.blob?u="blob":e.buffer?u="buffer":e.binary&&(u="b"),e.length?(null!=e.start?(a=e.start,o=e.start+e.length-1):(a="",o=e.length),s="bytes="+a+"-"+o):null!=e.start&&(s="bytes="+e.start+"-"),e.httpCache&&(r=!0)),l=new L.Util.Xhr("GET",""+this.urls.getFile+"/"+this.urlEncodePath(t)),l.setParams(i).signWithOauth(this.oauth,r),l.setResponseType(u),s&&(s&&l.setHeader("Range",s),l.reportResponseHeaders()),this.dispatchXhr(l,function(t,e,r,i){var o;return o=i?L.Http.RangeInfo.parse(i["content-range"]):null,n(t,e,L.File.Stat.parse(r),o)})},t.prototype.writeFile=function(t,e,n,r){var i;return r||"function"!=typeof n||(r=n,n=null),i=L.Util.Xhr.canSendForms&&"object"==typeof e,i?this.writeFileUsingForm(t,e,n,r):this.writeFileUsingPut(t,e,n,r)},t.prototype.writeFileUsingForm=function(t,e,n,r){var i,o,s,a;return s=t.lastIndexOf("/"),-1===s?(i=t,t=""):(i=t.substring(s),t=t.substring(0,s)),o={file:i},n&&(n.noOverwrite&&(o.overwrite="false"),n.lastVersionTag?o.parent_rev=n.lastVersionTag:(n.parentRev||n.parent_rev)&&(o.parent_rev=n.parentRev||n.parent_rev)),a=new L.Util.Xhr("POST",""+this.urls.postFile+"/"+this.urlEncodePath(t)),a.setParams(o).signWithOauth(this.oauth).setFileField("file",i,e,"application/octet-stream"),delete o.file,this.dispatchXhr(a,function(t,e){return r?r(t,L.File.Stat.parse(e)):void 0})},t.prototype.writeFileUsingPut=function(t,e,n,r){var i,o;return i={},n&&(n.noOverwrite&&(i.overwrite="false"),n.lastVersionTag?i.parent_rev=n.lastVersionTag:(n.parentRev||n.parent_rev)&&(i.parent_rev=n.parentRev||n.parent_rev)),o=new L.Util.Xhr("POST",""+this.urls.putFile+"/"+this.urlEncodePath(t)),o.setBody(e).setParams(i).signWithOauth(this.oauth),this.dispatchXhr(o,function(t,e){return r?r(t,L.File.Stat.parse(e)):void 0})},t.prototype.resumableUploadStep=function(t,e,n){var r,i;return e?(r={offset:e.offset},e.tag&&(r.upload_id=e.tag)):r={offset:0},i=new L.Util.Xhr("POST",this.urls.chunkedUpload),i.setBody(t).setParams(r).signWithOauth(this.oauth),this.dispatchXhr(i,function(t,e){return t&&t.status===L.ApiError.INVALID_PARAM&&t.response&&t.response.upload_id&&t.response.offset?n(null,L.Http.UploadCursor.parse(t.response)):n(t,L.Http.UploadCursor.parse(e))})},t.prototype.resumableUploadFinish=function(t,e,n,r){var i,o;return r||"function"!=typeof n||(r=n,n=null),i={upload_id:e.tag},n&&(n.lastVersionTag?i.parent_rev=n.lastVersionTag:(n.parentRev||n.parent_rev)&&(i.parent_rev=n.parentRev||n.parent_rev),n.noOverwrite&&(i.overwrite="false")),o=new L.Util.Xhr("POST",""+this.urls.commitChunkedUpload+"/"+this.urlEncodePath(t)),o.setParams(i).signWithOauth(this.oauth),this.dispatchXhr(o,function(t,e){return r?r(t,L.File.Stat.parse(e)):void 0})},t.prototype.stat=function(t,e,n){var r,i,o;return n||"function"!=typeof e||(n=e,e=null),i={},r=!1,e&&(e.versionTag?i.rev=e.versionTag:e.rev&&(i.rev=e.rev),e.contentHash?i.hash=e.contentHash:e.hash&&(i.hash=e.hash),(e.removed||e.deleted)&&(i.include_deleted="true"),e.readDir&&(i.list="true",e.readDir!==!0&&(i.file_limit=e.readDir.toString())),e.cacheHash&&(i.hash=e.cacheHash),e.httpCache&&(r=!0)),i.include_deleted||(i.include_deleted="false"),i.list||(i.list="false"),o=new L.Util.Xhr("GET",""+this.urls.metadata+"/"+this.urlEncodePath(t)),o.setParams(i).signWithOauth(this.oauth,r),this.dispatchXhr(o,function(t,e){var r,i,o;return o=L.File.Stat.parse(e),r=(null!=e?e.contents:void 0)?function(){var t,n,r,o;for(r=e.contents,o=[],t=0,n=r.length;n>t;t++)i=r[t],o.push(L.File.Stat.parse(i));return o}():void 0,n(t,o,r)})},t.prototype.readdir=function(t,e,n){var r;return n||"function"!=typeof e||(n=e,e=null),r={readDir:!0},e&&(null!=e.limit&&(r.readDir=e.limit),e.versionTag?r.versionTag=e.versionTag:e.rev&&(r.versionTag=e.rev),e.contentHash?r.contentHash=e.contentHash:e.hash&&(r.contentHash=e.hash),(e.removed||e.deleted)&&(r.removed=e.removed||e.deleted),e.httpCache&&(r.httpCache=e.httpCache)),this.stat(t,r,function(t,e,r){var i,o;return i=r?function(){var t,e,n;for(n=[],t=0,e=r.length;e>t;t++)o=r[t],n.push(o.name);return n}():null,n(t,i,e,r)})},t.prototype.metadata=function(t,e,n){return this.stat(t,e,n)},t.prototype.makeUrl=function(t,e,n){var r,i,o,s,a,u=this;return n||"function"!=typeof e||(n=e,e=null),i=e&&(e["long"]||e.longUrl||e.downloadHack)?{short_url:"false"}:{},t=this.urlEncodePath(t),o=""+this.urls.shares+"/"+t,r=!1,s=!1,e&&(e.downloadHack?(r=!0,s=!0):e.download&&(r=!0,o=""+this.urls.media+"/"+t)),a=new L.Util.Xhr("POST",o).setParams(i).signWithOauth(this.oauth),this.dispatchXhr(a,function(t,e){return s&&(null!=e?e.url:void 0)&&(e.url=e.url.replace(u.authServer,u.downloadServer)),n(t,L.File.ShareUrl.parse(e,r))})},t.prototype.history=function(t,e,n){var r,i,o;return n||"function"!=typeof e||(n=e,e=null),i={},r=!1,e&&(null!=e.limit&&(i.rev_limit=e.limit),e.httpCache&&(r=!0)),o=new L.Util.Xhr("GET",""+this.urls.revisions+"/"+this.urlEncodePath(t)),o.setParams(i).signWithOauth(this.oauth,r),this.dispatchXhr(o,function(t,e){var r,i;return i=e?function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],i.push(L.File.Stat.parse(r));return i}():void 0,n(t,i)})},t.prototype.revisions=function(t,e,n){return this.history(t,e,n)},t.prototype.thumbnailUrl=function(t,e){var n;return n=this.thumbnailXhr(t,e),n.paramsToUrl().url},t.prototype.readThumbnail=function(t,e,n){var r,i;return n||"function"!=typeof e||(n=e,e=null),r="b",e&&(e.blob&&(r="blob"),e.arrayBuffer&&(r="arraybuffer"),e.buffer&&(r="buffer")),i=this.thumbnailXhr(t,e),i.setResponseType(r),this.dispatchXhr(i,function(t,e,r){return n(t,e,L.File.Stat.parse(r))})},t.prototype.thumbnailXhr=function(t,e){var n,r;return n={},e&&(e.format?n.format=e.format:e.png&&(n.format="png"),e.size&&(n.size=e.size)),r=new L.Util.Xhr("GET",""+this.urls.thumbnails+"/"+this.urlEncodePath(t)),r.setParams(n).signWithOauth(this.oauth)},t.prototype.revertFile=function(t,e,n){var r;return r=new L.Util.Xhr("POST",""+this.urls.restore+"/"+this.urlEncodePath(t)),r.setParams({rev:e}).signWithOauth(this.oauth),this.dispatchXhr(r,function(t,e){return n?n(t,L.File.Stat.parse(e)):void 0})},t.prototype.restore=function(t,e,n){return this.revertFile(t,e,n)},t.prototype.findByName=function(t,e,n,r){var i,o,s;return r||"function"!=typeof n||(r=n,n=null),o={query:e},i=!1,n&&(null!=n.limit&&(o.file_limit=n.limit),(n.removed||n.deleted)&&(o.include_deleted=!0),n.httpCache&&(i=!0)),s=new L.Util.Xhr("GET",""+this.urls.search+"/"+this.urlEncodePath(t)),s.setParams(o).signWithOauth(this.oauth,i),this.dispatchXhr(s,function(t,e){var n,i;return i=e?function(){var t,r,i;for(i=[],t=0,r=e.length;r>t;t++)n=e[t],i.push(L.File.Stat.parse(n));return i}():void 0,r(t,i)})},t.prototype.search=function(t,e,n,r){return this.findByName(t,e,n,r)},t.prototype.makeCopyReference=function(t,e){var n;return n=new L.Util.Xhr("GET",""+this.urls.copyRef+"/"+this.urlEncodePath(t)),n.signWithOauth(this.oauth),this.dispatchXhr(n,function(t,n){return e(t,L.File.CopyReference.parse(n))})},t.prototype.copyRef=function(t,e){return this.makeCopyReference(t,e)},t.prototype.pullChanges=function(t,e){var n,r;return e||"function"!=typeof t||(e=t,t=null),n=t?t.cursorTag?{cursor:t.cursorTag}:{cursor:t}:{},r=new L.Util.Xhr("POST",this.urls.delta),r.setParams(n).signWithOauth(this.oauth),this.dispatchXhr(r,function(t,n){return e(t,L.Http.PulledChanges.parse(n))})},t.prototype.delta=function(t,e){return this.pullChanges(t,e)},t.prototype.mkdir=function(t,e){var n;return n=new L.Util.Xhr("POST",this.urls.fileopsCreateFolder),n.setParams({root:"auto",path:this.normalizePath(t)}).signWithOauth(this.oauth),this.dispatchXhr(n,function(t,n){return e?e(t,L.File.Stat.parse(n)):void 0})},t.prototype.remove=function(t,e){var n;return n=new L.Util.Xhr("POST",this.urls.fileopsDelete),n.setParams({root:"auto",path:this.normalizePath(t)}).signWithOauth(this.oauth),this.dispatchXhr(n,function(t,n){return e?e(t,L.File.Stat.parse(n)):void 0})},t.prototype.unlink=function(t,e){return this.remove(t,e)},t.prototype["delete"]=function(t,e){return this.remove(t,e)},t.prototype.copy=function(t,e,n){var r,i,o;return n||"function"!=typeof r||(n=r,r=null),i={root:"auto",to_path:this.normalizePath(e)},t instanceof L.File.CopyReference?i.from_copy_ref=t.tag:i.from_path=this.normalizePath(t),o=new L.Util.Xhr("POST",this.urls.fileopsCopy),o.setParams(i).signWithOauth(this.oauth),this.dispatchXhr(o,function(t,e){return n?n(t,L.File.Stat.parse(e)):void 0})},t.prototype.move=function(t,e,n){var r,i;return n||"function"!=typeof r||(n=r,r=null),i=new L.Util.Xhr("POST",this.urls.fileopsMove),i.setParams({root:"auto",from_path:this.normalizePath(t),to_path:this.normalizePath(e)}).signWithOauth(this.oauth),this.dispatchXhr(i,function(t,e){return n?n(t,L.File.Stat.parse(e)):void 0})},t.prototype.appInfo=function(t,e){var n;return e||"function"!=typeof t||(e=t,t=this.oauth.credentials().key),n=new L.Util.Xhr("GET",this.urls.appsInfo),n.setParams({app_key:t}),this.dispatchXhr(n,function(n,r){return e(n,L.Http.AppInfo.parse(r,t))})},t.prototype.isAppDeveloper=function(t,e,n){var r;return"object"==typeof t&&"uid"in t&&(t=t.uid),n||"function"!=typeof e?"object"==typeof e&&"key"in e&&(e=e.key):(n=e,e=this.oauth.credentials().key),r=new L.Util.Xhr("GET",this.urls.appsCheckDeveloper),r.setParams({app_key:e,uid:t}),this.dispatchXhr(r,function(t,e){return e?n(t,e.is_developer):n(t)})},t.prototype.hasOauthRedirectUri=function(t,e,n){var r;return n||"function"!=typeof e?"object"==typeof e&&"key"in e&&(e=e.key):(n=e,e=this.oauth.credentials().key),r=new L.Util.Xhr("GET",this.urls.appsCheckRedirectUri),r.setParams({app_key:e,redirect_uri:t}),this.dispatchXhr(r,function(t,e){return e?n(t,e.has_redirect_uri):n(t)})},t.prototype.reset=function(){var t;return this.uid=null,this.oauth.reset(),t=this.authStep,this.authStep=this.oauth.step(),t!==this.authStep&&this.onAuthStepChange.dispatch(this),this.authError=null,this._credentials=null,this},t.prototype.setCredentials=function(t){var e;return e=this.authStep,this.oauth.setCredentials(t),this.authStep=this.oauth.step(),this.uid=t.uid||null,this.authError=null,this._credentials=null,e!==this.authStep&&this.onAuthStepChange.dispatch(this),this},t.prototype.appHash=function(){return this.oauth.appHash()},t.prototype.setupUrls=function(){return this.apiServer=this.chooseApiServer(),this.urls={authorize:""+this.authServer+"/1/oauth2/authorize",token:""+this.apiServer+"/1/oauth2/token",signOut:""+this.apiServer+"/1/unlink_access_token",accountInfo:""+this.apiServer+"/1/account/info",getFile:""+this.fileServer+"/1/files/auto",postFile:""+this.fileServer+"/1/files/auto",putFile:""+this.fileServer+"/1/files_put/auto",metadata:""+this.apiServer+"/1/metadata/auto",delta:""+this.apiServer+"/1/delta",revisions:""+this.apiServer+"/1/revisions/auto",restore:""+this.apiServer+"/1/restore/auto",search:""+this.apiServer+"/1/search/auto",shares:""+this.apiServer+"/1/shares/auto",media:""+this.apiServer+"/1/media/auto",copyRef:""+this.apiServer+"/1/copy_ref/auto",thumbnails:""+this.fileServer+"/1/thumbnails/auto",chunkedUpload:""+this.fileServer+"/1/chunked_upload",commitChunkedUpload:""+this.fileServer+"/1/commit_chunked_upload/auto",fileopsCopy:""+this.apiServer+"/1/fileops/copy",fileopsCreateFolder:""+this.apiServer+"/1/fileops/create_folder",fileopsDelete:""+this.apiServer+"/1/fileops/delete",fileopsMove:""+this.apiServer+"/1/fileops/move",appsInfo:""+this.apiServer+"/1/apps/info",appsCheckDeveloper:""+this.apiServer+"/1/apps/check_developer",appsCheckRedirectUri:""+this.apiServer+"/1/apps/check_redirect_uri",getDb:""+this.apiServer+"/r5/datastores/get_datastore",getOrCreateDb:""+this.apiServer+"/r5/datastores/get_or_create_datastore",createDb:""+this.apiServer+"/r5/datastores/create_datastore",listDbs:""+this.apiServer+"/r5/datastores/list_datastores",deleteDb:""+this.apiServer+"/r5/datastores/delete_datastore",getSnapshot:""+this.apiServer+"/r5/datastores/get_snapshot",getDeltas:""+this.apiServer+"/r5/datastores/get_deltas",putDelta:""+this.apiServer+"/r5/datastores/put_delta",datastoreAwait:""+this.apiServer+"/r5/datastores/await"},this},t.prototype.chooseApiServer=function(){var t,e;return e=Math.floor(Math.random()*(this.maxApiServer+1)),t=0===e?"":e.toString(),this.serverRoot.replace("$",t)},t.prototype.authStep=null,t.ERROR=0,t.RESET=1,t.PARAM_SET=2,t.PARAM_LOADED=3,t.AUTHORIZED=4,t.DONE=5,t.SIGNED_OUT=6,t.prototype.urlEncodePath=function(t){return L.Util.Xhr.urlEncodeValue(this.normalizePath(t)).replace(/%2F/gi,"/")},t.prototype.normalizePath=function(t){var e;if("/"===t.substring(0,1)){for(e=1;"/"===t.substring(e,e+1);)e+=1;return t.substring(e)}return t},t.prototype.authorizeUrl=function(){var t;return t=this.oauth.authorizeUrlParams(this.driver.authType(),this.driver.url()),this.urls.authorize+"?"+L.Util.Xhr.urlEncode(t)},t.prototype.getAccessToken=function(t){var e,n;return e=this.oauth.accessTokenParams(this.driver.url()),n=new L.Util.Xhr("POST",this.urls.token).setParams(e).addOauthParams(this.oauth),this.dispatchXhr(n,function(e,n){return e&&e.status===L.ApiError.INVALID_PARAM&&e.response&&e.response.error&&(e=new L.AuthError(e.response)),t(e,n)})},t.prototype.dispatchLongPollXhr=function(t,e,n){return null==n&&(n=6e4),this.dispatchXhr(t,e,n)},t.prototype.dispatchXhr=function(t,e,n){var r,i,o=this;return null==n&&(n=1e4),r=setTimeout(function(){return o.handleLongRequest(t)},2*n),t.setCallback(function(t,n,i,o){return clearTimeout(r),e(t,n,i,o)}),t.onError=this.xhrOnErrorHandler,t.prepare(),i=t.xhr,this.onXhr.dispatch(t)&&t.send(),i},t.prototype.handleXhrError=function(t,e){var n=this;return t.status===L.ApiError.INVALID_TOKEN&&this.authStep===m.DONE&&(this.authError=t,this.authStep=m.ERROR,this.onAuthStepChange.dispatch(this),this.driver&&this.driver.onAuthStepChange)?(this.driver.onAuthStepChange(this,function(){return n.onError.dispatch(t),e(t)}),null):(this.onError.dispatch(t),void e(t))},t.prototype.handleLongRequest=function(){return this.setupUrls()},t.prototype.defaultServerRoot=function(){return"https://api$.dropbox.com"},t.prototype.defaultAuthServer=function(){return this.serverRoot.replace("api$","www")},t.prototype.defaultFileServer=function(){return this.serverRoot.replace("api$","api-content")},t.prototype.defaultDownloadServer=function(){return"https://dl.dropboxusercontent.com"},t.prototype.defaultWsServer=function(){return this.serverRoot.replace(/^https?:/,"wss:")},t.prototype.defaultMaxApiServer=function(){return 30},t.prototype.computeCredentials=function(){var t;t=this.oauth.credentials(),this.uid&&(t.uid=this.uid),this.serverRoot!==this.defaultServerRoot()&&(t.server=this.serverRoot),this.maxApiServer!==this.defaultMaxApiServer()&&(t.maxApiServer=this.maxApiServer),this.authServer!==this.defaultAuthServer()&&(t.authServer=this.authServer),this.fileServer!==this.defaultFileServer()&&(t.fileServer=this.fileServer),this.downloadServer!==this.defaultDownloadServer()&&(t.downloadServer=this.downloadServer),this._credentials=t},t}(),m=L.Client,L.Datastore=function(){function t(t,e){var n=this;this._datastore_manager=t,this._managed_datastore=e,this._dsid=this._managed_datastore.get_dsid(),this._handle=this._managed_datastore.get_handle(),this._record_cache=new Q(this),this._last_used_timestamp=0,this.recordsChanged=new L.Util.EventSource,this.syncStatusChanged=new L.Util.EventSource,this._timeoutWrapper=function(t){return t},this._evt_mgr=new R,this._evt_mgr.register(this._managed_datastore.syncStateChanged,function(){return n._syncSoon(),n.syncStatusChanged.dispatch(null)}),this._syncPending=!1,this._closed=!1,this._metadata_table=new L.Datastore.Table(this,":info"),this._metadata_table.setResolutionRule("mtime","max")}return t.prototype.recordsChanged=null,t.prototype.syncStatusChanged=null,t.int64=function(t){var e,n;if(ie.is_number(t)&&null!=t[ue.INT64_TAG])return ue.validateInt64(t);if(ie.is_string(t)){if(!ue.is_valid_int64_string(t))throw new Error("Not a valid int64 in string form: "+t);return n=new Number(parseInt(t,10)),n[ue.INT64_TAG]=t,ue.validateInt64(n)}if(!ie.is_number(t)||!isFinite(t))throw new Error("Not a finite number: "+t);if(Number(t)!==Math.round(t))throw new Error("Number is not an integer: "+t);if(e=t.toFixed(),!ue.is_valid_int64_string(e))throw new Error("Number not in int64 range: "+t);return n=new Number(t),n[ue.INT64_TAG]=e,ue.validateInt64(n)},t.isInt64=function(t){return ue.isInt64(t)},t.prototype.getModifiedTime=function(){var t;return t=this._metadata_table.getOrInsert("info",{}),t.get("mtime")},t.prototype.getTitle=function(){var t;return t=this._metadata_table.getOrInsert("info",{}),t.get("title")},t.prototype.setTitle=function(t){var e;if(null!=t&&!ie.string(t))throw new Error("Title must be a string or null!");return e=this._metadata_table.getOrInsert("info",{}),e.set("title",t)},t.prototype.getTable=function(t){if(this._checkNotClosed(),!L.Datastore.Table.isValidId(t))throw new Error("Invalid table ID: "+t);return new L.Datastore.Table(this,t)},t.prototype.listTableIds=function(){return this._checkNotClosed(),this._managed_datastore.list_tables()},t.prototype.toString=function(){var t;return t=this._closed?"[closed] ":"","Datastore("+t+this._dsid+" ["+this._handle+"])"},t.prototype.close=function(){return this._closed=!0,this._evt_mgr.unregister_all(),this._listeners=[],void this._datastore_manager._datasync.obj_manager.close(this._dsid)},t.prototype.getId=function(){return this._dsid},t.prototype.getSyncStatus=function(){return{uploading:this._managed_datastore.get_outgoing_delta_count()>0}},t.isValidId=function(t){var e;return e=new RegExp(ie.DS_ID_REGEX),ie.is_string(t)&&e.test(t)},t.prototype._generateRid=function(){var t,e,n,r;for(r="_",e="_js_",n=Math.round(1e3*Date.now()),n<=this._last_used_timestamp&&(n=this._last_used_timestamp+1),this._last_used_timestamp=n,t=n.toString(32);t.length<11;)t="0"+t;return r+t+e+ue.randomWeb64String(5)},t.prototype._syncSoon=function(){var t=this;if(this._managed_datastore.is_deleted())throw new Error("Cannot sync deleted datastore "+this._dsid);return this._checkNotClosed(),void(this._syncPending||(this._syncPending=!0,setTimeout(this._timeoutWrapper(function(){return t._syncPending=!1,t._sync()}),0)))},t.prototype._sync=function(){var t,e,n,r,i,o,s,a,u;this._checkNotClosed(),i=this._managed_datastore.sync(),r=this._resolveAffectedRecordMap(i),t=!1;for(s in r)for(n=r[s],a=0,u=n.length;u>a;a++)e=n[a],ae(s===e._tid,"tid mismatch"),t=!0,o=e._rid,this._managed_datastore.query(s,o)||(e._deleted=!0,this._record_cache.remove(s,o));return void(t&&this.recordsChanged.dispatch(new Z(r,!1)))},t.prototype._resolveAffectedRecordMap=function(t){var e,n,r,i,o;n={};for(o in t){i=t[o];for(r in i)e=this._record_cache.getOrCreate(o,r),null==n[o]&&(n[o]=[]),n[o].push(e)}return n},t.prototype._recordsChangedLocally=function(t){return void(t.length>0&&(this.recordsChanged.dispatch(Z._fromRecordList(t,!0)),this._syncSoon()))},t.prototype._checkNotClosed=function(){if(this._closed||!this._managed_datastore._open)throw new Error("Datastore is already closed: "+this);return void 0},t}(),ue=L.Datastore.impl={},ie=L.Datastore.impl.T={},ie.identity=function(t){return t},ie.get_coerce_fn=function(t){return null!=t.coerce?t.coerce:null!=t.load_json?function(e){return e instanceof t?e:t.load_json(e)}:ie.identity},ie.get_T_fn=function(t){return null!=t.Type?t.Type:t},ie.str=function(t){return ie.is_string(t)?t:ie.is_function(t)?t():JSON.stringify(t)},ie.assert=function(t,e){if(!t)throw new Error(ie.str(e))},ae=ie.assert,ie.check=function(t,e,n,r,i,o){if(t)return n;throw ie.fail(e,n,r,i,o),new Error("unreachable")},ie.safe_to_string=function(t){var e,n;try{if(n=t.toString(),"[object Object]"!==n)return n}catch(r){e=r}try{return JSON.stringify(t)}catch(r){e=r}try{if(n=t.constructor.name,null!=n?n.match(/^[A-Za-z0-9_]+$/):void 0)return n}catch(r){e=r}return"[T.safe_to_string failed]"},ie.fail=function(t,e,n,r,i){var o,s;throw s=null!=n?null!=r?null!=i?"Wanted "+ie.str(r)+", but "+ie.str(n)+" in "+ie.str(i)+" "+ie.str(t):"Wanted "+ie.str(r)+", but "+ie.str(n)+" "+ie.str(t):""+ie.str(n)+" "+ie.str(t):null!=r?null!=i?"Wanted "+ie.str(r)+", but in "+ie.str(i)+" "+ie.str(t):"Wanted "+ie.str(r)+", but "+ie.str(t):""+ie.str(t),o=new Error(""+s+": "+ie.safe_to_string(e)),console.error(o),o},ie.any=function(t){return t},ie.defined=function(t,e,n,r){return null==n&&(n="defined"),ie.check("undefined"!=typeof t,"is undefined",t,e,n,r),t},ie.nonnull=function(t,e,n,r){return null==n&&(n="nonnull"),ie.defined(t,e,n,r),ie.check(null!=t,"is null",t,e,n,r),t},ie.member=function(t){var e,n;return n="value in "+JSON.stringify(t),e="not in "+JSON.stringify(t),function(r,i,o,s){return null==o&&(o=n),ie.check(ce.call(t,r)>=0,e,r,i,o,s)}},ie.object=function(t,e,n,r){return null==n&&(n="object"),ie.nonnull(t,e,n,r),ie.check("object"==typeof t,"not an object",t,e,n,r),t},ie.bool=function(t,e,n,r){return null==n&&(n="bool"),ie.nonnull(t,e,n,r),ie.check(t===!0||t===!1,"is not bool",t,e,n,r),t},ie.string=function(t,e,n,r){return null==n&&(n="string"),ie.nonnull(t,e,n,r),ie.check(ie.is_string(t),"is not a string",t,e,n,r),t},ie.num=function(t,e,n,r){return null==n&&(n="num"),ie.nonnull(t,e,n,r),ie.check("number"==typeof t,"is not numeric",t,e,n,r),t},ie.int=function(t,e,n,r){return null==n&&(n="int"),ie.num(t,e,n,r),ie.check(0===t%1,"is not an integer",t,e,n,r),t},ie.uint=function(t,e,n,r){return null==n&&(n="uint"),ie.int(t,e,n,r),ie.check(t>=0,"is negative",t,e,n,r),t},ie.nullable=function(t){var e,n;return n="nullable("+t+")",e=function(e,r,i,o){return null==i&&(i=function(){return n}),ie.defined(e,r,i,o),null!=e&&ie.get_T_fn(t)(e,r,i,o),e},e.toString=function(){return n},e.coerce=function(e){return null!=e?ie.get_coerce_fn(t)(e):null},e.fromJSON=function(n){return null!=n?null!=t.fromJSON?t.fromJSON(n):e.coerce(n):null},e},ie.array=function(t,e,n,r){return null==n&&(n="array"),ie.nonnull(t,e,n,r),ie.check(ie.is_array(t),"is not an array",t,e,n,r),t},ie.arrayOf=function(t){var e,n;return n="arrayOf("+t+")",e=function(e,r,i,o){var s,a,u,l,h;for(null==i&&(i=n),ie.array(e,r,i,o),u=l=0,h=e.length;h>l;u=++l)s=e[u],a=function(){return null!=r?"element "+u+" of "+ie.str(r):"element "+u},ie.get_T_fn(t)(s,a,i,o);return e},e.toString=function(){return n},e.coerce=function(e){var r,i,o,s;for(ie.array(e,null,n),s=[],i=0,o=e.length;o>i;i++)r=e[i],s.push(ie.get_coerce_fn(t)(r));return s},e.fromJSON=function(r){var i,o,s,a;if(ie.array(r,"fromJSON input",n),null!=t.fromJSON){for(a=[],o=0,s=r.length;s>o;o++)i=r[o],a.push(t.fromJSON(i));return a}return e.coerce(r)},e},ie.instance=function(t,e,n,r,i){var o;if(!(e instanceof Function))throw new Error("Invalid type given: "+e);return t instanceof e||(null==r&&(r=e.name),ie.check(!1,"got instance of "+(null!=t&&null!=(o=t.constructor)?o.name:void 0),t,n,r,i)),t},ie.unimplemented=function(t){return function(){throw new Error("unimplemented "+t)}},ie.startsWith=function(t,e){return 0===t.lastIndexOf(e,0)},ie.string_matching=function(t){var e;return ie.string(t),ie.check(/^[^].*[$]$/.test(t),"does not start with ^ and end with $",t),e="does not match regex "+t,function(n,r,i,o){return ie.string(n,r,i,o),ie.check(new RegExp(t).test(n),e,n,r,i,o),n}},ie.is_defined=function(t){return"undefined"!=typeof t},ie.is_bool=function(t){return t===!0||t===!1||t&&"object"==typeof t&&t.constructor===Boolean},ie.is_number=function(t){return"number"==typeof t||t&&"object"==typeof t&&t.constructor===Number},ie.is_json_number=function(t){return ie.is_number(t)&&!isNaN(t)&&isFinite(t)},ie.is_string=function(t){return"string"==typeof t||t&&"object"==typeof t&&t.constructor===String},ie.is_function=function(t){return"function"==typeof t},ie.is_object=function(t){return null!=t&&"object"==typeof t},ie.is_array=function(t){return"[object Array]"===Object.prototype.toString.call(t)},ie.is_empty=function(t){return 0===Object.keys(t).length},ie.is_date=function(t){return"[object Date]"===Object.prototype.toString.call(t)},ie.isUint8Array=function(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)},ie.is_simple_map=function(t){var e,n;if(null==t||"object"!=typeof t)return!1;for(e in t)if(n=t[e],!Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},ie.simple_map=function(t,e,n,r){var i,o;null==n&&(n="simple map"),ie.object(t,e,n,r);for(i in t)o=t[i],ie.check(Object.prototype.hasOwnProperty.call(t,i),function(){return"property "+i+" is inherited"},t,e,n,t);return t},ie.simple_typed_map=function(t,e,n){var r,i,o;return r=ie.get_coerce_fn(e),i=ie.get_coerce_fn(n),o=function(r,i,o,s){var a,u;null==o&&(o=t),ie.simple_map(r,i,o,s);for(a in r)u=r[a],ie.get_T_fn(e)(a,"property",null,r),ie.get_T_fn(n)(u,function(){return"value of property "+a},null,r);return r},o.coerce=function(e){var n,o,s;ie.simple_map(e,null,t),o={};for(n in e)s=e[n],o[r(n)]=i(s);return o},o.fromJSON=function(e){var i,o,s;ie.simple_map(e,null,t),o={};for(i in e)s=e[i],o[r(i)]=null!=n.fromJSON?n.fromJSON(s):s;return o},o},ie.DS_ID_REGEX="^[-_a-z0-9]([-_a-z0-9.]{0,30}[-_a-z0-9])?$|^[.][-_a-zA-Z0-9]{1,100}$",ie.dsid=function(t,e,n,r){return null==n&&(n="dsid"),ie.string_matching(ie.DS_ID_REGEX)(t,e,n,r),t},ie.SS_ID_REGEX="^[-:._+/=a-zA-Z0-9][-._+/=a-zA-Z0-9]{0,31}$",ie.tid=function(t,e,n,r){return null==n&&(n="tid"),ie.string_matching(ie.SS_ID_REGEX)(t,e,n,r),t},ie.rowid=function(t,e,n,r){return null==n&&(n="rowid"),ie.string_matching(ie.SS_ID_REGEX)(t,e,n,r),t},ie.field_name=function(t,e,n,r){return null==n&&(n="field name"),ie.string_matching(ie.SS_ID_REGEX)(t,e,n,r),t},function(){var t,e,n;n=[];for(t in ie)e=ie[t],n.push(ie.hasOwnProperty(t)?function(t){return e.toString=function(){return"T."+t}}(t):void 0);return n}(),ue.struct=le={},le.define=function(t,e){var n,r,i,o,s,a,u,l,h,c,f,p,d,g,v,m;for(ie.string(t,"struct name"),ie.array(e,"fields"),g=[],d={},s=v=0,m=e.length;m>v;s=++v){i=e[s],ie.array(i,"field","field descriptor",e),ie.check(2<=i.length&&i.length<=3,"does not have length 2 or 3",i,"field descriptor"),c=ie.string(i[0],"field name","field descriptor",e),p=ie.nonnull(i[1],"field type","field descriptor",e),f=i.length<=2?{}:ie.nonnull(i[2],"map of field options","field descriptor",e);for(l in f)"init"!==l&&"initFn"!==l&&ie.fail("unknown option "+l,f,"field options","field descrptor",e);ce.call(f,"init")>=0&&ce.call(f,"initFn")>=0&&ie.fail("both 'init' and 'initFn' specified",f,"field options","field descriptor",e),u="initFn"in f?f.initFn:"init"in f?(a=f.init,function(t){return function(){return t}}(a)):null,n={name:c,type:p,initFn:u},o="undefined"!=typeof ee&&null!==ee?new ee(n):n,g.push(o),d[c]=o}return h="initializer for "+t+" (fields "+function(){var t,e,n;for(n=[],t=0,e=g.length;e>t;t++)i=g[t],n.push(i.name);return n}().join(", ")+")",r=function(t){var e,n,i;ie.defined(t,"x","initializer");for(c in t)e=t[c],t.hasOwnProperty(c)&&ie.check(null!=d[c],function(){return"has an unexpected field "+c},t,"initializer");for(n=0,i=g.length;i>n;n++)o=g[n],t[o.name]&&!t.hasOwnProperty(o.name)&&ie.fail("Has an indirect property "+o.name,t,"initializer"),t.hasOwnProperty(o.name)?(e=t[o.name],this[o.name]=ie.get_coerce_fn(o.type)(e)):null!=o.initFn?this[o.name]=o.initFn():ie.fail("lacks the field "+o.name,t,"initializer");
return r.Type(this,"initializer",h,this),this},r.Type=function(e,n,i,s){var a,u,l;for(ie.defined(e,n,i,s),ie.check(e instanceof r,function(){return"is not an instance of "+t},e,n,i,s),u=0,l=g.length;l>u;u++)o=g[u],ie.check(e.hasOwnProperty(o.name),function(){return"lacks the field "+o.name},e,n,i,s),ie.get_T_fn(o.type)(e[o.name],o.name,i,s);for(c in e)a=e[c],e.hasOwnProperty(c)&&ie.check(null!=d[c],"has an unexpected field",c,n,i,s);return e},r.coerce=function(t){return t instanceof r?(r.Type(t),t):new r(t)},r.prototype.toString=function(){var t,e,n,r,i;for(e=this,t=[],r=0,i=g.length;i>r;r++)o=g[r],n=e[o.name],t.push(""+o.name+": "+(ie.is_object(n)&&ie.is_function(n.toString)?n.toString():JSON.stringify(n)));return"{"+t.join(", ")+"}"},r.prototype.toJSON=function(){var t,e,n,r;for(t=this,e=function(){return""+t},n=0,r=g.length;r>n;n++)o=g[n],ie.get_T_fn(o.type)(this[o.name],o.name,null,e);return this},r.fromJSON=function(e){var n,i,o;ie.simple_map(e,"input"),i=[];for(l in e)o=e[l],null==d[l]&&(i.push(""+l+": "+JSON.stringify(o)),delete e[l]);i.length>0&&console.info("Ignoring unknown fields while deserializing "+t+": "+i.join(", ")),n={};for(l in e)o=e[l],p=d[l].type,n[l]=null!=p.fromJSON?p.fromJSON(o):o;return new r(n)},r.toString=function(){return"struct "+t},r},ee=le.define("StructField",[["name",ie.string],["type",ie.defined],["initFn",ie.defined]]),le.toJSO=function(t){var e,n,r,i;if("object"!=typeof t)return t;if(ie.is_array(t))return function(){var n,r,i;for(i=[],n=0,r=t.length;r>n;n++)e=t[n],i.push(le.toJSO(e));return i}();r={};for(n in t)i=t[n],t.hasOwnProperty(n)&&(r[n]=le.toJSO(i));return r},le.union_as_list=function(t,e){var n,r,i,o,s,a,u,l,h,c,f;for(ie.string(t,"union name"),ie.array(e,"variants"),r=function(){throw new Error("Use "+t+".from_array instead")},l={},u=[],h=function(e,n,i){var o;return o=le.define(""+t+"."+e,i),o.prototype.tag=function(){return e},o.prototype.toString=function(){return""+t+"."+e+"("+JSON.stringify(this)+")"},o.prototype.toJSON=function(){var t,r,i,o,s,a;for(t=[e],s=0,a=n.length;a>s;s++)r=n[s],i=r[0],o=r[1],ie.get_T_fn(o)(this[i],i),t.push(this[i]);return t},o.from_array=function(r){var i,s,a,u,l,h,c;for(l="initializer for "+t,ie.array(r,"initializer",l),ie.check(r.length===n.length+1,"does not have length "+(n.length+1),r,"initializer",l),ie.check(r[0]===e,"does not have tag "+e,r,"initializer",l),i={_tag:e},a=h=0,c=n.length;c>h;a=++h)s=n[a],u=s[0],i[u]=r[a+1];return new o(i)},o.fromJSON=function(t){return t.length>n.length+1&&(t=t.slice(0,n.length+1)),o.from_array(t)},o.coerce=function(t){return t instanceof o?(o.Type(t),t):o.from_array(t)},l[e]=o,r[e]=o},c=0,f=e.length;f>c;c++)i=e[c],ie.array(i,"variant","variant descriptor",e),ie.check(2===i.length,"does not have length 2",i,"variant descriptor",e),a=ie.string(i[0],"tag","tag",e),o=ie.array(i[1],"fields","variant descriptor",e),s=o.slice(0),s.unshift(["_tag",ie.member([a])]),h(a,o,s),u.push(a);return n="initializer for "+t+" (variants "+u.join(", ")+")",r.from_array=function(e){var n,r;return r="initializer for "+t,ie.array(e,"initializer",r),ie.check(e.length>=1,"lacks a tag",e,"initializer",r),n=e[0],ie.string(n,"tag",r,e),ie.member(u)(n),l[n].from_array(e)},r.fromJSON=function(e){var n,r;return r="initializer for "+t,ie.array(e,"initializer",r),ie.check(e.length>=1,"lacks a tag",e,"initializer",r),n=e[0],ie.string(n,"tag",r,e),ie.member(u)(n),l[n].fromJSON(e)},r.Type=function(e,n,r,i){var o;return null==r&&(r=""+t+".Type"),ie.defined(e,n,r,i),ie.defined(e.tag,"tag",r,i),o=e.tag(),ie.string(o,"tag","initializer",e),ie.member(u)(o),l[o].Type(e,null,"object of type "+t),e},r.coerce=function(t){var e,n;for(n in l)if(e=l[n],t instanceof e)return e.Type(t),t;return r.from_array(t)},r.toString=function(){return"union "+t},r},ue.nonzero_int64_approximate_regex=new RegExp("^-?[1-9][0-9]{0,18}$"),ue.int64_max_str="9223372036854775807",ue.int64_min_str="-9223372036854775808",ue.int64_string_less_than=function(t,e){var n,r,i;return t===e?!1:(r="0"===t.charAt(0),i="0"===e.charAt(0),r&&!i?!0:i&&!r?!1:(n=t.length===e.length?t>e:t.length>e.length,r&&i?n:!n))},ue.is_valid_int64_string=function(t){return ie.is_string(t)?"0"===t?!0:ue.nonzero_int64_approximate_regex.test(t)?"-"===t.charAt(0)?t.length<ue.int64_min_str.length||t<=ue.int64_min_str:t.length<ue.int64_max_str.length||t<=ue.int64_max_str:!1:!1},ue.is_wrapped_atomic_field_value=function(t){var e,n,r,i;if(!ie.is_simple_map(t))return!1;if(e=Object.keys(t),1!==e.length)return!1;switch(e[0]){case"B":return ie.is_string(t.B);case"N":return"nan"===(r=t.N)||"+inf"===r||"-inf"===r;case"I":case"T":return n=null!=(i=t.I)?i:t.T,ue.is_valid_int64_string(n);default:return!1}},ue.is_atomic_field_value=function(t){return ie.is_bool(t)||ie.is_json_number(t)||ie.is_string(t)||ue.is_wrapped_atomic_field_value(t)},ue.is_list_value=function(t){var e,n,r;if(ie.is_array(t)){for(n=0,r=t.length;r>n;n++)if(e=t[n],!ue.is_atomic_field_value(e))return!1;return!0}return!1},ue.is_compound_field_value=function(t){return ue.is_atomic_field_value(t)||ue.is_list_value(t)},ue.atomic_field_value=function(t,e,n,r){return null==n&&(n="atomic field value"),ie.check(ue.is_atomic_field_value(t),"is not an atomic field value",t,e,n,r),t},ue.list_value=function(t,e,n,r){return null==n&&(n="list value"),ie.arrayOf(ue.atomic_field_value)(t,e,n,r),t},ue.compound_field_value=function(t,e,n,r){return null==n&&(n="field value"),ie.is_array(t)?ue.list_value(t,e,n,r):ue.atomic_field_value(t,e,n,r)},ue.FieldOp=D=le.union_as_list("FieldOp",[["P",[["value",ue.compound_field_value]]],["D",[]],["LC",[]],["LP",[["at",ie.uint],["value",ue.atomic_field_value]]],["LI",[["before",ie.uint],["value",ue.atomic_field_value]]],["LD",[["at",ie.uint]]],["LM",[["from",ie.uint],["to",ie.uint]]]]),ue.datadict=ie.simple_typed_map("datadict",ie.field_name,ue.compound_field_value),ue.update_datadict=ie.simple_typed_map("update_datadict",ie.field_name,D),ue.Change=a=le.union_as_list("Change",[["I",[["tid",ie.tid],["rowid",ie.rowid],["fields",ue.datadict]]],["U",[["tid",ie.tid],["rowid",ie.rowid],["updates",ue.update_datadict]]],["D",[["tid",ie.tid],["rowid",ie.rowid]]]]),ue.Delta=N=le.define("Delta",[["rev",ie.uint],["changes",ie.arrayOf(a)],["nonce",ie.string]]),z=le.define("ListDatastoresResponseItem",[["dsid",ie.string],["handle",ie.string],["rev",ie.uint],["info",ie.nullable(ue.datadict),{init:null}]]),B=le.define("ListDatastoresResponse",[["token",ie.string],["datastores",ie.arrayOf(z)]]),F=le.define("GetSnapshotResponseRow",[["tid",ie.string],["rowid",ie.string],["data",ue.datadict]]),j=le.define("GetSnapshotResponse",[["rev",ie.uint],["rows",ie.arrayOf(F)]]),h=le.define("CreateDatastoreResponse",[["handle",ie.string],["rev",ie.uint],["created",ie.bool]]),M=le.define("GetDatastoreResponse",[["handle",ie.string],["rev",ie.uint]]),O=le.define("DeleteDatastoresResponse",[]),K=le.define("PutDeltasResponse",[["rev",ie.nullable(ie.uint),{init:null}],["conflict",ie.nullable(ie.string),{init:null}]]),P=le.define("GetDeltasResponse",[["deltas",ie.nullable(ie.arrayOf(N)),{init:null}],["notfound",ie.nullable(ie.string),{init:null}]]),o=le.define("AwaitResponseDeltas",[["deltas",ie.simple_typed_map("deltas map",ie.string,P)]]),ue.AwaitResponse=e=le.define("AwaitResponse",[["get_deltas",ie.nullable(o),{init:null}],["list_datastores",ie.nullable(B),{init:null}]]),d=function(){function t(t){this.obj_manager=e(t)}var e;return e=function(t){var e,n;return n=new C(t),e=new J(n,t)},t.changeFromArray=function(t){return a.from_array(t)},t.prototype.close=function(){return this.obj_manager.destroy()},t.prototype.get_or_create=function(t,e){var n=this;return this.obj_manager.flob_client.get_or_create_db(t,function(r,i){return r?e(r):n.obj_manager.open(t,i.handle,function(t,n){return null!=t?e(t):e(null,n,i.created)})})},t.prototype.create=function(t,e,n){var r=this;return this.obj_manager.flob_client.create_db(t,e,function(e,i){return e?n(e):r.obj_manager.open(t,i.handle,function(t,e){return null!=t?n(t):n(null,e,i.created)})})},t.prototype.get_by_dsid=function(t,e){var n=this;return this.obj_manager.flob_client.get_db(t,function(r,i){return r?e(r):n.obj_manager.open(t,i.handle,function(t,n){return null!=t?e(t):e(null,n)})})},t.prototype.get=function(t,e){return this.obj_manager.open(t,function(t,n){return null!=t?e(t):e(null,n)})},t}(),s=function(){function t(){this.min_delay_millis=500,this.max_delay_millis=9e4,this.base=1.5,this._failures=0,this.log=!1}return t.prototype.set_log=function(t){this.log=t},t.prototype.set_max_delay_millis=function(t){this.max_delay_millis=t},t.prototype.get_backoff_millis=function(){var t,e;return this._failures+=1,e=Math.min(this.max_delay_millis,this.min_delay_millis*Math.pow(this.base,this._failures-1)),t=(.5+Math.random())*e,this.log&&console.log("get_backoff_millis: failures="+this._failures+", target_delay_millis="+e+", delay_millis="+t),t},t.prototype.reset=function(){return this._failures=0},t}(),te=function(){function t(){this.backoff=new s}var e,n;return n=6e4,e=0,t.prototype.run=function(t,e,r){var i,o,s,a,u,l,h,c=this;return s=null!=(l=e.do_retry)?l:function(){return!0},a=null!=(h=e.giveup_after_ms)?h:n,u=Date.now()+a,o=!1,i=function(){return o?void 0:t(function(){var t,e,n;return t=arguments[0],e=2<=arguments.length?pe.call(arguments,1):[],o?void 0:t&&s(t)?Date.now()>u?(console.error("Giving up due to error",t),r(t)):(n=c.backoff.get_backoff_millis(),console.warn("Retrying in "+n+" ms due to error",t),setTimeout(i,n)):r.apply(null,[t].concat(pe.call(e)))})},i(),function(){return o=!0}},t}(),U=function(){function t(t){this.client=t,this._retry=new te}var e,n;return n=10,e=2419200,t.prototype._run_with_retries=function(t,e,n){var r;return r={giveup_after_ms:1e3*t,do_retry:function(t){var e;return 0===t.status||500<=(e=t.status)&&600>e}},this._retry.run(n,r,e)},t.prototype.delete_db=function(t,e){var r=this;return this._run_with_retries(n,e,function(e){return r.client._deleteDatastore(t,function(t){return e(null!=t?t:null)})})},t.prototype.list_dbs=function(t){var n=this;return this._run_with_retries(e,t,function(t){return n.client._listDatastores(function(e,n){return null!=e?t(e):t(null,n)})})},t.prototype.get_or_create_db=function(t,e){var r=this;return this._run_with_retries(n,e,function(e){return r.client._getOrCreateDatastore(t,function(t,n){return null!=t?e(t):e(null,n)})})},t.prototype.create_db=function(t,e,r){var i=this;return this._run_with_retries(n,r,function(n){return i.client._createDatastore(t,e,function(t,e){return null!=t?n(t):n(null,e)})})},t.prototype.get_db=function(t,e){var r=this;return this._run_with_retries(n,e,function(e){return r.client._getDatastore(t,function(t,n){return null!=t?e(t):e(null,n)})})},t.prototype.await=function(t,n,r){var i,o=this;return i=this._run_with_retries(e,r,function(e){return o.client._datastoreAwait(t,n,function(t,n){return null!=t?e(t):e(null,n)})})},t.prototype.put_delta=function(t,n,r){var i,o=this;return i=function(t,e){return r(e)},this._run_with_retries(e,r,function(e){return o.client._putDelta(t,n,function(t){return e(null!=t?t:null)})})},t.prototype.get_snapshot=function(t,e){var r=this;return this._run_with_retries(n,e,function(e){return r.client._getSnapshot(t,function(t,n){return null!=t?e(t):e(null,n)})})},t}(),q=function(){function t(t,e,n){this.changes=t,this.undo_extras=e,this.finalized=null!=n?n:!1}var e;return e=function(t,e){var n,r,i,o,s;switch(o=null,r=null,t.tag()){case"I":o="D";break;case"U":o="U",r={};for(i in e)s=e[i],r[i]=null==s?["D"]:["P",s];break;case"D":o="I",r=ue.clone(e);break;default:throw new Error("Unknown change tag: "+t.tag())}return n=[o,t.tid,t.rowid],null!=r&&n.push(r),a.from_array(n)},t.prototype.add_change=function(t,e){return ae(!this.finalized,"add_change: already finalized"),this.changes.push(t),this.undo_extras.push(e)},t.prototype["package"]=function(t,e){return ae(this.finalized,"package: not finalized"),new N({changes:this.changes.slice(),nonce:t,rev:e})},t.prototype.inverse_changes=function(){var t,n,r,i,o,s;for(r=[],s=this.changes,n=i=0,o=s.length;o>i;n=++i)t=s[n],r.push(e(t,this.undo_extras[n]));return r.reverse(),r},t}(),ue.value_size=function(t){var e,n,r,i;if(ie.is_string(t))return L.Util.countUtf8Bytes(t);if(ie.is_bool(t))return 0;if(ie.is_number(t))return 0;if(ie.is_array(t)){for(e=20*t.length,r=0,i=t.length;i>r;r++)n=t[r],e+=ue.value_size(n);return e}if("object"!=typeof t)throw new Error("Unexpected value: "+t);if(null!=t.I)return 0;if(null!=t.N)return 0;if(null!=t.B)return Math.ceil(3*t.B.length/4);if(null!=t.T)return 0;throw new Error("Unexpected object: "+JSON.stringify(t))},W=102400,X=10485760,H=2097152,ue.size_difference_for_field_op=function(t,e,n){var r,i,o,s;switch(r=t.get(e),n.tag()){case"P":return i=n.value,r?ue.value_size(i)-ue.value_size(r):100+ue.value_size(i);case"D":return null!=r?-(100+ue.value_size(r)):0;case"LC":return ae(null==r,"can't create list for field that already exists"),100;case"LP":return ae(ie.is_array(r),"LP on non-list"),ae(0<=(o=n.at)&&o<r.length,"bad index for LP"),ue.value_size(n.value)-ue.value_size(r[n.at]);case"LI":return null!=r?20+ue.value_size(n.value):120+ue.value_size(n.value);case"LD":return ae(ie.is_array(r),"LD on non-list"),ae(0<=(s=n.at)&&s<r.length,"bad index for LD"),-(20+ue.value_size(r[n.at]));case"LM":return 0;default:throw new Error("unexpected field op type "+n.tag())}},ue.size_difference_for_change=function(t,e){var n,r,i,o,s,a,u;return s=function(){var s,l;switch(e.tag()){case"I":o=100,s=e.fields;for(n in s)u=s[n],o+=100+ue.value_size(u);return o;case"U":i=t.get_record(e.tid,e.rowid),ie.assert(null!=i,function(){return"record not found: "+JSON.stringify(e)}),a=0,l=e.updates;for(n in l)r=l[n],a+=ue.size_difference_for_field_op(i,n,r);return a;case"D":return-t.get_record(e.tid,e.rowid)._size;default:throw new Error("unrecognized tag "+e.tag())}}()},Y=function(){function t(t,e,n){var r,i;this._tid=t,this._rid=e,null==n&&(n={}),this._fields={},this._size=100;for(r in n)i=n[r],this._fields[r]=ue.clone(i),this._size+=100+ue.value_size(i)}return t.prototype.get=function(t){return this._fields[t]},t.prototype.get_all=function(){return this._fields},t.prototype.put=function(t,e){return void(null!=e?this._fields[t]=ue.clone(e):delete this._fields[t])},t.prototype.apply_field_op=function(t,e){var n,r,i,o,s,a,u;switch(n=this._fields[t],e.tag()){case"P":this._fields[t]=ue.clone(e.value);break;case"D":delete this._fields[t];break;case"LC":ae(null==n,"can't create list for field that already exists"),this._fields[t]=[];break;case"LP":ae(ie.is_array(n),"LP on non-list"),ae(0<=(i=e.at)&&i<n.length,"bad index for LP"),n[e.at]=ue.clone(e.value);break;case"LI":null!=n?(ae(ie.is_array(n),"LI on non-list"),ae(0<=(o=e.before)&&o<=n.length,"bad index for LI"),n.splice(e.before,0,ue.clone(e.value))):(ae(0===e.before,"bad index for LI on nonexistent field"),this._fields[t]=[ue.clone(e.value)]);break;case"LD":ae(ie.is_array(n),"LD on non-list"),ae(0<=(s=e.at)&&s<n.length,"bad index for LD"),n.splice(e.at,1);break;case"LM":ae(ie.is_array(n),"LM on non-list"),ae(0<=(a=e.from)&&a<n.length,"bad from index for LM"),ae(0<=(u=e.to)&&u<n.length,"bad to index for LM"),r=n[e.from],n.splice(e.from,1),n.splice(e.to,0,r);break;default:throw new Error("unexpected field op type "+e.tag())}return void 0},t}(),oe=function(){function t(){this._records={}}return t.prototype.get=function(t){return this._records[t]},t.prototype.put=function(t,e){return void(null!=e?this._records[t]=e:delete this._records[t])},t.prototype.has=function(t){return null!=this._records[t]},t.prototype.is_empty=function(){var t;for(t in this._records)return!1;return!0},t.prototype.list_record_ids=function(){var t,e;e=[];for(t in this._records)e.push(t);return e},t}(),p=function(){function t(t,e){var n,r,i,o,s,a;this._tables={},this._size=1e3;for(a in e){i=e[a],s=this._get_table(a);for(o in i)n=i[o],r=new Y(a,o,n),this._check_record_size(t,a,o,r._size),s.put(o,r),this._size+=r._size}this._check_datastore_size(t,this._size)}return t.from_get_snapshot_resp=function(e){var n,r,i,o,s,a;for(n={},a=e.rows,i=0,o=a.length;o>i;i++)r=a[i],n[s=r.tid]||(n[s]={}),n[r.tid][r.rowid]=r.data;return new t(!1,n)},t.prototype._size_limit_exceeded=function(t,e){var n;if(t)throw n=new Error(e),n.code="SIZE_LIMIT_EXCEEDED",n;return void console.warn(e)},t.prototype._check_record_size=function(t,e,n,r){return void(r>W&&this._size_limit_exceeded(t,"Record ("+e+", "+n+") too large: "+r+" bytes"))},t.prototype._check_datastore_size=function(t,e){return void(e>X&&this._size_limit_exceeded(t,"Datastore too large: "+e+" bytes"))},t.prototype._TEST_calculate_size_from_scratch=function(){var t,e,n,r,i,o,s,a,u,l,h,c;r=0,l=this._tables;for(o in l)for(i=l[o],h=i.list_record_ids(),a=0,u=h.length;u>a;a++){n=h[a],e=i.get(n),r+=100,c=e.get_all();for(t in c)s=c[t],r+=100+ue.value_size(s)}return r},t.prototype.raw_data=function(){var t,e,n,r,i,o,s,a;t={},s=this._tables;for(r in s)for(n=s[r],t[r]={},a=n.list_record_ids(),i=0,o=a.length;o>i;i++)e=a[i],t[r][e]=ue.clone(n.get(e).get_all());return t},t.prototype.get_record=function(t,e){var n;return null!=(n=this._tables[t])?n.get(e):void 0},t.prototype.apply_change=function(t,e){var n,r,i;switch(n=ue.size_difference_for_change(this,e),n>=0&&this._check_datastore_size(t,this._size+n),e.tag()){case"I":this._check_record_size(t,e.tid,e.rowid,n),i=this._apply_insert(e);break;case"U":r=this.get_record(e.tid,e.rowid),ie.assert(null!=r,function(){return"apply_change: record does not exist: "+JSON.stringify(e)}),n>=0&&this._check_record_size(t,e.tid,e.rowid,r._size+n),i=this._apply_update(r,e),r._size+=n;break;case"D":i=this._apply_delete(e);break;default:throw new Error("unrecognized tag "+e.tag())}return this._size+=n,i},t.prototype._get_table=function(t){return null==this._tables[t]&&(this._tables[t]=new oe),this._tables[t]},t.prototype._apply_insert=function(t){var e,n;return n=this._get_table(t.tid),ie.assert(!n.has(t.rowid),function(){return"_apply_insert: record already exists: "+JSON.stringify(t)}),e=new Y(t.tid,t.rowid,t.fields),n.put(t.rowid,e),null},t.prototype._apply_update=function(t,e){var n,r,i,o,s,a,u;o={};try{a=e.updates;for(r in a)i=a[r],s=ue.clone(null!=(u=t.get(r))?u:null),t.apply_field_op(r,i),o[r]=s}catch(l){n=l;for(r in o)s=o[r],t.put(!1,r,s);throw n}return o},t.prototype._apply_delete=function(t){var e,n,r;return r=this._get_table(t.tid),ie.assert(r.has(t.rowid),function(){return"_apply_delete: record does not exist: "+JSON.stringify(t)}),n=r.get(t.rowid),e=ue.clone(n.get_all()),r.put(t.rowid,null),r.is_empty()&&delete this._tables[t.tid],e},t.prototype.query=function(t,e){var n,r;return r=this._tables[t],null==r?null:(n=r.get(e),null==n?null:ue.clone(n.get_all()))},t.prototype.list_tables=function(){var t,e;return t=function(){var t;t=[];for(e in this._tables)t.push(e);return t}.call(this),t.sort(),t},t.prototype.list_rows_for_table=function(t){var e,n;return n=this._tables[t],null==n?[]:(e=n.list_record_ids(),e.sort(),e)},t.prototype.size=function(){return this._size},t}(),V=function(){function t(t,e,n,r,i,o){this.dbid=t,this.handle=e,this.datastore_model=n,this.resolver=r,this.sync_state=i,this.flob_client=o,this.syncStateChanged=new L.Util.EventSource,this._deleted=!1,this._open=!0,this._commit_queue=new ne}return t.fresh_managed_datastore=function(e,n,r,i,o,s){var a,u;return a=ue.randomWeb64String(10),u=new re(a,null,i,[],[]),new t(e,n,r,o,u,s)},t.prototype.get_dsid=function(){return this.dbid},t.prototype.get_handle=function(){return this.handle},t.prototype.is_deleted=function(){return this._deleted},t.prototype.mark_deleted=function(){return this._deleted=!0},t.prototype.open=function(){if(this._open)throw new Error("Attempt to open datastore multiple times");return this._open=!0},t.prototype.close=function(){if(!this._open)throw new Error("Attempt to close datastore multiple times");return this._open=!1},t.prototype._do_sync=function(){var t,e,n,r,i,o,s,a,u,l,h,c,f,p,d,g,v,m,_,y,w,b,E;if(0===this.sync_state.server_deltas.length)return{};for(i=this.resolver.resolve(this.sync_state.unsynced_deltas,this.sync_state.server_deltas),r=i.rebased_deltas,t=i.affected_records,o=this.sync_state.unsynced_deltas.slice().reverse(),a=0,c=o.length;c>a;a++)for(n=o[a],y=n.inverse_changes(),u=0,f=y.length;f>u;u++)e=y[u],this.datastore_model.apply_change(!1,e);for(w=this.sync_state.server_deltas,l=0,p=w.length;p>l;l++)for(n=w[l],b=n.changes,h=0,d=b.length;d>h;h++)e=b[h],this.datastore_model.apply_change(!1,e);for(m=0,g=r.length;g>m;m++)for(n=r[m],n.undo_extras=[],E=n.changes,_=0,v=E.length;v>_;_++)e=E[_],s=this.datastore_model.apply_change(!1,e),n.undo_extras.push(s);return this.sync_state.update_unsynced_deltas(r),t},t.prototype._do_commit=function(){var t,e=this;return this.sync_state.delta_pending()||(t=this.sync_state.get_next_commit(),null==t)?void 0:this._commit_queue.request(function(){return e.flob_client.put_delta(e.handle,t,function(){return e._commit_queue.finish()})})},t.prototype._apply_and_queue_local_change=function(t,e){var n;return n=this.datastore_model.apply_change(t,e),void this.sync_state.add_unsynced_change(e,n)},t.prototype._update_mtime=function(){return null},t.prototype.perform_local_change=function(t){return this._apply_and_queue_local_change(!0,t),this._update_mtime(),this.syncStateChanged.dispatch(null)},t.prototype.sync=function(){var t;return this.has_unfinalized_changes&&this.sync_state.finalize(),t=this._do_sync(),this._do_commit(),t},t.prototype.get_outgoing_delta_count=function(){return this.sync_state.unsynced_deltas.length},t.prototype.get_incoming_delta_count=function(){return this.sync_state.server_deltas.length},t.prototype.has_unfinalized_changes=function(){return this.sync_state.has_unfinalized_changes()},t.prototype.receive_server_delta=function(t){return this.syncStateChanged.dispatch(this.sync_state.receive_server_delta(t)?null:null)},t.prototype.query=function(t,e){return this.datastore_model.query(t,e)},t.prototype.list_tables=function(){var t;return function(){var e,n,r,i;for(r=this.datastore_model.list_tables(),i=[],e=0,n=r.length;n>e;e++)t=r[e],":info"!==t&&i.push(t);return i}.call(this)},t.prototype.list_rows_for_table=function(t){return this.datastore_model.list_rows_for_table(t)},t}(),re=function(){function t(t,e,n,r,i){this.last_nonce=t,this.pending_delta=e,this.last_rev=n,this.unsynced_deltas=r,this.server_deltas=i,ie.uint(this.last_rev,"last_rev")}return t.prototype.is_current=function(){return 0===this.unsynced_deltas.length&&0===this.server_deltas.length},t.prototype.add_unsynced_change=function(t,e){var n;return n=this.unsynced_deltas.length,0===n||this.unsynced_deltas[n-1].finalized?this.unsynced_deltas.push(new q([t],[e])):this.unsynced_deltas[n-1].add_change(t,e)},t.prototype._compact_deltas=function(){var t,e,n,r,i,o,s,a,u,l,h,c,f,p;if(r=this.unsynced_deltas.length,!(1>=r)){for(e=[],o=[],n=s=0,c=r-1;c>=0?c>s:s>c;n=c>=0?++s:--s){for(f=this.unsynced_deltas[n].changes,a=0,l=f.length;l>a;a++)t=f[a],e.push(t);for(p=this.unsynced_deltas[n].undo_extras,u=0,h=p.length;h>u;u++)i=p[u],o.push(i)}return this.unsynced_deltas=[new q(e,o,!0),this.unsynced_deltas[r-1]]}},t.prototype.get_next_commit=function(){var t,e,n;return ae(null==this.pending_delta,"delta pending"),t=this.unsynced_deltas.length,0===t?null:(this._compact_deltas(),e=this.unsynced_deltas[0],e.finalized?(n=this.last_nonce,this.pending_delta=e["package"](n,this.last_rev),this.pending_delta):null)},t.prototype.clear_pending=function(){return this.pending_delta=null},t.prototype.delta_pending=function(){return null!=this.pending_delta},t.prototype.has_unfinalized_changes=function(){var t,e;return e=this.unsynced_deltas.length,0===e?!1:(t=this.unsynced_deltas[e-1],!t.finalized)},t.prototype.finalize=function(){var t;return this.has_unfinalized_changes()?(t=this.unsynced_deltas[this.unsynced_deltas.length-1],ae(!t.finalized,"last delta already finalized"),t.finalized=!0):void 0},t.prototype.update_unsynced_deltas=function(t){return this.unsynced_deltas=t,this.last_rev+=this.server_deltas.length,this.server_deltas=[]},t.prototype.is_ours=function(t){return this.last_nonce===t.nonce},t.prototype.ack=function(t){return ae(this.is_ours(t),"not ours"),ae(null!=this.pending_delta,"no pending delta"),ae(0===this.server_deltas.length,"server deltas exist"),this.pending_delta=null,this.unsynced_deltas.shift(),this.last_rev++},t.prototype.receive_server_delta=function(t){var e,n;return n=this.server_deltas.length,e=n>0?this.server_deltas[n-1].rev+1:this.last_rev,ae(t.rev<=e,"was expecting rev "+e+", but got "+t.rev+" instead!"),t.rev<e?(console.warn("received old delta!"),!1):this.is_ours(t)?(this.ack(t),!1):(this.server_deltas.push(t),this.pending_delta=null,!0)},t}(),ue.DatastoreModel=p,G=function(){function t(t){this.update_manager=t,this.cancelled=!1,this.cancel_fn=null}return t.prototype.cancel=function(){return null!=this.cancel_fn&&this.cancel_fn(),this.cancelled=!0},t.prototype.poll=function(){var t,e=this;return(t=function(){var n;return e.cancelled?void 0:(n=ue.clone(e.update_manager._handle_version_map),e.cancel_fn=e.update_manager.flob_client.await(n,e.update_manager._last_dslist_token,function(r,i){var o,s,a,u,l,h,c,f,p,d;if(e.cancel_fn=null,r)return 0===r.status?(console.log("await deltas failed (offline):",r),setTimeout(t,1e4)):r.status&&500<=(f=r.status)&&599>=f?(console.log("server error:",r),setTimeout(t,2e3)):(console.error("Got error in longpoll:",r),setTimeout(t,1e4));if(null!=i.get_deltas){p=i.get_deltas.deltas;for(u in p)if(s=p[u],null!=s.notfound)e.update_manager._data_queue.push({handle:u,notfound:s.notfound}),delete e.update_manager._handle_version_map[u];else if(null!=s.deltas){for(d=s.deltas,h=0,c=d.length;c>h;h++)a=d[h],e.update_manager._data_queue.push({handle:u,delta:a});l=n[u]+s.deltas.length,o=e.update_manager._handle_version_map[u],null!=o&&(e.update_manager._handle_version_map[u]=Math.max(o,l))}}return null!=i.list_datastores&&(e.update_manager._last_dslist_token=i.list_datastores.token,e.update_manager._data_queue.push({dslist:i.list_datastores})),setTimeout(t,0)}))})()},t}(),C=function(){function t(t){this.flob_client=t,this._data_queue=null,this._handle_version_map={},this._last_dslist_token=".",this._pending_poll=null,this._running=!1}return t.prototype.run=function(t){return this._data_queue=new l(t),this._running=!0,this._do_longpoll()},t.prototype.stop=function(){return this._pending_poll?this._pending_poll.cancel():void 0},t.prototype.add_poll=function(t,e){var n,r;return ae(this._running,"update manager is not running"),n=this._handle_version_map[t],r=e,null!=n&&(r=Math.max(e,n)),this._handle_version_map[t]=r,this._do_longpoll()},t.prototype.remove_poll=function(t){return ae(this._running,"update manager is not running"),t in this._handle_version_map?(delete this._handle_version_map[t],this._do_longpoll()):void 0},t.prototype._do_longpoll=function(){return ae(this._running,"update manager is not running"),this._pending_poll&&(this._pending_poll.cancel(),this._pending_poll=null),this._pending_poll=new G(this),this._pending_poll.poll()},t}(),J=function(){function t(t,e){this.update_manager=t,this.flob_client=e,this.update_manager.run(this._handle_server_update.bind(this)),this._cached_objects={},this._dslist_listener=null,this._handle_to_dsid_map={}}return t.prototype.destroy=function(){var t;for(t in this._cached_objects)this._cached_objects[t].close();return this.update_manager.stop()},t.prototype.set_dslist_listener=function(t){return this._dslist_listener=t},t.prototype._evict=function(t){var e;return e=this._handle_to_dsid_map[t],null!=e?(delete this._handle_to_dsid_map[t],e in this._cached_objects&&this._cached_objects[e].mark_deleted(),this.update_manager.remove_poll(t)):void 0},t.prototype.close=function(t){var e;if(t in this._cached_objects)return e=this._cached_objects[t].get_handle(),this._cached_objects[t].close();throw new Error("Attempt to close unknown datastore: "+t)},t.prototype._handle_server_update=function(t,e){var n,r,i;return t.dslist?(this._dslist_listener&&this._dslist_listener(t.dslist),e(null)):(i=t.handle,n=this._handle_to_dsid_map[i],null==n?(console.log("unknown handle "+i+" (maybe datastore was evicted)",t,this._handle_to_dsid_map,this._cached_objects),e(null)):(r=t.delta,null!=t.notfound?(this._evict(i),e(null)):this._retrieve(n,i,function(t,n){return t?e(t):(n.receive_server_delta(r),e(null))})))},t.prototype.open=function(t,e,n){return this._cached_objects[t]&&this._cached_objects[t].open(),this._retrieve(t,e,n)},t.prototype._retrieve=function(t,e,n){var r,i=this;return r=this._cached_objects[t],null!=r?n(null,r):(this._handle_to_dsid_map[e]=t,this.flob_client.get_snapshot(e,function(r,o){var s,a,u;return null!=r?n(r):null!=i._cached_objects[t]?n(null,i._cached_objects[t]):(s=p.from_get_snapshot_resp(o),u=new k,a=V.fresh_managed_datastore(t,e,s,o.rev,u,i.flob_client),i.update_manager.add_poll(e,a.sync_state.last_rev),i._cached_objects[t]=a,n(null,a))}))},t}(),ue.FieldOpTransformer=I=function(){function t(t){var i,o,s,a,l,h,c,f,p,m,_,y=this;for(this.rule_name=null!=t?t:"default",this.precedence=r[this.rule_name],this._transforms={},s=0,h=n.length;h>s;s++)o=n[s],this._transforms[o]={};for(_=["P","D"],a=0,c=_.length;c>a;a++)for(o=_[a],l=0,f=e.length;f>l;l++)i=e[l],this._transforms[o][i]=d,this._transforms[i][o]=g;for(m=0,p=e.length;p>m;m++)i=e[m],"LC"===i?this._transforms.LC.LC=function(){return[null,null]}:(this._transforms.LC[i]=g,this._transforms[i].LC=d);this._transforms.P.P=function(t,e){var n;return n=y.precedence(t.value,e.value),"left"===n?[t,null]:[null,e]},this._transforms.P.D=function(t,e){var n;return n=y.precedence(t.value,null),"left"===n?[t,null]:[null,e]},this._transforms.D.P=function(t,e){var n;return n=y.precedence(null,e.value),"left"===n?[t,null]:[null,e]},this._transforms.D.D=function(t,e){var n;return n=y.precedence(null,null),"left"===n?[t,null]:[null,e]},this._transforms.LP.LP=function(t,e){var n;return t.at!==e.at?[t,e]:(n=y.precedence(t.value,e.value),"left"===n?[t,null]:[null,e])},this._transforms.LP.LI=function(t,e){var n;return n=u(t),n.at+=e.before<=t.at?1:0,[n,e]},this._transforms.LP.LD=function(t,e){var n;return t.at===e.at?[null,e]:(n=u(t),n.at-=e.at<t.at?1:0,[n,e])},this._transforms.LP.LM=function(t,e){var n;return n=u(t),t.at===e.from?n.at=e.to:(n.at-=e.from<n.at?1:0,n.at+=e.to<=n.at?1:0),[n,e]},this._transforms.LI.LP=v(this._transforms.LP.LI),this._transforms.LI.LI=function(t,e){var n,r,i;return i=[u(t),u(e)],n=i[0],r=i[1],t.before<e.before?r.before+=1:n.before+=1,[n,r]},this._transforms.LI.LD=function(t,e){var n,r,i;return i=[u(t),u(e)],n=i[0],r=i[1],n.before-=e.at<t.before?1:0,r.at+=t.before<=e.at?1:0,[n,r]},this._transforms.LI.LM=function(t,e){var n,r,i,o;return o=[u(t),u(e)],r=o[0],i=o[1],t.before===e.to+1&&e.from<=e.to?[t,e]:t.before===e.to&&e.from>e.to?(r.before++,i.from++,[r,i]):(n=e.from<t.before?t.before-1:t.before,i.from+=t.before<=e.from?1:0,r.before=e.to<n?n+1:n,i.to+=n<=e.to?1:0,[r,i])},this._transforms.LD.LP=v(this._transforms.LP.LD),this._transforms.LD.LI=v(this._transforms.LI.LD),this._transforms.LD.LD=function(t,e){var n,r,i;return t.at===e.at?[null,null]:(i=[u(t),u(e)],n=i[0],r=i[1],t.at<e.at?r.at-=1:n.at-=1,[n,r])},this._transforms.LD.LM=function(t,e){var n,r,i;return t.at===e.from?(n=u(t),n.at=e.to,[n,null]):(i=[u(t),u(e)],n=i[0],r=i[1],n.at-=e.from<n.at?1:0,n.at+=e.to<=n.at?1:0,r.to+=r.from<r.to?1:0,r.from-=t.at<r.from?1:0,r.to-=t.at<r.to?1:0,r.to-=r.from<r.to?1:0,[n,r])},this._transforms.LM.LP=v(this._transforms.LP.LM),this._transforms.LM.LI=function(t,e){var n,r,i,o;return o=[u(t),u(e)],r=o[0],i=o[1],e.before===t.to+1&&t.from<=t.to?[t,e]:e.before===t.to&&t.from>t.to?(r.from++,r.to++,[r,i]):(n=t.from<e.before?e.before-1:e.before,r.from+=e.before<=t.from?1:0,i.before=t.to<n?n+1:n,r.to+=n<=t.to?1:0,[r,i])},this._transforms.LM.LD=v(this._transforms.LD.LM),this._transforms.LM.LM=function(t,e){var n,r,i,o,s,a,l,h,c,f,p;return t.from===e.from?t.to===e.to?[null,null]:e.from===e.to?[t,e]:(o=u(e),o.from=t.to,[null,o]):t.to===t.from?(i=u(t),i.from+=(e.to<=t.from)-(e.from<t.from),t.from===e.to&&e.from<e.to&&i.from--,i.to=i.from,[i,e]):e.to===e.from?(o=u(e),o.from+=(t.to<=e.from)-(t.from<e.from),o.to=o.from,[t,o]):(l=[u(t),u(e)],i=l[0],o=l[1],t.to===e.to&&t.from>t.to&&e.from>e.to?(i.to++,e.from>t.from?i.from++:o.from++,[i,o]):t.from===e.to&&e.from===t.to&&t.from<t.to?(o.from--,i.from++,[i,o]):t.from>t.to&&e.from<e.to&&e.to+1===t.to?[t,e]:(h=[t.to,t.from],s=h[0],n=h[1],s+=t.from<s?1:0,s-=e.from<s?1:0,s+=e.to<s?1:0,n-=e.from<n?1:0,n+=e.to<=n?1:0,s-=s>n?1:0,c=[e.to,e.from],a=c[0],r=c[1],a+=e.from<a?1:0,a-=t.from<a?1:0,a+=t.to<=a?1:0,r-=t.from<r?1:0,r+=t.to<=r?1:0,a-=a>r?1:0,f=[s,n],i.to=f[0],i.from=f[1],p=[a,r],o.to=p[0],o.from=p[1],[i,o]))
}}var e,n,r,i,o,s,a,u,l,h,c,f,p,d,g,v,m,_,y;for(v=function(t){return ae(null!=t),function(e,n){var r,i,o;return o=t(n,e),r=o[0],i=o[1],[i,r]}},i=["null","bool","num","str","blob","ts","list"],o={},h=_=0,y=i.length;y>_;h=++_)m=i[h],o[m]=h;return l=function(t){if(null==t)return"null";if(ie.is_bool(t))return"bool";if(null!=t.I||ie.is_number(t))return"num";if(ie.is_string(t))return"str";if(null!=t.B)return"blob";if(null!=t.T)return"ts";if(ie.is_array(t))return"list";throw new Error("Unrecognized value "+t)},p=function(t){return ie.is_number(t)||null!=t.I},s=function(t){return null!=t.I?parseInt(t.I):t},f=function(t,e){var n,r,i;for(n=r=0,i=t.length;i>=0?i>r:r>i;n=i>=0?++r:--r){if(n>=e.length)return!1;if(c(t[n],e[n]))return!0;if(c(e[n],t[n]))return!1}return e.length>t.length},t._is_less_than=c=function(t,e){var n,r;if(n=l(t),r=l(e),n!==r)return o[n]<o[r];if("null"===n)return!1;if("bool"===n)return e&&!t;if("num"===n)return null!=t.I&&null!=e.I?ue.int64_string_less_than(t.I,e.I):s(t)<s(e);if("str"===n)return e>t;if("blob"===n)return t.B<e.B;if("ts"===n)return parseInt(t.T,10)<parseInt(e.T,10);if("list"===n)return f(t,e);throw new Error("unknown type "+n)},t._compute_sum=a=function(t,e,n){var r,i,o,s,a,u;return r=null!=t.I&&null!=e.I&&null!=n.I,null!=t.I&&(t=parseInt(t.I)),null!=e.I&&(e=parseInt(e.I)),null!=n.I&&(n=parseInt(n.I)),s=0x8000000000000000,a=0x10000000000000000,u=0xfffffffffffff800,i=e-t,o=n+i,r&&(o>=s&&(o-=u),-s>o&&(o+=u),o={I:""+o}),o},g=function(t,e){return[null,e]},d=function(t){return[t,null]},n=["P","D","LC","LP","LI","LD","LM"],e=["LC","LP","LI","LD","LM"],t.copy=u=function(t){return D.from_array(JSON.parse(JSON.stringify(t)))},r={"default":function(){return"right"},remote:function(){return"right"},local:function(){return"left"},min:function(t,e){return c(t,e)?"left":"right"},max:function(t,e){return c(t,e)?"right":"left"},sum:function(){return"right"}},t.prototype.transform=function(t,e,n){var r,i,o,s,u;return null==n&&(n=null),"sum"===this.rule_name&&"P"===t.tag()&&"P"===e.tag()&&(null==n&&(n={I:"0"}),p(n)&&p(t.value)&&p(e.value))?(o=a(n,t.value,e.value),r=i=D.from_array(["P",o]),[r,i,e.value]):(s=this._transforms[t.tag()][e.tag()](t,e),u=function(){switch(e.tag()){case"P":return e.value;case"D":return null;default:return{L:!0}}}(),s.push(u),s)},t}(),ue.ChangeTransformer=u=function(){function t(){this._transform_rules={},this._default_transformer=new I}var e,n,r,i,o,s,u,l;for(e={},l=["default","local","remote","min","max","sum"],s=0,u=l.length;u>s;s++)r=l[s],e[r]=new I(r);return o=function(t){return ae(null!=t),function(e,n){var r,i,o;return o=t(n,e),r=o[0],i=o[1],[i,r]}},n=function(t){return t instanceof Array?t.slice():t},i=function(t,e){return t.tid===e.tid&&t.rowid===e.rowid},t.is_no_op=function(t){var e,n,r;if("U"!==t.tag())return!1;r=t.updates;for(n in r)return e=r[n],!1;return!0},t.compact=function(t){var e,n,r,i;for(e=[],r=0,i=t.length;i>r;r++)n=t[r],this.is_no_op(n)||e.push(n);return e},t.prototype.set_field_transformer=function(t,n,r){var i;return null==(i=this._transform_rules)[t]&&(i[t]={}),this._transform_rules[t][n]=e[r]},t.prototype.get_field_transformer=function(t,n){var r;return t in this._transform_rules?null!=(r=this._transform_rules[t][n])?r:this._default_transformer:e["default"]},t.prototype.transform_ii=function(t,e){var r,o,s;return i(t,e)?(r=function(t){var e,r,i,o,s;i={},s=t.fields;for(r in s)o=s[r],i[r]=D.from_array(["P",n(o)]);return e=a.from_array(["U",t.tid,t.rowid,i]),e.undo_extra={},e},o=r(t),s=r(e),this.transform_uu(o,s)):[[t],[e]]},t.prototype.transform_iu=function(t,e){return i(t,e)?ae(!1,"Couldn't have updated a row that hasn't been inserted yet!"):[[t],[e]]},t.prototype.transform_id=function(t,e){return i(t,e)?ae(!1,"Couldn't have deleted a row that hasn't been inserted yet!"):[[t],[e]]},t.prototype.transform_ui=o(t.prototype.transform_iu),t.prototype.transform_uu=function(t,e){var n,r,o,s,u,l,h,c,f,p,d,g,v,m,_,y,w,b,E;if(!i(t,e))return[[t],[e]];m=[{},{}],f=m[0],p=m[1],c={},_=t.updates;for(o in _)n=_[o],o in e.updates?(r=e.updates[o],d=null!=(w=t.undo_extra[o])?w:null,g=this.get_field_transformer(t.tid,o),b=g.transform(n,r,d),s=b[0],u=b[1],v=b[2],null!=s&&(f[o]=s,c[o]=null!=v?v:null),null!=u&&(p[o]=u)):(f[o]=n,c[o]=null!=(y=t.undo_extra[o])?y:null);E=e.updates;for(o in E)r=E[o],o in t.updates||(p[o]=r);return l=a.from_array(["U",t.tid,t.rowid,f]),l.undo_extra=c,h=a.from_array(["U",e.tid,e.rowid,p]),[[l],[h]]},t.prototype.transform_ud=function(t,e){return i(t,e)?[[],[e]]:[[t],[e]]},t.prototype.transform_di=o(t.prototype.transform_id),t.prototype.transform_du=o(t.prototype.transform_ud),t.prototype.transform_dd=function(t,e){return i(t,e)?[[],[]]:[[t],[e]]},t}(),ue.DefaultResolver=k=function(){function t(){this._change_transformer=new u}return t.prototype.add_resolution_rule=function(t,e,n){return this._change_transformer.set_field_transformer(t,e,n)},t.prototype._transform_one=function(t,e){var n,r,i,o,s;return n=function(t){switch(t.tag()){case"I":return"i";case"U":return"u";case"D":return"d";default:throw new Error("unrecognized op type "+t.tag())}},o="transform_"+n(t)+n(e),s=this._change_transformer[o](t,e),r=s[0],i=s[1],r=u.compact(r),i=u.compact(i),[r,i]},t.prototype._transform_list=function(t,e){var n,r,i,o,s,a,u,l,h,c,f,p,d,g;if(0===t.length)return[[],e];if(0===e.length)return[t,[]];for(n=t[0],r=e[0],p=this._transform_one(n,r),o=p[0],s=p[1],d=this._transform_list(t.slice(1),s),i=d[0],s=d[1],l=0,c=i.length;c>l;l++)a=i[l],o.push(a);for(g=this._transform_list(o,e.slice(1)),o=g[0],u=g[1],h=0,f=u.length;f>h;h++)a=u[h],s.push(a);return[o,s]},t.prototype._resolve=function(t,e){var n,r,i,o,s,a,u;for(o=e.slice(),r=[],s=0,a=t.length;a>s;s++)i=t[s],u=this._transform_list(i,o),n=u[0],o=u[1],r.push(n);return[r,o]},t.prototype.resolve=function(t,e){var n,r,i,o,s,u,l,h,c,f,p,d,g,v,m,_,y,w,b,E,x,S,A,T,k,O,N,L,R,C,D,I;for(p=[],_=0,E=t.length;E>_;_++){for(h=t[_],r=[],C=h.changes,f=y=0,x=C.length;x>y;f=++y)o=C[f],u=a.from_array(JSON.parse(JSON.stringify(o))),u.undo_extra=ue.clone(h.undo_extras[f]),r.push(u);p.push(r)}for(v=[],w=0,S=e.length;S>w;w++)for(h=e[w],D=h.changes,b=0,A=D.length;A>b;b++)i=D[b],v.push(i);for(I=this._resolve(p,v),d=I[0],l=I[1],g=[],f=N=0,T=d.length;T>N;f=++N){for(s=d[f],m=null,c=t[f].finalized,L=0,k=s.length;k>L;L++)o=s[L],delete o.undo_extra;s.length>0&&g.push(new q(s,m,c))}for(n={},R=0,O=l.length;O>R;R++)i=l[R],i.tid in n||(n[i.tid]={}),n[i.tid][i.rowid]=!0;return{rebased_deltas:g,affected_records:n}},t}(),ne=function(){function t(){this._waiting=[],this._running=!1}return t.prototype._run_next=function(){var t;this._running||this._waiting.length>0&&(t=this._waiting[0],this._waiting.shift(),this._running=!0,t())},t.prototype.request=function(t){return this._waiting.push(t),this._run_next()},t.prototype.finish=function(){return this._running=!1,setTimeout(this._run_next.bind(this),0)},t}(),l=function(){function t(t){this.consumer=t,this.items=[],this.sync_queue=new ne}return t.prototype.consume=function(){var t=this;return this.sync_queue.request(function(){var e;return 0===t.items.length?t.sync_queue.finish():(e=t.items.shift(),t.consumer(e,function(e){if(e)throw e;return t.sync_queue.finish(),t.consume()}))})},t.prototype.push=function(t){return this.items.push(t),this.consume()},t.prototype.run=function(){return this.consume()},t}(),ue.clone=function(t){var e,n,r,i,o,s,a;if(t instanceof Array){for(a=[],o=0,s=t.length;s>o;o++)e=t[o],a.push(ue.clone(e));return a}if(null!=t&&"object"==typeof t){r={};for(n in t)i=t[n],r[n]=ue.clone(i);return r}return t},ue.WEB64_ALPHABET="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",ue.randomElement=function(t){return t[Math.floor(Math.random()*t.length)]},ue.randomWeb64String=function(t){var e;return function(){var n,r;for(r=[],e=n=0;t>=0?t>n:n>t;e=t>=0?++n:--n)r.push(ue.randomElement(ue.WEB64_ALPHABET));return r}().join("")},ue.uint8ArrayFromBase64String=function(t){var e,n,r,i,o;for(t=t.replace("-","+").replace("_","/"),e=L.Util.atob(t),r=e.length,i=new Uint8Array(r),n=o=0;r>=0?r>o:o>r;n=r>=0?++o:--o)i[n]=e.charCodeAt(n);return i},ue.dbase64FromBase64=function(t){return t.replace(/[+]/g,"-").replace(/[/]/g,"_").replace(/[\=]+$/g,"")},ue.base64StringFromUint8Array=function(t){var e,n,r,i,o;for(n="",i=0,o=t.length;o>i;i++)e=t[i],n+=String.fromCharCode(e);return r=L.Util.btoa(n),ue.dbase64FromBase64(r)},ue.INT64_TAG="dbxInt64",ue.isInt64=function(t){var e;return t&&"object"==typeof t&&t.constructor===Number&&isFinite(t)?(e=t[ue.INT64_TAG],!ie.is_string(e)||"0"!==e&&!ue.nonzero_int64_approximate_regex.test(e)?!1:!0):!1},ue.validateInt64=function(t){var e,n;if(!t&&"object"==typeof t&&t.constructor===Number&&isFinite(t))throw new Error("Not a finite boxed number: "+t);if(n=t[ue.INT64_TAG],!ie.is_string(n)||"0"!==n&&!ue.nonzero_int64_approximate_regex.test(n))throw new Error("Missing or invalid tag in int64: "+n);if(e=parseInt(n,10),e!==Number(t))throw new Error("Tag in int64 does not match value "+Number(t)+": "+n);return t},ue.toDsValue=function(t,e){var n,r;if(null==e&&(e=!0),null===t||"undefined"==typeof t)throw new Error("Bad value: "+t);if(ie.is_string(t))return t;if(ie.is_bool(t))return t;if(ie.is_number(t)){if(null!=t[ue.INT64_TAG])return ue.validateInt64(t),{I:t[ue.INT64_TAG]};if(isFinite(t))return t;if(isNaN(t))return{N:"nan"};if(1/0===Number(t))return{N:"+inf"};if(Number(t)===-1/0)return{N:"-inf"};throw new Error("Unexpected number: "+t)}if(ie.is_array(t)){if(e)return function(){var e,n,i;for(i=[],e=0,n=t.length;n>e;e++)r=t[e],i.push(ue.toDsValue(r,!1));return i}();throw new Error("Nested array not allowed: "+JSON.stringify(t))}if(ie.is_date(t))return n=Math.round(t.getTime()),{T:""+n};if(ie.isUint8Array(t))return{B:ue.base64StringFromUint8Array(t)};throw new Error("Unexpected object: "+JSON.stringify(t))},ue.fromDsValue=function(t,e,n,r){if(ie.is_string(r))return r;if(ie.is_bool(r))return r;if(ie.is_number(r))return r;if(ie.is_array(r))return new L.Datastore.List(t,e,n);if("object"!=typeof r)throw new Error("Unexpected value: "+r);if(null!=r.I)return L.Datastore.int64(r.I);if(null==r.N){if(null!=r.B)return ue.uint8ArrayFromBase64String(r.B);if(null!=r.T)return new Date(parseInt(r.T,10));throw new Error("Unexpected object: "+JSON.stringify(r))}switch(r.N){case"nan":return 0/0;case"+inf":return 1/0;case"-inf":return-1/0;default:throw new Error("Unexpected object: "+JSON.stringify(r))}},ue.matchDsValues=function(t,e){var n,r,i,o,s;r=function(t,e){if(null==t)throw new Error("Unexpected object: "+t);return null==e?!1:n(t,e)},n=function(t,e){var n,i,o,s,a,u;if(ue.toDsValue(t),ie.is_string(t)&&ie.is_string(e))return String(t)===String(e);if(ie.is_bool(t)&&ie.is_bool(e))return"object"==typeof t&&(t=t.valueOf()),"object"==typeof e&&(e=e.valueOf()),Boolean(t)===Boolean(e);if(ie.is_number(t)&&(ie.is_number(e)||null!=e.N||null!=e.I))return e=ue.fromDsValue(void 0,void 0,void 0,e),t[ue.INT64_TAG]&&e[ue.INT64_TAG]?(s=[L.Datastore.int64(t),L.Datastore.int64(e)],t=s[0],e=s[1],String(t[ue.INT64_TAG])===String(e[ue.INT64_TAG])):isNaN(t)&&isNaN(e)?!0:Number(t)===Number(e);if(ie.is_array(t)&&ie.is_array(e)){if(t.length!==e.length)return!1;for(n=i=0,a=t.length-1;a>=0?a>=i:i>=a;n=a>=0?++i:--i)if(!r(t[n],e[n]))return!1;return!0}if(ie.is_date(t)&&(ie.is_date(e)||null!=e.T))return null!=e.T&&(e=ue.fromDsValue(void 0,void 0,void 0,e)),t-0===e-0;if(ie.isUint8Array(t)&&(ie.isUint8Array(e)||null!=e.B)){if(null!=e.B&&(e=ue.fromDsValue(void 0,void 0,void 0,e)),t.length!==e.length)return!1;for(n=o=0,u=t.length-1;u>=0?u>=o:o>=u;n=u>=0?++o:--o)if(t[n]!==e[n])return!1;return!0}return!1};for(i in t)if(s=t[i],o=r(s,e[i]),!o)return o;return!0},Q=function(){function t(t){this._datastore=t,this._cache={}}return t.prototype.get=function(t,e){return null==this._cache[t]?null:this._cache[t][e]},t.prototype.getOrCreate=function(t,e){var n;return null==this._cache[t]&&(this._cache[t]={}),n=this._cache[t][e],null==n&&(n=this._cache[t][e]=new L.Datastore.Record(this._datastore,t,e)),n},t.prototype.remove=function(t,e){return delete this._cache[t][e],void(ie.is_empty(this._cache[t])&&delete this._cache[t])},t}(),R=function(){function t(){this._registered_handlers=[]}return t.prototype.register=function(t,e){return t.addListener(e),void this._registered_handlers.push([t,e])},t.prototype.unregister_all=function(){var t,e,n,r,i,o;for(i=this._registered_handlers,n=0,r=i.length;r>n;n++)o=i[n],e=o[0],t=o[1],e.removeListener(t);return void 0},t}(),L.Datastore.DatastoreInfo=function(){function t(t,e,n){this._dsid=t,this._handle=e,this._info_record_data=n}return t.prototype.toString=function(){return"Datastore.DatastoreInfo("+this._dsid+")"},t.prototype.getId=function(){return this._dsid},t.prototype.getHandle=function(){return this._handle},t.prototype.getTitle=function(){var t;return null!=(t=this._info_record_data)?t.title:void 0},t.prototype.getModifiedTime=function(){var t;return null!=(t=this._info_record_data)?t.mtime:void 0},t}(),L.Datastore.DatastoreListChanged=function(){function t(t){this._dsinfos=t}return t.prototype.toString=function(){return"Datastore.DatastoreListChanged("+this._dsinfos.length+" datastores)"},t.prototype.getDatastoreInfos=function(){return this._dsinfos},t}(),L.Datastore.impl.EventSourceWithInitialData=function(t){function e(t){this.options=t,e.__super__.constructor.call(this,t),this._have_event=!1,this._last_event=null,this._listenersChanged=new L.Util.EventSource}return fe(e,t),e.prototype._clearLastEvent=function(){return this._have_event=!1,this._last_event=null},e.prototype.addListener=function(t){var n;return n=e.__super__.addListener.call(this,t),this._have_event&&t(event),this._listenersChanged.dispatch(this._listeners),n},e.prototype.removeListener=function(t){var n;return n=e.__super__.removeListener.call(this,t),this._listenersChanged.dispatch(this._listeners),n},e.prototype.dispatch=function(t){return this._last_event=t,this._have_event=!0,e.__super__.dispatch.call(this,t)},e}(L.Util.EventSource),c="default",L.Datastore.DatastoreManager=function(){function t(t){var e=this;if(!t.isAuthenticated())throw new Error("DatastoreManager requires an authenticated Dropbox.Client!");this._flob_client=new U(t),this._datasync=new d(this._flob_client),this._dslist_initialized=!1,this.datastoreListChanged=new L.Datastore.impl.EventSourceWithInitialData,this.datastoreListChanged._listenersChanged.addListener(function(t){return 0!==t.length?e._init_live_dslist():void 0})}return t.prototype.datastoreListChanged=null,t.prototype.close=function(){return this._datasync.close()},t.prototype.toString=function(){return"Datastore.DatastoreManager()"},t.prototype._datastoreInfoFromListDatastoresResponseItem=function(t){var e,n,r,i,o;if(null!=t.info){e={},o=t.info;for(n in o)i=o[n],e[n]=ie.is_array(i)?function(){var t,e,n;for(n=[],t=0,e=i.length;e>t;t++)r=i[t],n.push(ue.fromDsValue(null,null,null,r));return n}():ue.fromDsValue(null,null,null,i)}else e=null;return new L.Datastore.DatastoreInfo(t.dsid,t.handle,e)},t.prototype._getDatastoreInfosFromListResponse=function(t){var e;return function(){var n,r,i,o;for(i=t.datastores,o=[],n=0,r=i.length;r>n;n++)e=i[n],o.push(this._datastoreInfoFromListDatastoresResponseItem(e));return o}.call(this)},t.prototype._init_live_dslist=function(){var t,e=this;return this._dslist_initialized?void 0:(this._dslist_initialized=!0,t=function(t){return e.datastoreListChanged.dispatch(new L.Datastore.DatastoreListChanged(e._getDatastoreInfosFromListResponse(t)))},this._datasync.obj_manager.set_dslist_listener(t),this._flob_client.list_dbs(function(e,n){return e?void console.warn("Failed to get datastore list"):t(n)}))},t.prototype._wrapDatastore=function(t,e){return e&&(t._update_mtime(),t.sync()),new L.Datastore(this,t)},t.prototype._getOrCreateDatastoreByDsid=function(t,e){var n=this;return void this._datasync.get_or_create(t,function(t,r,i){return null!=t?e(t):e(null,n._wrapDatastore(r,i))})},t.prototype._createDatastore=function(t,e,n){var r=this;return void this._datasync.create(t,e,function(t,e,i){return null!=t?n(t):n(null,r._wrapDatastore(e,i))})},t.prototype._getExistingDatastoreByDsid=function(t,e){var n=this;return void this._datasync.get_by_dsid(t,function(t,r){return null!=t?e(t):e(null,new L.Datastore(n,r))})},t.prototype.openDefaultDatastore=function(t){return this._getOrCreateDatastoreByDsid(c,t)},t.prototype.openDatastore=function(t,e){return void this._getExistingDatastoreByDsid(t,e)},t.prototype.createDatastore=function(t){var e,n;return n=ue.randomWeb64String(Math.ceil(256/6)),e="."+ue.dbase64FromBase64(L.Util.sha256(n)),void this._createDatastore(e,n,t)},t.prototype.deleteDatastore=function(t,e){var n=this;return void this._flob_client.get_db(t,function(t,r){return null!=t?e(t):n._flob_client.delete_db(r.handle,function(t){return e(t?t:null)})})},t.prototype.listDatastores=function(t){var e=this;return this.datastoreListChanged._have_event?t(null,this.datastoreListChanged._last_event.getDatastoreInfos()):void this._flob_client.list_dbs(function(n,r){return n?t(n):t(null,e._getDatastoreInfosFromListResponse(r))})},t}(),L.Datastore.List=function(){function t(t,e,n){this._datastore=t,this._record=e,this._field=n}return t.prototype.toString=function(){return"Datastore.List(("+this._record._tid+", "+this._record._rid+", "+this._field+"): "+JSON.stringify(this._array)+")"},t.prototype._array=function(){return this._record._rawFieldValues()[this._field]},t.prototype._checkValid=function(){if(this._record._checkNotDeleted(),!ie.is_array(this._array()))throw new Error("Attempt to operate on deleted list ("+this._record._tid+", "+this._record._rid+", "+this._field+")")},t.prototype._storeUpdate=function(t){var e;return e={},e[this._field]=t,void this._record._storeUpdate(e)},t.prototype._fixInsertionIndex=function(t){var e,n;if(!ie.is_json_number(t))throw new RangeError("Index not a number: "+t);if(e=this._array().length,n=t>=0?t:e+t,n>=0&&e>=n)return n;throw new RangeError("Bad index for list of length "+e+": "+t)},t.prototype._fixIndex=function(t){var e,n;if(n=this._fixInsertionIndex(t),e=this._array().length,e>n)return n;throw new RangeError("Bad index for list of length "+e+": "+t)},t.prototype.get=function(t){var e;return this._checkValid(),e=ue.clone(this._array()[this._fixIndex(t)]),ue.fromDsValue(void 0,void 0,void 0,e)},t.prototype.set=function(t,e){return this._checkValid(),t=this._fixIndex(t),void this._storeUpdate(["LP",t,ue.toDsValue(e,!1)])},t.prototype.length=function(){return this._checkValid(),this._array().length},t.prototype.pop=function(){if(this._checkValid(),0===this._array().length)throw new Error("List is empty");return this.remove(this._array.length-1)},t.prototype.push=function(t){return this._checkValid(),void this.insert(this._array().length,t)},t.prototype.shift=function(){if(this._checkValid(),0===this._array().length)throw new Error("List is empty");return this.remove(0)},t.prototype.unshift=function(t){return void this.insert(0,t)},t.prototype.splice=function(){var t,e,n,r,i,o,s,a,u;if(r=arguments[0],e=arguments[1],t=3<=arguments.length?pe.call(arguments,2):[],this._checkValid(),!ie.is_json_number(e)||0>e)throw new RangeError("Bad second arg to splice: "+r+", "+e);for(r=this._fixInsertionIndex(r),i=this.slice(r,r+e),n=s=0;e>=0?e>s:s>e;n=e>=0?++s:--s)this.remove(r);for(a=0,u=t.length;u>a;a++)o=t[a],this.insert(r,o),r++;return i},t.prototype.move=function(t,e){return this._checkValid(),t=this._fixIndex(t),e=this._fixIndex(e),t===e?void 0:void this._storeUpdate(["LM",t,e])},t.prototype.remove=function(t){var e;return this._checkValid(),t=this._fixIndex(t),e=this.get(t),this._storeUpdate(["LD",t]),e},t.prototype.insert=function(t,e){return this._checkValid(),t=this._fixInsertionIndex(t),void this._storeUpdate(["LI",t,ue.toDsValue(e,!1)])},t.prototype.slice=function(t,e){var n;return this._checkValid(),function(){var r,i,o,s;for(o=this._array().slice(t,e),s=[],r=0,i=o.length;i>r;r++)n=o[r],s.push(ue.fromDsValue(void 0,void 0,void 0,n));return s}.call(this)},t.prototype.toArray=function(){var t;return this._checkValid(),function(){var e,n,r,i;for(r=this._array().slice(),i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(ue.fromDsValue(void 0,void 0,void 0,t));return i}.call(this)},t}(),L.Datastore.Record=function(){function t(t,e,n){this._datastore=t,this._tid=e,this._rid=n,this._deleted=!1,this._record_cache=this._datastore._record_cache,this._managed_datastore=this._datastore._managed_datastore}return t.prototype.get=function(t){var e;return this._checkNotDeleted(),e=this._rawFieldValues(),t in e?ue.fromDsValue(this._datastore,this,t,e[t]):null},t.prototype.set=function(t,e){var n;return n={},n[t]=e,this.update(n)},t.prototype.getOrCreateList=function(t){var e,n;if(this._checkNotDeleted(),n=this._rawFieldValues(),null==n[t])e={},e[t]=["LC"],this._storeUpdate(e),n=this._rawFieldValues();else if(!ie.is_array(n[t]))throw new Error("Can't call getOrCreateList on field "+t+" for record ("+this.tid+", "+this.rid+"): existing value "+n[t]+" is not a list");return ue.fromDsValue(this._datastore,this,t,n[t])},t.prototype.getFields=function(){var t,e,n,r;this._checkNotDeleted(),t={},r=this._rawFieldValues();for(e in r)n=r[e],t[e]=ue.fromDsValue(this._datastore,this,e,n);return t},t.prototype.update=function(t){var e,n,r;this._checkNotDeleted(),e={};for(n in t)r=t[n],null!=r?e[n]=["P",ue.toDsValue(r)]:null!=this.get(n)&&(e[n]=["D"]);return ie.is_empty(e)||this._storeUpdate(e),this},t.prototype.deleteRecord=function(){var t;return this._checkNotDeleted(),this._deleted=!0,this._record_cache.remove(this._tid,this._rid),t=d.changeFromArray(["D",this._tid,this._rid]),this._managed_datastore.perform_local_change(t),this._datastore._recordsChangedLocally([this]),this},t.prototype.has=function(t){var e;return this._checkNotDeleted(),e=this._rawFieldValues(),t in e},t.prototype.getId=function(){return this._rid},t.prototype.getTable=function(){return this._datastore.getTable(this._tid)},t.prototype.isDeleted=function(){return this._deleted},t.prototype.toString=function(){var t;return t=this.isDeleted()?"deleted":JSON.stringify(this.getFields()),"Datastore.Record(("+this._tid+", "+this._rid+"): "+t+")"},t.prototype._rawFieldValues=function(){return this._managed_datastore.query(this._tid,this._rid)},t.prototype._storeUpdate=function(t){var e;e=d.changeFromArray(["U",this._tid,this._rid,t]),this._managed_datastore.perform_local_change(e),this._datastore._recordsChangedLocally([this])},t.isValidId=function(t){var e;return e=new RegExp(ie.SS_ID_REGEX),ie.is_string(t)&&e.test(t)},t.prototype._checkNotDeleted=function(){if(this._deleted)throw new Error("Attempt to operate on deleted record ("+this._tid+", "+this._rid+")")},t}(),L.Datastore.RecordsChanged=function(){function t(t,e){this._recordsByTable=t,this._local=e}return t.prototype.toString=function(){var t,e,n,r,i,o,s;i=0,n=0,s=this._recordsByTable;for(o in s)t=s[o],i+=1,n+=t.length;return r=""+i+" "+(1===i?"table":"tables"),e=""+n+" "+(1===n?"record":"records"),"Datastore.RecordsChanged("+e+" in "+r+" changed "+(this._local?"locally":"remotely")+")"},t._fromRecordList=function(e,n){var r,i,o,s,a;for(i={},s=0,a=e.length;a>s;s++)r=e[s],o=r._tid,null==i[o]&&(i[o]=[]),i[o].push(r);return new t(i,n)},t.prototype.affectedRecordsByTable=function(){return this._recordsByTable},t.prototype.affectedRecordsForTable=function(t){var e;return null!=(e=this._recordsByTable[t])?e:[]},t.prototype.isLocal=function(){return this._local},t}(),Z=L.Datastore.RecordsChanged,L.Datastore.Table=function(){function t(t,e){this._datastore=t,this._tid=e,this._record_cache=this._datastore._record_cache,this._managed_datastore=this._datastore._managed_datastore}return t.prototype.getId=function(){return this._tid},t.prototype.get=function(t){var e,n;if(!L.Datastore.Record.isValidId(t))throw new Error("Invalid record ID: "+t);return n=this._record_cache.get(this._tid,t),null!=n?(ae(!n._deleted),n):(e=this._managed_datastore.query(this._tid,t),null==e?null:this._record_cache.getOrCreate(this._tid,t))},t.prototype.getOrInsert=function(t,e){var n;return n=this.get(t),n?n:this._insertWithId(t,e)},t.prototype.insert=function(t){var e;return e=this._datastore._generateRid(),ae(null==this.get(e)),this._insertWithId(e,t)},t.prototype.query=function(t){var e,n,r,i,o,s,a;for(o=this._managed_datastore.list_rows_for_table(this._tid),r=[],s=0,a=o.length;a>s;s++)i=o[s],e=this._managed_datastore.query(this._tid,i),(null==t||ue.matchDsValues(t,e))&&(n=this.get(i),ae(null!=n),r.push(n));return r},t.prototype.setResolutionRule=function(t,e){if("remote"!==e&&"local"!==e&&"min"!==e&&"max"!==e&&"sum"!==e)throw new Error(""+e+" is not a valid resolution rule. Valid rules are 'remote', 'local', 'min', 'max', and 'sum'.");return this._managed_datastore.resolver.add_resolution_rule(this._tid,t,e),this},t.isValidId=function(t){var e;return e=new RegExp(ie.SS_ID_REGEX),ie.is_string(t)&&e.test(t)},t.prototype.toString=function(){return"Datastore.Table("+this._tid+")"},t.prototype._insertWithId=function(t,e){var n,r,i,o,s;r={};for(i in e)s=e[i],r[i]=ue.toDsValue(s);return n=d.changeFromArray(["I",this._tid,t,r]),this._managed_datastore.perform_local_change(n),o=this._record_cache.getOrCreate(this._tid,t),this._datastore._recordsChangedLocally([o]),o},t}(),L.File.ShareUrl=function(){function t(t,e){this.url=t.url,this.expiresAt=L.Util.parseDate(t.expires),this.isDirect=e===!0?!0:e===!1?!1:"direct"in t?t.direct:Date.now()-this.expiresAt<=864e5,this.isPreview=!this.isDirect,this._json=null}return t.parse=function(t,e){return t&&"object"==typeof t?new L.File.ShareUrl(t,e):t},t.prototype.url=null,t.prototype.expiresAt=null,t.prototype.isDirect=null,t.prototype.isPreview=null,t.prototype.json=function(){return this._json||(this._json={url:this.url,expires:this.expiresAt.toUTCString(),direct:this.isDirect})},t}(),L.File.CopyReference=function(){function t(t){"object"==typeof t?(this.tag=t.copy_ref,this.expiresAt=L.Util.parseDate(t.expires),this._json=t):(this.tag=t,this.expiresAt=new Date(1e3*Math.ceil(Date.now()/1e3)),this._json=null)}return t.parse=function(t){return!t||"object"!=typeof t&&"string"!=typeof t?t:new L.File.CopyReference(t)},t.prototype.tag=null,t.prototype.expiresAt=null,t.prototype.json=function(){return this._json||(this._json={copy_ref:this.tag,expires:this.expiresAt.toUTCString()})},t}(),L.File.Stat=function(){function t(t){var e,n,r,i;switch(this._json=t,this.path=t.path,"/"!==this.path.substring(0,1)&&(this.path="/"+this.path),e=this.path.length-1,e>=0&&"/"===this.path.substring(e)&&(this.path=this.path.substring(0,e)),n=this.path.lastIndexOf("/"),this.name=this.path.substring(n+1),this.isFolder=t.is_dir||!1,this.isFile=!this.isFolder,this.isRemoved=t.is_deleted||!1,this.typeIcon=t.icon,this.modifiedAt=(null!=(r=t.modified)?r.length:void 0)?L.Util.parseDate(t.modified):null,this.clientModifiedAt=(null!=(i=t.client_mtime)?i.length:void 0)?L.Util.parseDate(t.client_mtime):null,t.root){case"dropbox":this.inAppFolder=!1;break;case"app_folder":this.inAppFolder=!0;break;default:this.inAppFolder=null}this.size=t.bytes||0,this.humanSize=t.size||"",this.hasThumbnail=t.thumb_exists||!1,this.versionTag=t.rev,this.contentHash=t.hash||null,this.mimeType=this.isFolder?t.mime_type||"inode/directory":t.mime_type||"application/octet-stream"}return t.parse=function(t){return t&&"object"==typeof t?new L.File.Stat(t):t},t.prototype.path=null,t.prototype.name=null,t.prototype.inAppFolder=null,t.prototype.isFolder=null,t.prototype.isFile=null,t.prototype.isRemoved=null,t.prototype.typeIcon=null,t.prototype.versionTag=null,t.prototype.contentHash=null,t.prototype.mimeType=null,t.prototype.size=null,t.prototype.humanSize=null,t.prototype.hasThumbnail=null,t.prototype.modifiedAt=null,t.prototype.clientModifiedAt=null,t.prototype.json=function(){return this._json},t}(),L.Http.AppInfo=function(){function t(t,e){var n;this.name=t.name,this._icons=t.icons,n=t.permissions||{},this.canUseDatastores=!!n.datastores,this.canUseFiles=!!n.files,this.canUseFullDropbox="full_dropbox"===n.files,this.hasAppFolder="app_folder"===n.files,this.key=e?e:t.key||null}return t.parse=function(t,e){return t?new L.Http.AppInfo(t,e):t},t.prototype.name=void 0,t.prototype.key=void 0,t.prototype.canUseDatastores=void 0,t.prototype.canUseFiles=void 0,t.prototype.hasAppFolder=void 0,t.prototype.canUseFullDropbox=void 0,t.prototype.icon=function(t,e){return e||(e=t),this._icons[""+t+"x"+e]||null},t.ICON_SMALL=64,t.ICON_LARGE=256,t}(),L.Http.PulledChanges=function(){function t(t){var e;this.blankSlate=t.reset||!1,this.cursorTag=t.cursor,this.shouldPullAgain=t.has_more,this.shouldBackOff=!this.shouldPullAgain,this.changes=t.cursor&&t.cursor.length?function(){var n,r,i,o;for(i=t.entries,o=[],n=0,r=i.length;r>n;n++)e=i[n],o.push(L.Http.PulledChange.parse(e));return o}():[]}return t.parse=function(t){return t&&"object"==typeof t?new L.Http.PulledChanges(t):t},t.prototype.blankSlate=void 0,t.prototype.cursorTag=void 0,t.prototype.changes=void 0,t.prototype.shouldPullAgain=void 0,t.prototype.shouldBackOff=void 0,t.prototype.cursor=function(){return this.cursorTag},t}(),L.Http.PulledChange=function(){function t(t){this.path=t[0],this.stat=L.File.Stat.parse(t[1]),this.stat?this.wasRemoved=!1:(this.stat=null,this.wasRemoved=!0)}return t.parse=function(t){return t&&"object"==typeof t?new L.Http.PulledChange(t):t},t.prototype.path=void 0,t.prototype.wasRemoved=void 0,t.prototype.stat=void 0,t}(),L.Http.RangeInfo=function(){function t(t){var e;(e=/^bytes (\d*)-(\d*)\/(.*)$/.exec(t))?(this.start=parseInt(e[1]),this.end=parseInt(e[2]),this.size="*"===e[3]?null:parseInt(e[3])):(this.start=0,this.end=0,this.size=null)}return t.parse=function(t){return"string"==typeof t?new L.Http.RangeInfo(t):t},t.prototype.start=null,t.prototype.size=null,t.prototype.end=null,t}(),L.Http.UploadCursor=function(){function t(t){this.replace(t)}return t.parse=function(t){return!t||"object"!=typeof t&&"string"!=typeof t?t:new L.Http.UploadCursor(t)},t.prototype.tag=null,t.prototype.offset=null,t.prototype.expiresAt=null,t.prototype.json=function(){return this._json||(this._json={upload_id:this.tag,offset:this.offset,expires:this.expiresAt.toUTCString()})},t.prototype.replace=function(t){return"object"==typeof t?(this.tag=t.upload_id||null,this.offset=t.offset||0,this.expiresAt=L.Util.parseDate(t.expires)||Date.now(),this._json=t):(this.tag=t||null,this.offset=0,this.expiresAt=new Date(1e3*Math.floor(Date.now()/1e3)),this._json=null),this},t}(),"function"==typeof L.Env.global.atob&&"function"==typeof L.Env.global.btoa?(L.Util.atob=function(t){return L.Env.global.atob(t)},L.Util.btoa=function(t){return L.Env.global.btoa(t)}):L.Env.global.require&&L.Env.global.Buffer?(L.Util.atob=function(t){var e,n;return e=new i(t,"base64"),function(){var t,r,i;for(i=[],n=t=0,r=e.length;r>=0?r>t:t>r;n=r>=0?++t:--t)i.push(String.fromCharCode(e[n]));return i}().join("")},L.Util.btoa=function(t){var e,n;return e=new i(function(){var e,r,i;for(i=[],n=e=0,r=t.length;r>=0?r>e:e>r;n=r>=0?++e:--e)i.push(t.charCodeAt(n));return i}()),e.toString("base64")}):function(){var t,e,n;return e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=function(t,n,r){var i,o;for(o=3-n,t<<=8*o,i=3;i>=o;)r.push(e.charAt(63&t>>6*i)),i-=1;for(i=n;3>i;)r.push("="),i+=1;return null},t=function(t,e,n){var r,i;for(i=4-e,t<<=6*i,r=2;r>=i;)n.push(String.fromCharCode(255&t>>8*r)),r-=1;return null},L.Util.btoa=function(t){var e,r,i,o,s,a;for(o=[],e=0,r=0,i=s=0,a=t.length;a>=0?a>s:s>a;i=a>=0?++s:--s)e=e<<8|t.charCodeAt(i),r+=1,3===r&&(n(e,r,o),e=r=0);return r>0&&n(e,r,o),o.join("")},L.Util.atob=function(n){var r,i,o,s,a,u,l;for(a=[],r=0,o=0,s=u=0,l=n.length;(l>=0?l>u:u>l)&&(i=n.charAt(s),"="!==i);s=l>=0?++u:--u)r=r<<6|e.indexOf(i),o+=1,4===o&&(t(r,o,a),r=o=0);return o>0&&t(r,o,a),a.join("")}}(),function(){var t,e,n,r,i,o,s,a,u,l,h;if(L.Util.hmac=function(e,r){return t(n(u(e),u(r),e.length,r.length))},L.Util.sha1=function(e){return t(i(u(e),e.length))},L.Util.sha256=function(e){return t(o(u(e),e.length))
},L.Env.require)try{e=L.Env.require("crypto"),e.createHmac&&e.createHash&&(L.Util.hmac=function(t,n){var r;return r=e.createHmac("sha1",n),r.update(t),r.digest("base64")},L.Util.sha1=function(t){var n;return n=e.createHash("sha1"),n.update(t),n.digest("base64")},L.Util.sha256=function(t){var n;return n=e.createHash("sha256"),n.update(t),n.digest("base64")})}catch(c){r=c}return n=function(t,e,n,r){var o,s,a,u;return e.length>16&&(e=i(e,r)),a=function(){var t,n;for(n=[],s=t=0;16>t;s=++t)n.push(909522486^e[s]);return n}(),u=function(){var t,n;for(n=[],s=t=0;16>t;s=++t)n.push(1549556828^e[s]);return n}(),o=i(a.concat(t),64+n),i(u.concat(o),84)},i=function(t,e){var n,r,i,o,s,a,u,l,h,c,f,p,d,g,v,m,_;for(t[e>>2]|=1<<31-((3&e)<<3),t[(e+8>>6<<4)+15]=e<<3,v=Array(80),n=1732584193,i=4023233417,s=2562383102,u=271733878,h=3285377520,f=0,d=t.length;d>f;){for(r=n,o=i,a=s,l=u,c=h,p=_=0;80>_;p=++_)16>p?v[p]=0|t[f+p<<2>>2]:(g=(0|v[p-3<<2>>2])^(0|v[p-8<<2>>2])^(0|v[p-14<<2>>2])^(0|v[p-16<<2>>2]),v[p]=g<<1|g>>>31),m=0|(0|(n<<5|n>>>27)+h)+v[p<<2>>2],m=20>p?0|m+(0|(i&s|~i&u)+1518500249):40>p?0|m+(0|(i^s^u)+1859775393):60>p?0|(0|m+((i&s|i&u|s&u)-1894007588)):0|m+(0|(i^s^u)-899497514),h=u,u=s,s=i<<30|i>>>2,i=n,n=m;n=0|r+n,i=0|o+i,s=0|a+s,u=0|l+u,h=0|c+h,f=0|f+16}return[n,i,s,u,h]},o=function(t,e){var n,r,i,o,u,l,h,c,f,p,d,g,v,m,_,y,w,b,E,x,S,A,T,k,O,N,L,R,C,D,I,U;for(t[e>>2]|=1<<31-((3&e)<<3),t[(e+8>>6<<4)+15]=e<<3,C=Array(80),n=s[0],i=s[1],u=s[2],c=s[3],p=s[4],g=s[5],m=s[6],x=s[7],A=0,k=t.length;k>A;){for(r=n,o=i,l=u,f=c,d=p,v=g,_=m,S=x,T=U=0;64>U;T=++U)16>T?R=C[T]=0|t[A+T<<2>>2]:(w=0|C[T-15<<2>>2],y=(w<<25|w>>>7)^(w<<14|w>>>18)^w>>>3,E=0|C[T-2<<2>>2],b=(E<<15|E>>>17)^(E<<13|E>>>19)^E>>>10,R=C[T]=0|(0|y+(0|C[T-7<<2>>2]))+(0|b+(0|C[T-16<<2>>2]))),h=p&g^~p&m,O=n&i^n&u^i&u,N=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),L=(p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25),D=0|(0|(0|x+L)+(0|h+R))+(0|a[T<<2>>2]),I=0|N+O,x=m,m=g,g=p,p=0|c+D,c=u,u=i,i=n,n=0|D+I;n=0|r+n,i=0|o+i,u=0|l+u,c=0|f+c,p=0|d+p,g=0|v+g,m=0|_+m,x=0|S+x,A+=16}return[n,i,u,c,p,g,m,x]},l=function(t){return 0>t&&(t=4*(1<<30)+t),t.toString(16)},s=[],a=[],function(){var t,e,n,r,i,o,u;for(e=function(t){return 0|4294967296*(t-Math.floor(t))},i=2,u=[],n=o=0;64>o;n=++o){for(;;){for(r=!0,t=2;i>=t*t;){if(0===i%t){r=!1;break}t+=1}if(r)break;i+=1}8>n&&(s[n]=e(Math.pow(i,.5))),a[n]=e(Math.pow(i,1/3)),u.push(i+=1)}return u}(),t=function(t){var e,n,r,i,o;for(i="",e=0,r=4*t.length;r>e;)n=e,o=(255&t[n>>2]>>(3-(3&n)<<3))<<16,n+=1,o|=(255&t[n>>2]>>(3-(3&n)<<3))<<8,n+=1,o|=255&t[n>>2]>>(3-(3&n)<<3),i+=h[63&o>>18],i+=h[63&o>>12],e+=1,i+=e>=r?"=":h[63&o>>6],e+=1,i+=e>=r?"=":h[63&o],e+=1;return i},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=function(t){var e,n,r,i,o;for(e=[],r=255,n=i=0,o=t.length;o>=0?o>i:i>o;n=o>=0?++i:--i)e[n>>2]|=(t.charCodeAt(n)&r)<<(3-(3&n)<<3);return e}}(),L.Util.Oauth=function(){function t(t){this._id=null,this._secret=null,this._stateParam=null,this._authCode=null,this._token=null,this._tokenKey=null,this._tokenKid=null,this._error=null,this._appHash=null,this._loaded=null,this.setCredentials(t)}return t.prototype.setCredentials=function(t){if(t.key)this._id=t.key;else{if(!t.token)throw new Error("No API key supplied");this._id=null}return this._secret=t.secret||null,this._appHash=null,this._error=null,this._loaded=!0,this.reset(),t.token?(this._token=t.token,t.tokenKey&&(this._tokenKey=t.tokenKey,this._tokenKid=t.tokenKid)):t.oauthCode?this._authCode=t.oauthCode:t.oauthStateParam&&(this._stateParam=t.oauthStateParam),this},t.prototype.credentials=function(){var t;return t={},this._id&&(t.key=this._id),this._secret&&(t.secret=this._secret),null!==this._token?(t.token=this._token,this._tokenKey&&(t.tokenKey=this._tokenKey,t.tokenKid=this._tokenKid)):null!==this._authCode?t.oauthCode=this._authCode:null!==this._stateParam&&(t.oauthStateParam=this._stateParam),t},t.prototype.step=function(){return null!==this._token?L.Client.DONE:null!==this._authCode?L.Client.AUTHORIZED:null!==this._stateParam?this._loaded?L.Client.PARAM_LOADED:L.Client.PARAM_SET:null!==this._error?L.Client.ERROR:L.Client.RESET},t.prototype.setAuthStateParam=function(t){if(null===this._id)throw new Error("No API key supplied, cannot do authorization");return this.reset(),this._loaded=!1,this._stateParam=t,this},t.prototype.checkAuthStateParam=function(t){return this._stateParam===t&&null!==this._stateParam},t.prototype.authStateParam=function(){return this._stateParam},t.prototype.error=function(){return this._error},t.prototype.processRedirectParams=function(t){var e;if(t.error){if(null===this._id)throw new Error("No API key supplied, cannot process errors");return this.reset(),this._error=new L.AuthError(t),!0}if(t.code){if(null===this._id)throw new Error("No API key supplied, cannot do Authorization Codes");return this.reset(),this._loaded=!1,this._authCode=t.code,!0}if(e=t.token_type){if(e=e.toLowerCase(),"bearer"!==e&&"mac"!==e)throw new Error("Unimplemented token type "+e);if(this.reset(),this._loaded=!1,"mac"===e){if("hmac-sha-1"!==t.mac_algorithm)throw new Error("Unimplemented MAC algorithms "+t.mac_algorithm);this._tokenKey=t.mac_key,this._tokenKid=t.kid}return this._token=t.access_token,!0}return!1},t.prototype.authHeader=function(t,e,n){var r,i;return null===this._token?(i=L.Util.btoa(null===this._secret?""+this._id+":":""+this._id+":"+this._secret),"Basic "+i):null===this._tokenKey?"Bearer "+this._token:(r=this.macParams(t,e,n),"MAC kid="+r.kid+" ts="+r.ts+" "+("access_token="+this._token+" mac="+r.mac))},t.prototype.addAuthParams=function(t,e,n){var r;return null===this._token?(n.client_id=this._id,null!==this._secret&&(n.client_secret=this._secret)):(null!==this._tokenKey&&(r=this.macParams(t,e,n),n.kid=r.kid,n.ts=r.ts,n.mac=r.mac),n.access_token=this._token),n},t.prototype.authorizeUrlParams=function(t,e){var n;if("token"!==t&&"code"!==t)throw new Error("Unimplemented /authorize response type "+t);return n={client_id:this._id,state:this._stateParam,response_type:t},e&&(n.redirect_uri=e),n},t.prototype.accessTokenParams=function(t){var e;return e={grant_type:"authorization_code",code:this._authCode},t&&(e.redirect_uri=t),e},t.queryParamsFromUrl=function(t){var e,n,r,i,o,s,a,u,l,h;if(i=/^[^?#]+(\?([^\#]*))?(\#(.*))?$/.exec(t),!i)return{};for(a=i[2]||"","/"===a.substring(0,1)&&(a=a.substring(1)),e=i[4]||"",n=e.indexOf("?"),-1!==n&&(e=e.substring(n+1)),"/"===e.substring(0,1)&&(e=e.substring(1)),s={},h=a.split("&").concat(e.split("&")),u=0,l=h.length;l>u;u++)r=h[u],o=r.indexOf("="),-1!==o&&(s[decodeURIComponent(r.substring(0,o))]=decodeURIComponent(r.substring(o+1)));return s},t.prototype.macParams=function(t,e,n){var r,i;return r={kid:this._tokenKid,ts:L.Util.Oauth.timestamp()},i=t.toUpperCase()+"&"+L.Util.Xhr.urlEncodeValue(e)+"&"+L.Util.Xhr.urlEncodeValue(L.Util.Xhr.urlEncode(n)),r.mac=L.Util.hmac(i,this._tokenKey),r},t.prototype.appHash=function(){return this._appHash?this._appHash:this._appHash=L.Util.sha1("oauth2-"+this._id).replace(/[\/+=]/g,"")},t.prototype.reset=function(){return this._stateParam=null,this._authCode=null,this._token=null,this._tokenKey=null,this._tokenKid=null,this._error=null,this},t.timestamp=function(){return Math.floor(Date.now()/1e3)},t.randomAuthStateParam=function(){return["oas",Date.now().toString(36),Math.random().toString(36)].join("_")},t}(),null==Date.now&&(L.Util.Oauth.timestamp=function(){return Math.floor((new Date).getTime()/1e3)}),2274814865e3===new Date("Fri, 31 Jan 2042 21:01:05 +0000").valueOf()?L.Util.parseDate=function(t){return new Date(t)}:2274814865e3===Date.parse("Fri, 31 Jan 2042 21:01:05 +0000")?L.Util.parseDate=function(t){return new Date(Date.parse(t))}:function(){var t,e;return e=/^\w+\, (\d+) (\w+) (\d+) (\d+)\:(\d+)\:(\d+) (\+\d+|UTC|GMT)$/,t={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},L.Util.parseDate=function(n){var r;return(r=e.exec(n))?new Date(Date.UTC(parseInt(r[3]),t[r[2]],parseInt(r[1]),parseInt(r[4]),parseInt(r[5]),parseInt(r[6]),0)):0/0}}(),L.Util.countUtf8Bytes=function(t){var e,n,r,i,o;for(e=0,r=i=0,o=t.length;o>=0?o>i:i>o;r=o>=0?++i:--i)n=t.charCodeAt(r),127>=n?e+=1:2047>=n?e+=2:n>=55296&&57343>=n?e+=2:65535>=n?e+=3:ae(!1);return e},L.Env.global.XMLHttpRequest?(!L.Env.global.XDomainRequest||"withCredentials"in new XMLHttpRequest?(S=XMLHttpRequest,x=!1,b="undefined"!=typeof FormData&&-1===navigator.userAgent.indexOf("Firefox")):(S=XDomainRequest,x=!0,b=!1),E=!0):(S=L.Env.require("xhr2"),x=!1,b=!1,E=!1),L.Env.global.Uint8Array)if(Object.getPrototypeOf?w=Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array(0))).constructor:Object.__proto__&&(w=new Uint8Array(0).__proto__.__proto__.constructor),L.Env.global.Blob){try{!function(){return 2===new Blob([new Uint8Array(2)]).size?(T=!0,A=!0):(A=!1,T=2===new Blob([new ArrayBuffer(2)]).size)}()}catch(de){A=!1,T=!1,L.Env.global.WebKitBlobBuilder&&-1!==navigator.userAgent.indexOf("Android")&&(b=!1)}w===Object&&(A=!1)}else T=!1,A=!0;else w=null,T=!1,A=!1;L.Util.Xhr=function(){function t(t,e){this.method=t,this.isGet="GET"===this.method,this.url=e,this.wantHeaders=!1,this.headers={},this.params=null,this.body=null,this.preflight=!(this.isGet||"POST"===this.method),this.signed=!1,this.completed=!1,this.responseType=null,this.callback=null,this.xhr=null,this.onError=null}return t.Request=S,t.ieXdr=x,t.canSendForms=b,t.doesPreflight=E,t.ArrayBufferView=w,t.sendArrayBufferView=A,t.wrapBlob=T,t.prototype.xhr=null,t.prototype.onError=null,t.prototype.setParams=function(t){if(this.signed)throw new Error("setParams called after addOauthParams or addOauthHeader");if(this.params)throw new Error("setParams cannot be called twice");return this.params=t,this},t.prototype.setCallback=function(t){return this.callback=t,this},t.prototype.signWithOauth=function(t,e){return L.Util.Xhr.ieXdr?this.addOauthParams(t):this.preflight||!L.Util.Xhr.doesPreflight?this.addOauthHeader(t):this.isGet&&e?this.addOauthHeader(t):this.addOauthParams(t)},t.prototype.addOauthParams=function(t){if(this.signed)throw new Error("Request already has an OAuth signature");return this.params||(this.params={}),t.addAuthParams(this.method,this.url,this.params),this.signed=!0,this},t.prototype.addOauthHeader=function(t){if(this.signed)throw new Error("Request already has an OAuth signature");return this.params||(this.params={}),this.signed=!0,this.setHeader("Authorization",t.authHeader(this.method,this.url,this.params))},t.prototype.setBody=function(t){if(this.isGet)throw new Error("setBody cannot be called on GET requests");if(null!==this.body)throw new Error("Request already has a body");return"string"==typeof t||"undefined"!=typeof FormData&&t instanceof FormData||(this.headers["Content-Type"]="application/octet-stream",this.preflight=!0),this.body=t,this},t.prototype.setResponseType=function(t){return this.responseType=t,this},t.prototype.setHeader=function(t,e){var n;if(this.headers[t])throw n=this.headers[t],new Error("HTTP header "+t+" already set to "+n);if("Content-Type"===t)throw new Error("Content-Type is automatically computed based on setBody");return this.preflight=!0,this.headers[t]=e,this},t.prototype.reportResponseHeaders=function(){return this.wantHeaders=!0},t.prototype.setFileField=function(t,e,n,r){var i,o,s,a,u;if(null!==this.body)throw new Error("Request already has a body");if(this.isGet)throw new Error("setFileField cannot be called on GET requests");if("object"==typeof n){"undefined"!=typeof ArrayBuffer&&(n instanceof ArrayBuffer?L.Util.Xhr.sendArrayBufferView&&(n=new Uint8Array(n)):!L.Util.Xhr.sendArrayBufferView&&0===n.byteOffset&&n.buffer instanceof ArrayBuffer&&(n=n.buffer)),r||(r="application/octet-stream");try{n=new Blob([n],{type:r})}catch(l){o=l,window.WebKitBlobBuilder&&(a=new WebKitBlobBuilder,a.append(n),(i=a.getBlob(r))&&(n=i))}"undefined"!=typeof File&&n instanceof File&&(n=new Blob([n],{type:n.type})),u=n instanceof Blob}else u=!1;return u?(this.body=new FormData,this.body.append(t,n,e)):(r||(r="application/octet-stream"),s=this.multipartBoundary(),this.headers["Content-Type"]="multipart/form-data; boundary="+s,this.body=["--",s,"\r\n",'Content-Disposition: form-data; name="',t,'"; filename="',e,'"\r\n',"Content-Type: ",r,"\r\n","Content-Transfer-Encoding: binary\r\n\r\n",n,"\r\n","--",s,"--","\r\n"].join(""))},t.prototype.multipartBoundary=function(){return[Date.now().toString(36),Math.random().toString(36)].join("----")},t.prototype.paramsToUrl=function(){var t;return this.params&&(t=L.Util.Xhr.urlEncode(this.params),0!==t.length&&(this.url=[this.url,"?",t].join("")),this.params=null),this},t.prototype.paramsToBody=function(){if(this.params){if(null!==this.body)throw new Error("Request already has a body");if(this.isGet)throw new Error("paramsToBody cannot be called on GET requests");this.headers["Content-Type"]="application/x-www-form-urlencoded",this.body=L.Util.Xhr.urlEncode(this.params),this.params=null}return this},t.prototype.prepare=function(){var t,e,n,r,i=this;if(e=L.Util.Xhr.ieXdr,this.isGet||null!==this.body||e?(this.paramsToUrl(),null!==this.body&&"string"==typeof this.body&&(this.headers["Content-Type"]="text/plain; charset=utf8")):this.paramsToBody(),this.xhr=new L.Util.Xhr.Request,e?(this.xhr.onload=function(){return i.onXdrLoad()},this.xhr.onerror=function(){return i.onXdrError()},this.xhr.ontimeout=function(){return i.onXdrError()},this.xhr.onprogress=function(){}):this.xhr.onreadystatechange=function(){return i.onReadyStateChange()},this.xhr.open(this.method,this.url,!0),!e){r=this.headers;for(t in r)he.call(r,t)&&(n=r[t],this.xhr.setRequestHeader(t,n))}return this.responseType&&("b"===this.responseType?this.xhr.overrideMimeType&&this.xhr.overrideMimeType("text/plain; charset=x-user-defined"):this.xhr.responseType=this.responseType),this},t.prototype.send=function(t){var e,n;if(this.callback=t||this.callback,null!==this.body){e=this.body,L.Util.Xhr.sendArrayBufferView?e instanceof ArrayBuffer&&(e=new Uint8Array(e)):0===e.byteOffset&&e.buffer instanceof ArrayBuffer&&(e=e.buffer);try{this.xhr.send(e)}catch(r){if(n=r,L.Util.Xhr.sendArrayBufferView||!L.Util.Xhr.wrapBlob)throw n;e=new Blob([e],{type:"application/octet-stream"}),this.xhr.send(e)}}else this.xhr.send();return this},t.urlEncode=function(t){var e,n,r;e=[];for(n in t)r=t[n],e.push(this.urlEncodeValue(n)+"="+this.urlEncodeValue(r));return e.sort().join("&")},t.urlEncodeValue=function(t){return encodeURIComponent(t.toString()).replace(/\!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},t.urlDecode=function(t){var e,n,r,i,o,s;for(n={},s=t.split("&"),i=0,o=s.length;o>i;i++)r=s[i],e=r.split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return n},t.prototype.onReadyStateChange=function(){var t,e,n,r,i,o,s,a,u,l,h,c,f,p,d;if(4!==this.xhr.readyState)return!0;if(this.completed)return!0;if(this.completed=!0,this.xhr.status<200||this.xhr.status>=300)return e=new L.ApiError(this.xhr,this.method,this.url),this.onError?this.onError(e,this.callback):this.callback(e),!0;if(this.wantHeaders?(t=this.xhr.getAllResponseHeaders(),s=t?L.Util.Xhr.parseResponseHeaders(t):this.guessResponseHeaders(),h=s["x-dropbox-metadata"]):(s=void 0,h=this.xhr.getResponseHeader("x-dropbox-metadata")),null!=h?h.length:void 0)try{l=JSON.parse(h)}catch(g){if(u=g,o=h.search(/\}\,\s*\{/),-1!==o)try{h=h.substring(0,o+1),l=JSON.parse(h)}catch(g){u=g,l=void 0}else l=void 0}else l=void 0;if(this.responseType){if("b"===this.responseType){for(i=null!=this.xhr.responseText?this.xhr.responseText:this.xhr.response,n=[],a=p=0,d=i.length;d>=0?d>p:p>d;a=d>=0?++p:--p)n.push(String.fromCharCode(255&i.charCodeAt(a)));f=n.join(""),this.callback(null,f,l,s)}else this.callback(null,this.xhr.response,l,s);return!0}switch(f=null!=this.xhr.responseText?this.xhr.responseText:this.xhr.response,r=this.xhr.getResponseHeader("Content-Type"),r&&(c=r.indexOf(";"),-1!==c&&(r=r.substring(0,c))),r){case"application/x-www-form-urlencoded":this.callback(null,L.Util.Xhr.urlDecode(f),l,s);break;case"application/json":case"text/javascript":this.callback(null,JSON.parse(f),l,s);break;default:this.callback(null,f,l,s)}return!0},t.parseResponseHeaders=function(t){var e,n,r,i,o,s,a,u;for(r={},n=t.split("\n"),a=0,u=n.length;u>a;a++)i=n[a],e=i.indexOf(":"),o=i.substring(0,e).trim().toLowerCase(),s=i.substring(e+1).trim(),r[o]=s;return r},t.prototype.guessResponseHeaders=function(){var t,e,n,r,i,o;for(t={},o=["cache-control","content-language","content-range","content-type","expires","last-modified","pragma","x-dropbox-metadata"],r=0,i=o.length;i>r;r++)e=o[r],n=this.xhr.getResponseHeader(e),n&&(t[e]=n);return t},t.prototype.onXdrLoad=function(){var t,e,n;if(this.completed)return!0;if(this.completed=!0,n=this.xhr.responseText,t=this.wantHeaders?{"content-type":this.xhr.contentType}:void 0,e=void 0,this.responseType)return this.callback(null,n,e,t),!0;switch(this.xhr.contentType){case"application/x-www-form-urlencoded":this.callback(null,L.Util.Xhr.urlDecode(n),e,t);break;case"application/json":case"text/javascript":this.callback(null,JSON.parse(n),e,t);break;default:this.callback(null,n,e,t)}return!0},t.prototype.onXdrError=function(){var t;return this.completed?!0:(this.completed=!0,t=new L.ApiError(this.xhr,this.method,this.url),this.onError?this.onError(t,this.callback):this.callback(t),!0)},t}(),se="X-Dropbox-User-Agent",$="X-Dropbox-Request-Id",L.DatastoresClient={_dispatchDatastoreXhr:function(t,e,n,r,i,o){var s,a,u;return u=new L.Util.Xhr(t,e),i.setRequestId&&(a="xxxxxxxxxxxxxxxx".replace(/x/g,function(){return Math.floor(16*Math.random()).toString(16)}),u.setHeader($,a)),ae(null==n[se]),n=ue.clone(n),n[se]="dropbox-js-datastore-sdk/"+f,u.setParams(n),u.signWithOauth(this.oauth,!1),s=function(t,e){var n;if(null!=t)return o(t);if(ie.is_string(e)){console.log("Treating server response string as JSON:",e);try{e=JSON.parse(e)}catch(i){n=i,console.log("Error parsing response as JSON",n.stack)}}return o(null,r.fromJSON(e))},i.isLongPoll?this.dispatchLongPollXhr(u,s):this.dispatchXhr(u,s),u},_listDatastores:function(t){return this._dispatchDatastoreXhr("GET",this.urls.listDbs,{},B,{},t)},_getOrCreateDatastore:function(t,e){return this._dispatchDatastoreXhr("POST",this.urls.getOrCreateDb,{dsid:t},h,{},e)},_createDatastore:function(t,e,n){return this._dispatchDatastoreXhr("POST",this.urls.createDb,{dsid:t,key:e},h,{},n)},_getDatastore:function(t,e){return this._dispatchDatastoreXhr("GET",this.urls.getDb,{dsid:t},M,{},e)},_deleteDatastore:function(t,e){return this._dispatchDatastoreXhr("POST",this.urls.deleteDb,{handle:t},O,{setRequestId:!0},e)},_putDelta:function(t,e,n){return this._dispatchDatastoreXhr("POST",this.urls.putDelta,{handle:t,rev:e.rev,nonce:e.nonce,changes:JSON.stringify(e.changes)},K,{setRequestId:!0},n)},_getSnapshot:function(t,e){return this._dispatchDatastoreXhr("GET",this.urls.getSnapshot,{handle:t},j,{},e)},_datastoreAwait:function(t,n,r){return this._dispatchDatastoreXhr("GET",this.urls.datastoreAwait,{get_deltas:JSON.stringify({cursors:t}),list_datastores:JSON.stringify({token:n})},e,{isLongPoll:!0},r)},getDatastoreManager:function(){var t,e=this;return null==this._datastoreManager&&(this._datastoreManager=new L.Datastore.DatastoreManager(this),t=function(){return e.authStep===L.Client.SIGNED_OUT?(e._datastoreManager.close(),e._datastoreManager=null,e.onAuthStepChange.removeListener(t)):void 0},this.onAuthStepChange.addListener(t)),this._datastoreManager}},function(){var t,e,n,r;n=L.DatastoresClient,r=[];for(e in n)t=n[e],r.push(L.Client.prototype[e]=t);return r}(),L.File.PublicUrl=L.File.ShareUrl,L.UserInfo=L.AccountInfo}.call(this),a("undefined"!=typeof Dropbox?Dropbox:window.Dropbox)}.call(r,void 0,void 0,void 0,void 0,function(t){e.exports=t})}).call(this,t("vbrzzp"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer)},{buffer:11,vbrzzp:15}],10:[function(t,e){(function(n){__browserify_shim_require__=t,function(t,e,n,r,i){!function(t){var e=[],n={},r="routie",i=t[r],o=function(t,e){this.name=e,this.path=t,this.keys=[],this.fns=[],this.params={},this.regex=s(this.path,this.keys,!1,!1)};o.prototype.addHandler=function(t){this.fns.push(t)},o.prototype.removeHandler=function(t){for(var e=0,n=this.fns.length;n>e;e++){var r=this.fns[e];if(t==r)return void this.fns.splice(e,1)}},o.prototype.run=function(t){for(var e=0,n=this.fns.length;n>e;e++)this.fns[e].apply(this,t)},o.prototype.match=function(t,e){var n=this.regex.exec(t);if(!n)return!1;for(var r=1,i=n.length;i>r;++r){var o=this.keys[r-1],s="string"==typeof n[r]?decodeURIComponent(n[r]):n[r];o&&(this.params[o.name]=s),e.push(s)}return!0},o.prototype.toURL=function(t){var e=this.path;for(var n in t)e=e.replace("/:"+n,"/"+t[n]);if(e=e.replace(/\/:.*\?/g,"/").replace(/\?/g,""),-1!=e.indexOf(":"))throw new Error("missing parameters for url: "+e);return e};var s=function(t,e,n,r){return t instanceof RegExp?t:(t instanceof Array&&(t="("+t.join("|")+")"),t=t.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(t,n,r,i,o,s){return e.push({name:i,optional:!!s}),n=n||"",""+(s?"":n)+"(?:"+(s?n:"")+(r||"")+(o||r&&"([^/.]+?)"||"([^/]+?)")+")"+(s||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",n?"":"i"))},a=function(t,r){var i=t.split(" "),s=2==i.length?i[0]:null;t=2==i.length?i[1]:i[0],n[t]||(n[t]=new o(t,s),e.push(n[t])),n[t].addHandler(r)},u=function(t,e){if("function"==typeof e)a(t,e),u.reload();else if("object"==typeof t){for(var n in t)a(n,t[n]);u.reload()}else"undefined"==typeof e&&u.navigate(t)};u.lookup=function(t,n){for(var r=0,i=e.length;i>r;r++){var o=e[r];if(o.name==t)return o.toURL(n)}},u.remove=function(t,e){var r=n[t];r&&r.removeHandler(e)},u.removeAll=function(){n={},e=[]},u.navigate=function(t,e){e=e||{};var n=e.silent||!1;n&&p(),setTimeout(function(){window.location.hash=t,n&&setTimeout(function(){f()},1)},1)},u.noConflict=function(){return t[r]=i,u};var l=function(){return window.location.hash.substring(1)},h=function(t,e){var n=[];return e.match(t,n)?(e.run(n),!0):!1},c=u.reload=function(){for(var t=l(),n=0,r=e.length;r>n;n++){var i=e[n];if(h(t,i))return}},f=function(){t.addEventListener?t.addEventListener("hashchange",c,!1):t.attachEvent("onhashchange",c)},p=function(){t.removeEventListener?t.removeEventListener("hashchange",c):t.detachEvent("onhashchange",c)};f(),t[r]=u}(window),i("undefined"!=typeof routie?routie:window.routie)}.call(n,void 0,void 0,void 0,void 0,function(t){e.exports=t})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(t,e,n){function r(t,e,n){if(!(this instanceof r))return new r(t,e,n);var i=typeof t;if("base64"===e&&"string"===i)for(t=O(t);t.length%4!==0;)t+="=";var o;if("number"===i)o=L(t);else if("string"===i)o=r.byteLength(t,e);else{if("object"!==i)throw new Error("First argument needs to be a number, array or string.");o=L(t.length)}var s;r._useTypedArrays?s=r._augment(new Uint8Array(o)):(s=this,s.length=o,s._isBuffer=!0);var a;if(r._useTypedArrays&&"number"==typeof t.byteLength)s._set(t);else if(C(t))for(a=0;o>a;a++)s[a]=r.isBuffer(t)?t.readUInt8(a):t[a];else if("string"===i)s.write(t,0,e);else if("number"===i&&!r._useTypedArrays&&!n)for(a=0;o>a;a++)s[a]=0;return s}function i(t,e,n,i){n=Number(n)||0;var o=t.length-n;i?(i=Number(i),i>o&&(i=o)):i=o;var s=e.length;X(s%2===0,"Invalid hex string"),i>s/2&&(i=s/2);for(var a=0;i>a;a++){var u=parseInt(e.substr(2*a,2),16);X(!isNaN(u),"Invalid hex string"),t[n+a]=u}return r._charsWritten=2*a,a}function o(t,e,n,i){var o=r._charsWritten=j(I(e),t,n,i);return o}function s(t,e,n,i){var o=r._charsWritten=j(U(e),t,n,i);return o}function a(t,e,n,r){return s(t,e,n,r)}function u(t,e,n,i){var o=r._charsWritten=j(P(e),t,n,i);return o}function l(t,e,n,i){var o=r._charsWritten=j(M(e),t,n,i);return o}function h(t,e,n){return H.fromByteArray(0===e&&n===t.length?t:t.slice(e,n))}function c(t,e,n){var r="",i="";n=Math.min(t.length,n);for(var o=e;n>o;o++)t[o]<=127?(r+=F(i)+String.fromCharCode(t[o]),i=""):i+="%"+t[o].toString(16);return r+F(i)}function f(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;n>i;i++)r+=String.fromCharCode(t[i]);return r}function p(t,e,n){return f(t,e,n)}function d(t,e,n){var r=t.length;(!e||0>e)&&(e=0),(!n||0>n||n>r)&&(n=r);for(var i="",o=e;n>o;o++)i+=D(t[o]);return i}function g(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function v(t,e,n,r){r||(X("boolean"==typeof n,"missing or invalid endian"),X(void 0!==e&&null!==e,"missing offset"),X(e+1<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var o;return n?(o=t[e],i>e+1&&(o|=t[e+1]<<8)):(o=t[e]<<8,i>e+1&&(o|=t[e+1])),o}}function m(t,e,n,r){r||(X("boolean"==typeof n,"missing or invalid endian"),X(void 0!==e&&null!==e,"missing offset"),X(e+3<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var o;return n?(i>e+2&&(o=t[e+2]<<16),i>e+1&&(o|=t[e+1]<<8),o|=t[e],i>e+3&&(o+=t[e+3]<<24>>>0)):(i>e+1&&(o=t[e+1]<<16),i>e+2&&(o|=t[e+2]<<8),i>e+3&&(o|=t[e+3]),o+=t[e]<<24>>>0),o}}function _(t,e,n,r){r||(X("boolean"==typeof n,"missing or invalid endian"),X(void 0!==e&&null!==e,"missing offset"),X(e+1<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var o=v(t,e,n,!0),s=32768&o;return s?-1*(65535-o+1):o}}function y(t,e,n,r){r||(X("boolean"==typeof n,"missing or invalid endian"),X(void 0!==e&&null!==e,"missing offset"),X(e+3<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var o=m(t,e,n,!0),s=2147483648&o;return s?-1*(4294967295-o+1):o}}function w(t,e,n,r){return r||(X("boolean"==typeof n,"missing or invalid endian"),X(e+3<t.length,"Trying to read beyond buffer length")),W.read(t,e,n,23,4)}function b(t,e,n,r){return r||(X("boolean"==typeof n,"missing or invalid endian"),X(e+7<t.length,"Trying to read beyond buffer length")),W.read(t,e,n,52,8)}function E(t,e,n,r,i){i||(X(void 0!==e&&null!==e,"missing value"),X("boolean"==typeof r,"missing or invalid endian"),X(void 0!==n&&null!==n,"missing offset"),X(n+1<t.length,"trying to write beyond buffer length"),B(e,65535));var o=t.length;if(!(n>=o))for(var s=0,a=Math.min(o-n,2);a>s;s++)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function x(t,e,n,r,i){i||(X(void 0!==e&&null!==e,"missing value"),X("boolean"==typeof r,"missing or invalid endian"),X(void 0!==n&&null!==n,"missing offset"),X(n+3<t.length,"trying to write beyond buffer length"),B(e,4294967295));var o=t.length;if(!(n>=o))for(var s=0,a=Math.min(o-n,4);a>s;s++)t[n+s]=e>>>8*(r?s:3-s)&255}function S(t,e,n,r,i){i||(X(void 0!==e&&null!==e,"missing value"),X("boolean"==typeof r,"missing or invalid endian"),X(void 0!==n&&null!==n,"missing offset"),X(n+1<t.length,"Trying to write beyond buffer length"),z(e,32767,-32768));var o=t.length;n>=o||(e>=0?E(t,e,n,r,i):E(t,65535+e+1,n,r,i))}function A(t,e,n,r,i){i||(X(void 0!==e&&null!==e,"missing value"),X("boolean"==typeof r,"missing or invalid endian"),X(void 0!==n&&null!==n,"missing offset"),X(n+3<t.length,"Trying to write beyond buffer length"),z(e,2147483647,-2147483648));var o=t.length;n>=o||(e>=0?x(t,e,n,r,i):x(t,4294967295+e+1,n,r,i))}function T(t,e,n,r,i){i||(X(void 0!==e&&null!==e,"missing value"),X("boolean"==typeof r,"missing or invalid endian"),X(void 0!==n&&null!==n,"missing offset"),X(n+3<t.length,"Trying to write beyond buffer length"),q(e,3.4028234663852886e38,-3.4028234663852886e38));var o=t.length;n>=o||W.write(t,e,n,r,23,4)}function k(t,e,n,r,i){i||(X(void 0!==e&&null!==e,"missing value"),X("boolean"==typeof r,"missing or invalid endian"),X(void 0!==n&&null!==n,"missing offset"),X(n+7<t.length,"Trying to write beyond buffer length"),q(e,1.7976931348623157e308,-1.7976931348623157e308));var o=t.length;n>=o||W.write(t,e,n,r,52,8)}function O(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function N(t,e,n){return"number"!=typeof t?n:(t=~~t,t>=e?e:t>=0?t:(t+=e,t>=0?t:0))}function L(t){return t=~~Math.ceil(+t),0>t?0:t}function R(t){return(Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)})(t)}function C(t){return R(t)||r.isBuffer(t)||t&&"object"==typeof t&&"number"==typeof t.length}function D(t){return 16>t?"0"+t.toString(16):t.toString(16)}function I(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(127>=r)e.push(t.charCodeAt(n));else{var i=n;r>=55296&&57343>=r&&n++;for(var o=encodeURIComponent(t.slice(i,n+1)).substr(1).split("%"),s=0;s<o.length;s++)e.push(parseInt(o[s],16))}}return e}function U(t){for(var e=[],n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return e}function M(t){for(var e,n,r,i=[],o=0;o<t.length;o++)e=t.charCodeAt(o),n=e>>8,r=e%256,i.push(r),i.push(n);return i}function P(t){return H.toByteArray(t)}function j(t,e,n,r){for(var i=0;r>i&&!(i+n>=e.length||i>=t.length);i++)e[i+n]=t[i];return i}function F(t){try{return decodeURIComponent(t)}catch(e){return String.fromCharCode(65533)}}function B(t,e){X("number"==typeof t,"cannot write a non-number as a number"),X(t>=0,"specified a negative value for writing an unsigned value"),X(e>=t,"value is larger than maximum value for type"),X(Math.floor(t)===t,"value has a fractional component")}function z(t,e,n){X("number"==typeof t,"cannot write a non-number as a number"),X(e>=t,"value larger than maximum allowed value"),X(t>=n,"value smaller than minimum allowed value"),X(Math.floor(t)===t,"value has a fractional component")}function q(t,e,n){X("number"==typeof t,"cannot write a non-number as a number"),X(e>=t,"value larger than maximum allowed value"),X(t>=n,"value smaller than minimum allowed value")}function X(t,e){if(!t)throw new Error(e||"Failed assertion")}var H=t("base64-js"),W=t("ieee754");n.Buffer=r,n.SlowBuffer=r,n.INSPECT_MAX_BYTES=50,r.poolSize=8192,r._useTypedArrays=function(){try{var t=new ArrayBuffer(0),e=new Uint8Array(t);return e.foo=function(){return 42},42===e.foo()&&"function"==typeof e.subarray}catch(n){return!1}}(),r.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.isBuffer=function(t){return!(null===t||void 0===t||!t._isBuffer)},r.byteLength=function(t,e){var n;switch(t+="",e||"utf8"){case"hex":n=t.length/2;break;case"utf8":case"utf-8":n=I(t).length;break;case"ascii":case"binary":case"raw":n=t.length;break;case"base64":n=P(t).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=2*t.length;break;default:throw new Error("Unknown encoding")}return n},r.concat=function(t,e){if(X(R(t),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===t.length)return new r(0);if(1===t.length)return t[0];var n;if("number"!=typeof e)for(e=0,n=0;n<t.length;n++)e+=t[n].length;var i=new r(e),o=0;for(n=0;n<t.length;n++){var s=t[n];s.copy(i,o),o+=s.length}return i},r.prototype.write=function(t,e,n,r){if(isFinite(e))isFinite(n)||(r=n,n=void 0);else{var h=r;r=e,e=n,n=h}e=Number(e)||0;var c=this.length-e;n?(n=Number(n),n>c&&(n=c)):n=c,r=String(r||"utf8").toLowerCase();var f;switch(r){case"hex":f=i(this,t,e,n);break;case"utf8":case"utf-8":f=o(this,t,e,n);break;case"ascii":f=s(this,t,e,n);break;case"binary":f=a(this,t,e,n);break;case"base64":f=u(this,t,e,n);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":f=l(this,t,e,n);break;default:throw new Error("Unknown encoding")}return f},r.prototype.toString=function(t,e,n){var r=this;if(t=String(t||"utf8").toLowerCase(),e=Number(e)||0,n=void 0!==n?Number(n):n=r.length,n===e)return"";var i;switch(t){case"hex":i=d(r,e,n);break;case"utf8":case"utf-8":i=c(r,e,n);break;case"ascii":i=f(r,e,n);break;case"binary":i=p(r,e,n);break;case"base64":i=h(r,e,n);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=g(r,e,n);break;default:throw new Error("Unknown encoding")}return i},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}
},r.prototype.copy=function(t,e,n,i){var o=this;if(n||(n=0),i||0===i||(i=this.length),e||(e=0),i!==n&&0!==t.length&&0!==o.length){X(i>=n,"sourceEnd < sourceStart"),X(e>=0&&e<t.length,"targetStart out of bounds"),X(n>=0&&n<o.length,"sourceStart out of bounds"),X(i>=0&&i<=o.length,"sourceEnd out of bounds"),i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);var s=i-n;if(100>s||!r._useTypedArrays)for(var a=0;s>a;a++)t[a+e]=this[a+n];else t._set(this.subarray(n,n+s),e)}},r.prototype.slice=function(t,e){var n=this.length;if(t=N(t,n,0),e=N(e,n,n),r._useTypedArrays)return r._augment(this.subarray(t,e));for(var i=e-t,o=new r(i,void 0,!0),s=0;i>s;s++)o[s]=this[s+t];return o},r.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t)},r.prototype.set=function(t,e){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,e)},r.prototype.readUInt8=function(t,e){return e||(X(void 0!==t&&null!==t,"missing offset"),X(t<this.length,"Trying to read beyond buffer length")),t>=this.length?void 0:this[t]},r.prototype.readUInt16LE=function(t,e){return v(this,t,!0,e)},r.prototype.readUInt16BE=function(t,e){return v(this,t,!1,e)},r.prototype.readUInt32LE=function(t,e){return m(this,t,!0,e)},r.prototype.readUInt32BE=function(t,e){return m(this,t,!1,e)},r.prototype.readInt8=function(t,e){if(e||(X(void 0!==t&&null!==t,"missing offset"),X(t<this.length,"Trying to read beyond buffer length")),!(t>=this.length)){var n=128&this[t];return n?-1*(255-this[t]+1):this[t]}},r.prototype.readInt16LE=function(t,e){return _(this,t,!0,e)},r.prototype.readInt16BE=function(t,e){return _(this,t,!1,e)},r.prototype.readInt32LE=function(t,e){return y(this,t,!0,e)},r.prototype.readInt32BE=function(t,e){return y(this,t,!1,e)},r.prototype.readFloatLE=function(t,e){return w(this,t,!0,e)},r.prototype.readFloatBE=function(t,e){return w(this,t,!1,e)},r.prototype.readDoubleLE=function(t,e){return b(this,t,!0,e)},r.prototype.readDoubleBE=function(t,e){return b(this,t,!1,e)},r.prototype.writeUInt8=function(t,e,n){n||(X(void 0!==t&&null!==t,"missing value"),X(void 0!==e&&null!==e,"missing offset"),X(e<this.length,"trying to write beyond buffer length"),B(t,255)),e>=this.length||(this[e]=t)},r.prototype.writeUInt16LE=function(t,e,n){E(this,t,e,!0,n)},r.prototype.writeUInt16BE=function(t,e,n){E(this,t,e,!1,n)},r.prototype.writeUInt32LE=function(t,e,n){x(this,t,e,!0,n)},r.prototype.writeUInt32BE=function(t,e,n){x(this,t,e,!1,n)},r.prototype.writeInt8=function(t,e,n){n||(X(void 0!==t&&null!==t,"missing value"),X(void 0!==e&&null!==e,"missing offset"),X(e<this.length,"Trying to write beyond buffer length"),z(t,127,-128)),e>=this.length||(t>=0?this.writeUInt8(t,e,n):this.writeUInt8(255+t+1,e,n))},r.prototype.writeInt16LE=function(t,e,n){S(this,t,e,!0,n)},r.prototype.writeInt16BE=function(t,e,n){S(this,t,e,!1,n)},r.prototype.writeInt32LE=function(t,e,n){A(this,t,e,!0,n)},r.prototype.writeInt32BE=function(t,e,n){A(this,t,e,!1,n)},r.prototype.writeFloatLE=function(t,e,n){T(this,t,e,!0,n)},r.prototype.writeFloatBE=function(t,e,n){T(this,t,e,!1,n)},r.prototype.writeDoubleLE=function(t,e,n){k(this,t,e,!0,n)},r.prototype.writeDoubleBE=function(t,e,n){k(this,t,e,!1,n)},r.prototype.fill=function(t,e,n){if(t||(t=0),e||(e=0),n||(n=this.length),"string"==typeof t&&(t=t.charCodeAt(0)),X("number"==typeof t&&!isNaN(t),"value is not a number"),X(n>=e,"end < start"),n!==e&&0!==this.length){X(e>=0&&e<this.length,"start out of bounds"),X(n>=0&&n<=this.length,"end out of bounds");for(var r=e;n>r;r++)this[r]=t}},r.prototype.inspect=function(){for(var t=[],e=this.length,r=0;e>r;r++)if(t[r]=D(this[r]),r===n.INSPECT_MAX_BYTES){t[r+1]="...";break}return"<Buffer "+t.join(" ")+">"},r.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(r._useTypedArrays)return new r(this).buffer;for(var t=new Uint8Array(this.length),e=0,n=t.length;n>e;e+=1)t[e]=this[e];return t.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var V=r.prototype;r._augment=function(t){return t._isBuffer=!0,t._get=t.get,t._set=t.set,t.get=V.get,t.set=V.set,t.write=V.write,t.toString=V.toString,t.toLocaleString=V.toString,t.toJSON=V.toJSON,t.copy=V.copy,t.slice=V.slice,t.readUInt8=V.readUInt8,t.readUInt16LE=V.readUInt16LE,t.readUInt16BE=V.readUInt16BE,t.readUInt32LE=V.readUInt32LE,t.readUInt32BE=V.readUInt32BE,t.readInt8=V.readInt8,t.readInt16LE=V.readInt16LE,t.readInt16BE=V.readInt16BE,t.readInt32LE=V.readInt32LE,t.readInt32BE=V.readInt32BE,t.readFloatLE=V.readFloatLE,t.readFloatBE=V.readFloatBE,t.readDoubleLE=V.readDoubleLE,t.readDoubleBE=V.readDoubleBE,t.writeUInt8=V.writeUInt8,t.writeUInt16LE=V.writeUInt16LE,t.writeUInt16BE=V.writeUInt16BE,t.writeUInt32LE=V.writeUInt32LE,t.writeUInt32BE=V.writeUInt32BE,t.writeInt8=V.writeInt8,t.writeInt16LE=V.writeInt16LE,t.writeInt16BE=V.writeInt16BE,t.writeInt32LE=V.writeInt32LE,t.writeInt32BE=V.writeInt32BE,t.writeFloatLE=V.writeFloatLE,t.writeFloatBE=V.writeFloatBE,t.writeDoubleLE=V.writeDoubleLE,t.writeDoubleBE=V.writeDoubleBE,t.fill=V.fill,t.inspect=V.inspect,t.toArrayBuffer=V.toArrayBuffer,t}},{"base64-js":12,ieee754:13}],12:[function(t,e){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(){"use strict";function t(t){var e=t.charCodeAt(0);return e===s?62:e===a?63:u>e?-1:u+10>e?e-u+26+26:h+26>e?e-h:l+26>e?e-l+26:void 0}function r(e){function n(t){l[c++]=t}var r,i,s,a,u,l;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var h=e.length;u="="===e.charAt(h-2)?2:"="===e.charAt(h-1)?1:0,l=new o(3*e.length/4-u),s=u>0?e.length-4:e.length;var c=0;for(r=0,i=0;s>r;r+=4,i+=3)a=t(e.charAt(r))<<18|t(e.charAt(r+1))<<12|t(e.charAt(r+2))<<6|t(e.charAt(r+3)),n((16711680&a)>>16),n((65280&a)>>8),n(255&a);return 2===u?(a=t(e.charAt(r))<<2|t(e.charAt(r+1))>>4,n(255&a)):1===u&&(a=t(e.charAt(r))<<10|t(e.charAt(r+1))<<4|t(e.charAt(r+2))>>2,n(a>>8&255),n(255&a)),l}function i(t){function e(t){return n.charAt(t)}function r(t){return e(t>>18&63)+e(t>>12&63)+e(t>>6&63)+e(63&t)}var i,o,s,a=t.length%3,u="";for(i=0,s=t.length-a;s>i;i+=3)o=(t[i]<<16)+(t[i+1]<<8)+t[i+2],u+=r(o);switch(a){case 1:o=t[t.length-1],u+=e(o>>2),u+=e(o<<4&63),u+="==";break;case 2:o=(t[t.length-2]<<8)+t[t.length-1],u+=e(o>>10),u+=e(o>>4&63),u+=e(o<<2&63),u+="="}return u}var o="undefined"!=typeof Uint8Array?Uint8Array:Array,s=("0".charCodeAt(0),"+".charCodeAt(0)),a="/".charCodeAt(0),u="0".charCodeAt(0),l="a".charCodeAt(0),h="A".charCodeAt(0);e.exports.toByteArray=r,e.exports.fromByteArray=i}()},{}],13:[function(t,e,n){n.read=function(t,e,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,l=u>>1,h=-7,c=n?i-1:0,f=n?-1:1,p=t[e+c];for(c+=f,o=p&(1<<-h)-1,p>>=-h,h+=a;h>0;o=256*o+t[e+c],c+=f,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+t[e+c],c+=f,h-=8);if(0===o)o=1-l;else{if(o===u)return s?0/0:1/0*(p?-1:1);s+=Math.pow(2,r),o-=l}return(p?-1:1)*s*Math.pow(2,o-r)},n.write=function(t,e,n,r,i,o){var s,a,u,l=8*o-i-1,h=(1<<l)-1,c=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,g=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),e+=s+c>=1?f/u:f*Math.pow(2,1-c),e*u>=2&&(s++,u/=2),s+c>=h?(a=0,s=h):s+c>=1?(a=(e*u-1)*Math.pow(2,i),s+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,i),s=0));i>=8;t[n+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,l+=i;l>0;t[n+p]=255&s,p+=d,s/=256,l-=8);t[n+p-d]|=128*g}},{}],14:[function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"number"==typeof t}function o(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!i(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,i,a,u,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length))throw e=arguments[1],e instanceof Error?e:TypeError('Uncaught, unspecified "error" event.');if(n=this._events[t],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,a=new Array(i-1),u=1;i>u;u++)a[u-1]=arguments[u];n.apply(this,a)}else if(o(n)){for(i=arguments.length,a=new Array(i-1),u=1;i>u;u++)a[u-1]=arguments[u];for(l=n.slice(),i=l.length,u=0;i>u;u++)l[u].apply(this,a)}return!0},n.prototype.addListener=function(t,e){var i;if(!r(e))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned){var i;i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,i,s,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(a=s;a-->0;)if(n[a]===e||n[a].listener&&n[a].listener===e){i=a;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.listenerCount=function(t,e){var n;return n=t._events&&t._events[e]?r(t._events[e])?1:t._events[e].length:0}},{}],15:[function(t,e){function n(){}var r=e.exports={};r.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var n=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=n,r.addListener=n,r.once=n,r.off=n,r.removeListener=n,r.removeAllListeners=n,r.emit=n,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")}},{}],16:[function(t,e,n){(function(t){!function(t){if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof n)e.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else Q=t()}(function(){"use strict";function e(t){return function(){return G.apply(t,arguments)}}function n(t){return t===Object(t)}function r(t){return"[object StopIteration]"===ne(t)||t instanceof H}function i(t,e){if(z&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(re)){for(var n=[],r=e;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(t.stack);var i=n.join("\n"+re+"\n");t.stack=o(i)}}function o(t){for(var e=t.split("\n"),n=[],r=0;r<e.length;++r){var i=e[r];u(i)||s(i)||!i||n.push(i)}return n.join("\n")}function s(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function a(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function u(t){var e=a(t);if(!e)return!1;var n=e[0],r=e[1];return n===X&&r>=W&&ae>=r}function l(){if(z)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=e[0].indexOf("@")>0?e[1]:e[2],r=a(n);if(!r)return;return X=r[0],r[1]}}function h(t,e,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(e+" is deprecated, use "+n+" instead.",new Error("").stack),t.apply(t,arguments)}}function c(t){return _(t)?t:y(t)?O(t):k(t)}function f(){function t(t){e=t,o.source=t,$(n,function(e,n){J(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,r=void 0}var e,n=[],r=[],i=Z(f.prototype),o=Z(g.prototype);if(o.promiseDispatch=function(t,i,o){var s=K(arguments);n?(n.push(s),"when"===i&&o[1]&&r.push(o[1])):J(function(){e.promiseDispatch.apply(e,s)})},o.valueOf=function(){if(n)return o;var t=m(e);return _(t)&&(e=t),t},o.inspect=function(){return e?e.inspect():{state:"pending"}},c.longStackSupport&&z)try{throw new Error}catch(s){o.stack=s.stack.substring(s.stack.indexOf("\n")+1)}return i.promise=o,i.resolve=function(n){e||t(c(n))},i.fulfill=function(n){e||t(k(n))},i.reject=function(n){e||t(T(n))},i.notify=function(t){e||$(r,function(e,n){J(function(){n(t)})},void 0)},i}function p(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=f();try{t(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}return e.promise}function d(t){return p(function(e,n){for(var r=0,i=t.length;i>r;r++)c(t[r]).then(e,n)})}function g(t,e,n){void 0===e&&(e=function(t){return T(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=Z(g.prototype);if(r.promiseDispatch=function(n,i,o){var s;try{s=t[i]?t[i].apply(r,o):e.call(r,i,o)}catch(a){s=T(a)}n&&n(s)},r.inspect=n,n){var i=n();"rejected"===i.state&&(r.exception=i.reason),r.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?r:t.value}}return r}function v(t,e,n,r){return c(t).then(e,n,r)}function m(t){if(_(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function _(t){return n(t)&&"function"==typeof t.promiseDispatch&&"function"==typeof t.inspect}function y(t){return n(t)&&"function"==typeof t.then}function w(t){return _(t)&&"pending"===t.inspect().state}function b(t){return!_(t)||"fulfilled"===t.inspect().state}function E(t){return _(t)&&"rejected"===t.inspect().state}function x(){ie.length=0,oe.length=0,se||(se=!0)}function S(t,e){se&&(oe.push(t),ie.push(e&&"undefined"!=typeof e.stack?e.stack:"(no stack) "+e))}function A(t){if(se){var e=Q(oe,t);-1!==e&&(oe.splice(e,1),ie.splice(e,1))}}function T(t){var e=g({when:function(e){return e&&A(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return S(e,t),e}function k(t){return g({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},"delete":function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return ee(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function O(t){var e=f();return J(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}}),e.promise}function N(t){return g({isDef:function(){}},function(e,n){return U(t,e,n)},function(){return c(t).inspect()})}function L(t,e,n){return c(t).spread(e,n)}function R(t){return function(){function e(t,e){var s;if("undefined"==typeof StopIteration){try{s=n[t](e)}catch(a){return T(a)}return s.done?s.value:v(s.value,i,o)}try{s=n[t](e)}catch(a){return r(a)?a.value:T(a)}return v(s,i,o)}var n=t.apply(this,arguments),i=e.bind(e,"next"),o=e.bind(e,"throw");return i()}}function C(t){c.done(c.async(t)())}function D(t){throw new H(t)}function I(t){return function(){return L([this,M(arguments)],function(e,n){return t.apply(e,n)})}}function U(t,e,n){return c(t).dispatch(e,n)}function M(t){return v(t,function(t){var e=0,n=f();return $(t,function(r,i,o){var s;_(i)&&"fulfilled"===(s=i.inspect()).state?t[o]=s.value:(++e,v(i,function(r){t[o]=r,0===--e&&n.resolve(t)},n.reject,function(t){n.notify({index:o,value:t})}))},void 0),0===e&&n.resolve(t),n.promise})}function P(t){return v(t,function(t){return t=Y(t,c),v(M(Y(t,function(t){return v(t,V,V)})),function(){return t})})}function j(t){return c(t).allSettled()}function F(t,e){return c(t).then(void 0,void 0,e)}function B(t,e){return c(t).nodeify(e)}var z=!1;try{throw new Error}catch(q){z=!!q.stack}var X,H,W=l(),V=function(){},J=function(){function e(){for(;n.next;){n=n.next;var t=n.task;n.task=void 0;var r=n.domain;r&&(n.domain=void 0,r.enter());try{t()}catch(o){if(s)throw r&&r.exit(),setTimeout(e,0),r&&r.enter(),o;setTimeout(function(){throw o},0)}r&&r.exit()}i=!1}var n={task:void 0,next:null},r=n,i=!1,o=void 0,s=!1;if(J=function(e){r=r.next={task:e,domain:s&&t.domain,next:null},i||(i=!0,o())},"undefined"!=typeof t&&t.nextTick)s=!0,o=function(){t.nextTick(e)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var a=new MessageChannel;a.port1.onmessage=function(){o=u,a.port1.onmessage=e,e()};var u=function(){a.port2.postMessage(0)};o=function(){setTimeout(e,0),u()}}else o=function(){setTimeout(e,0)};return J}(),G=Function.call,K=e(Array.prototype.slice),$=e(Array.prototype.reduce||function(t,e){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)n in this&&(e=t(e,this[n],n));return e}),Q=e(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),Y=e(Array.prototype.map||function(t,e){var n=this,r=[];return $(n,function(i,o,s){r.push(t.call(e,o,s,n))},void 0),r}),Z=Object.create||function(t){function e(){}return e.prototype=t,new e},te=e(Object.prototype.hasOwnProperty),ee=Object.keys||function(t){var e=[];for(var n in t)te(t,n)&&e.push(n);return e},ne=e(Object.prototype.toString);H="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var re="From previous event:";c.resolve=c,c.nextTick=J,c.longStackSupport=!1,c.defer=f,f.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):t.resolve(arguments.length>2?K(arguments,1):n)}},c.Promise=p,c.promise=p,p.race=d,p.all=M,p.reject=T,p.resolve=c,c.passByCopy=function(t){return t},g.prototype.passByCopy=function(){return this},c.join=function(t,e){return c(t).join(e)},g.prototype.join=function(t){return c([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})},c.race=d,g.prototype.race=function(){return this.then(c.race)},c.makePromise=g,g.prototype.toString=function(){return"[object Promise]"},g.prototype.then=function(t,e,n){function r(e){try{return"function"==typeof t?t(e):e}catch(n){return T(n)}}function o(t){if("function"==typeof e){i(t,a);try{return e(t)}catch(n){return T(n)}}return T(t)}function s(t){return"function"==typeof n?n(t):t}var a=this,u=f(),l=!1;return J(function(){a.promiseDispatch(function(t){l||(l=!0,u.resolve(r(t)))},"when",[function(t){l||(l=!0,u.resolve(o(t)))}])}),a.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=s(t)}catch(r){if(n=!0,!c.onerror)throw r;c.onerror(r)}n||u.notify(e)}]),u.promise},c.when=v,g.prototype.thenResolve=function(t){return this.then(function(){return t})},c.thenResolve=function(t,e){return c(t).thenResolve(e)},g.prototype.thenReject=function(t){return this.then(function(){throw t})},c.thenReject=function(t,e){return c(t).thenReject(e)},c.nearer=m,c.isPromise=_,c.isPromiseAlike=y,c.isPending=w,g.prototype.isPending=function(){return"pending"===this.inspect().state},c.isFulfilled=b,g.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},c.isRejected=E,g.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ie=[],oe=[],se=!0;c.resetUnhandledRejections=x,c.getUnhandledReasons=function(){return ie.slice()},c.stopUnhandledRejectionTracking=function(){x(),se=!1},x(),c.reject=T,c.fulfill=k,c.master=N,c.spread=L,g.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},c.async=R,c.spawn=C,c["return"]=D,c.promised=I,c.dispatch=U,g.prototype.dispatch=function(t,e){var n=this,r=f();return J(function(){n.promiseDispatch(r.resolve,t,e)}),r.promise},c.get=function(t,e){return c(t).dispatch("get",[e])},g.prototype.get=function(t){return this.dispatch("get",[t])},c.set=function(t,e,n){return c(t).dispatch("set",[e,n])},g.prototype.set=function(t,e){return this.dispatch("set",[t,e])},c.del=c["delete"]=function(t,e){return c(t).dispatch("delete",[e])},g.prototype.del=g.prototype["delete"]=function(t){return this.dispatch("delete",[t])},c.mapply=c.post=function(t,e,n){return c(t).dispatch("post",[e,n])},g.prototype.mapply=g.prototype.post=function(t,e){return this.dispatch("post",[t,e])},c.send=c.mcall=c.invoke=function(t,e){return c(t).dispatch("post",[e,K(arguments,2)])},g.prototype.send=g.prototype.mcall=g.prototype.invoke=function(t){return this.dispatch("post",[t,K(arguments,1)])},c.fapply=function(t,e){return c(t).dispatch("apply",[void 0,e])},g.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},c["try"]=c.fcall=function(t){return c(t).dispatch("apply",[void 0,K(arguments,1)])},g.prototype.fcall=function(){return this.dispatch("apply",[void 0,K(arguments)])},c.fbind=function(t){var e=c(t),n=K(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(K(arguments))])}},g.prototype.fbind=function(){var t=this,e=K(arguments);return function(){return t.dispatch("apply",[this,e.concat(K(arguments))])}},c.keys=function(t){return c(t).dispatch("keys",[])},g.prototype.keys=function(){return this.dispatch("keys",[])},c.all=M,g.prototype.all=function(){return M(this)},c.allResolved=h(P,"allResolved","allSettled"),g.prototype.allResolved=function(){return P(this)},c.allSettled=j,g.prototype.allSettled=function(){return this.then(function(t){return M(Y(t,function(t){function e(){return t.inspect()}return t=c(t),t.then(e,e)}))})},c.fail=c["catch"]=function(t,e){return c(t).then(void 0,e)},g.prototype.fail=g.prototype["catch"]=function(t){return this.then(void 0,t)},c.progress=F,g.prototype.progress=function(t){return this.then(void 0,void 0,t)},c.fin=c["finally"]=function(t,e){return c(t)["finally"](e)},g.prototype.fin=g.prototype["finally"]=function(t){return t=c(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},c.done=function(t,e,n,r){return c(t).done(e,n,r)},g.prototype.done=function(e,n,r){var o=function(t){J(function(){if(i(t,s),!c.onerror)throw t;c.onerror(t)})},s=e||n||r?this.then(e,n,r):this;"object"==typeof t&&t&&t.domain&&(o=t.domain.bind(o)),s.then(void 0,o)},c.timeout=function(t,e,n){return c(t).timeout(e,n)},g.prototype.timeout=function(t,e){var n=f(),r=setTimeout(function(){n.reject(new Error(e||"Timed out after "+t+" ms"))},t);return this.then(function(t){clearTimeout(r),n.resolve(t)},function(t){clearTimeout(r),n.reject(t)},n.notify),n.promise},c.delay=function(t,e){return void 0===e&&(e=t,t=void 0),c(t).delay(e)},g.prototype.delay=function(t){return this.then(function(e){var n=f();return setTimeout(function(){n.resolve(e)},t),n.promise})},c.nfapply=function(t,e){return c(t).nfapply(e)},g.prototype.nfapply=function(t){var e=f(),n=K(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},c.nfcall=function(t){var e=K(arguments,1);return c(t).nfapply(e)},g.prototype.nfcall=function(){var t=K(arguments),e=f();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},c.nfbind=c.denodeify=function(t){var e=K(arguments,1);return function(){var n=e.concat(K(arguments)),r=f();return n.push(r.makeNodeResolver()),c(t).fapply(n).fail(r.reject),r.promise}},g.prototype.nfbind=g.prototype.denodeify=function(){var t=K(arguments);return t.unshift(this),c.denodeify.apply(void 0,t)},c.nbind=function(t,e){var n=K(arguments,2);return function(){function r(){return t.apply(e,arguments)}var i=n.concat(K(arguments)),o=f();return i.push(o.makeNodeResolver()),c(r).fapply(i).fail(o.reject),o.promise}},g.prototype.nbind=function(){var t=K(arguments,0);return t.unshift(this),c.nbind.apply(void 0,t)},c.nmapply=c.npost=function(t,e,n){return c(t).npost(e,n)},g.prototype.nmapply=g.prototype.npost=function(t,e){var n=K(e||[]),r=f();return n.push(r.makeNodeResolver()),this.dispatch("post",[t,n]).fail(r.reject),r.promise},c.nsend=c.nmcall=c.ninvoke=function(t,e){var n=K(arguments,2),r=f();return n.push(r.makeNodeResolver()),c(t).dispatch("post",[e,n]).fail(r.reject),r.promise},g.prototype.nsend=g.prototype.nmcall=g.prototype.ninvoke=function(t){var e=K(arguments,1),n=f();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},c.nodeify=B,g.prototype.nodeify=function(t){return t?void this.then(function(e){J(function(){t(null,e)})},function(e){J(function(){t(e)})}):this};var ae=l();return c})}).call(this,t("vbrzzp"))},{vbrzzp:15}],17:[function(t,e){!function(t){"use strict";var n=t.Ractive,r=void 0,i=function(){var t,e;return t={el:null,template:"",complete:null,preserveWhitespace:!1,append:!1,twoway:!0,modifyArrays:!0,lazy:!1,debug:!1,noIntro:!1,transitionsEnabled:!0,magic:!1,noCssTransform:!1,adapt:[],sanitize:!1,stripComments:!0,isolated:!1,delimiters:["{{","}}"],tripleDelimiters:["{{{","}}}"],computed:null},e={keys:Object.keys(t),defaults:t}}(r),o=function(){return"undefined"!=typeof document?document&&document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"):void 0}(),s={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},a=function(t,e){return t?function(t,n){return n&&n!==e.html?document.createElementNS(n,t):document.createElement(t)}:function(t,n){if(n&&n!==e.html)throw"This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you're trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information";return document.createElement(t)}}(o,s),u="object"==typeof document,l=function(t){try{return Object.defineProperty({},"test",{value:0}),t&&Object.defineProperty(document.createElement("div"),"test",{value:0}),Object.defineProperty}catch(e){return function(t,e,n){t[e]=n.value}}}(u),h=function(t,e,n){try{try{Object.defineProperties({},{test:{value:0}})}catch(r){throw r}return n&&Object.defineProperties(t("div"),{test:{value:0}}),Object.defineProperties}catch(r){return function(t,n){var r;for(r in n)n.hasOwnProperty(r)&&e(t,r,n[r])}}}(a,l,u),c=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},f=function(t){return function(e,n,r){var i;if("string"!=typeof n||!t(r))throw new Error("Bad arguments");if(i=+e.get(n)||0,!t(i))throw new Error("Cannot add to a non-numeric value");return e.set(n,i+r)}}(c),p=function(t){return function(e,n){return t(this,e,void 0===n?1:+n)}}(f),d=function(t,e){return null===t&&null===e?!0:"object"==typeof t||"object"==typeof e?!1:t===e},g=function(){function t(t){setTimeout(t,0)}function e(t,e){return function(){for(var n;n=t.shift();)n(e)}}function n(t,e,i,o){var s;if(e===t)throw new TypeError("A promise's fulfillment handler cannot return the same promise");if(e instanceof r)e.then(i,o);else if(!e||"object"!=typeof e&&"function"!=typeof e)i(e);else{try{s=e.then}catch(a){return void o(a)}if("function"==typeof s){var u,l,h;l=function(e){u||(u=!0,n(t,e,i,o))},h=function(t){u||(u=!0,o(t))};try{s.call(e,l,h)}catch(a){if(!u)return o(a),void(u=!0)}}else i(e)}}var r,i={},o={},s={};return r=function(a){var u,l,h,c,f,p,d=[],g=[],v=i;return h=function(n){return function(r){v===i&&(u=r,v=n,l=e(v===o?d:g,u),t(l))}},c=h(o),f=h(s),a(c,f),p={then:function(e,o){var s=new r(function(r,a){var u=function(t,e,i){e.push("function"==typeof t?function(e){var i;try{i=t(e),n(s,i,r,a)}catch(o){a(o)}}:i)};u(e,d,r),u(o,g,a),v!==i&&t(l)});return s}},p["catch"]=function(t){return this.then(null,t)},p},r.all=function(t){return new r(function(e,n){var r,i,o,s=[];if(!t.length)return void e(s);for(o=function(i){t[i].then(function(t){s[i]=t,--r||e(s)},n)},r=i=t.length;i--;)o(i)})},r.resolve=function(t){return new r(function(e){e(t)})},r.reject=function(t){return new r(function(e,n){n(t)})},r}(),v=function(){var t=/\[\s*(\*|[0-9]|[1-9][0-9]+)\s*\]/g;return function(e){return(e||"").replace(t,".$1")}}(),m=["o","ms","moz","webkit"],_=function(t){return"undefined"!=typeof window?(function(t,e,n){var r,i;if(!n.requestAnimationFrame){for(r=0;r<t.length&&!n.requestAnimationFrame;++r)n.requestAnimationFrame=n[t[r]+"RequestAnimationFrame"];n.requestAnimationFrame||(i=n.setTimeout,n.requestAnimationFrame=function(t){var n,r,o;return n=Date.now(),r=Math.max(0,16-(n-e)),o=i(function(){t(n+r)},r),e=n+r,o})}}(t,0,window),window.requestAnimationFrame):void 0}(m),y=function(){return"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?function(){return window.performance.now()}:function(){return Date.now()}}(),w=[],b=function(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)},E=function(t,e,n){var r,i,o,s,a,u="/* Ractive.js component styles */\n",l={},h=[];if(e)return t.push(function(){r=t.runloop}),i=document.createElement("style"),i.type="text/css",o=document.getElementsByTagName("head")[0],a=!1,s=i.styleSheet,{add:function(t){t.css&&(l[t._guid]||(l[t._guid]=0,h.push(t.css),r.scheduleCssUpdate()),l[t._guid]+=1)},remove:function(t){t.css&&(l[t._guid]-=1,l[t._guid]||(n(h,t.css),r.scheduleCssUpdate()))},update:function(){var t;h.length?(t=u+h.join(" "),s?s.cssText=t:i.innerHTML=t,a||o.appendChild(i)):a&&o.removeChild(i)}}}(w,u,b),x=function(t,e){var n,r,i,o,s,a;for(n=[],a=t._rendering?t.fragment.docFrag:t.el,r=a.querySelectorAll('input[type="checkbox"][name="{{'+e+'}}"]'),o=r.length,s=0;o>s;s+=1)i=r[s],(i.hasAttribute("checked")||i.checked)&&n.push(i._ractive.value);return n},S=Object.prototype.hasOwnProperty,A=function(t){do if(t.context)return t.context;while(t=t.parent);return""},T=function(t,e,n,r){var i,o='Could not resolve reference - too many "../" prefixes';return t.push(function(){i=t.get}),function(t,s,a){var u,l,h,c,f,p,d,g,v;if(s=e(s),"."===s)return r(a);if("."===s.charAt(0)){if(u=r(a),l=u?u.split("."):[],"../"===s.substr(0,3)){for(;"../"===s.substr(0,3);){if(!l.length)throw new Error(o);l.pop(),s=s.substring(3)}return l.push(s),l.join(".")}return u?u+s:s.substring(1)}h=s.split("."),c=h.pop(),f=h.length?"."+h.join("."):"";do if(u=a.context,u&&(v=!0,p=u+f,d=i(t,p),(g=t._wrapped[p])&&(d=g.get()),d&&("object"==typeof d||"function"==typeof d)&&c in d))return u+"."+s;while(a=a.parent);return v||t._parent&&!t.isolated?n.call(t.data,s)?s:void 0!==i(t,s)?s:void 0:s
}}(w,v,S,A),k=function(t){var e,n,r,i,o=[""];for(e=t.length;e--;)for(n=t[e],r=n.split(".");r.length>1;)r.pop(),i=r.join("."),o[i]!==!0&&(o.push(i),o[i]=!0);return o},O=function(){function t(t,n,r){var o;for(t._patternObservers.length&&i(t,n,n,r,!0),o=0;o<t._deps.length;o+=1)e(t,n,o,r)}function e(t,e,i,o){var s=t._deps[i];s&&(n(s[e]),o||r(t._depsMap[e],t,i))}function n(t){var e,n;if(t)for(n=t.length,e=0;n>e;e+=1)t[e].update()}function r(t,n,r,i){var o;if(t)for(o=t.length;o--;)e(n,t[o],r,i)}function i(t,e,n,r,s){var u,l,h,c,f,p,d,g;for(u=t._patternObservers.length;u--;)l=t._patternObservers[u],l.regex.test(n)&&l.update(n);r||(g=function(e){if(h=t._depsMap[e])for(u=h.length;u--;)c=h[u],f=a.exec(c)[0],p=n?n+"."+f:f,i(t,c,p)},s?(d=o(n),d.forEach(g)):g(e))}function o(t){var e,n,r,i,o,a;for(e=t.split("."),n=s(e.length),o=[],r=function(t,n){return t?"*":e[n]},i=n.length;i--;)a=n[i].map(r).join("."),o[a]||(o.push(a),o[a]=!0);return o}function s(t){var e,n,r,i,o,s="";if(!u[t]){for(r=[];s.length<t;)s+=1;for(e=parseInt(s,2),i=function(t){return"1"===t},o=0;e>=o;o+=1){for(n=o.toString(2);n.length<t;)n="0"+n;r[o]=Array.prototype.map.call(n,i)}u[t]=r}return u[t]}var a,u={};return a=/[^\.]+$/,t.multiple=function(t,n,r){var o,s,a;if(a=n.length,t._patternObservers.length)for(o=a;o--;)i(t,n[o],n[o],r,!0);for(o=0;o<t._deps.length;o+=1)if(t._deps[o])for(s=a;s--;)e(t,n[s],o,r)},t}(),N=function(t){var e,n,r,i;return e=function(t,e){var o=[];return o.detachQueue=[],o.remove=r,o.init=i,o._check=n,o._callback=t,o._previous=e,e&&e.push(o),o},n=function(){var t;if(this._ready&&!this.length){for(;t=this.detachQueue.pop();)t.detach();"function"==typeof this._callback&&this._callback(),this._previous&&this._previous.remove(this)}},r=function(e){t(this,e),this._check()},i=function(){this._ready=!0,this._check()},e}(b),L=function(t,e,n,r,i,o,s,a){function u(){var t,n,r;for(y&&(y.focus(),y=null);t=S.pop();)t.update().deferred=!1;for(;t=w.pop();)t._sort();for(;t=b.pop();)t.init();for(;t=E.pop();)t.init();for(;t=x.pop();)t.update();for(;t=A.pop();)t.active=!1;for(;t=D.pop();)if(D[t._guid]=!1,t._changes.length){for(r={};n=t._changes.pop();)r[n]=f(t,n);t.fire("change",r)}d&&(e.update(),d=!1)}function l(){var t,e,n;for(n=D.length;n--;)t=D[n],t._changes.length&&(e=o(t._changes),s.multiple(t,e,!0));for(h();v;){for(v=!1;t=k.pop();)t.update();for(;t=T.pop();)t.update().deferred=!1;for(;t=O.pop();)t.deferredUpdate();for(;t=L.pop();)p(t.root,t.keypath,r(t.root,t.keypath));for(;t=R.pop();)t.update()}}function h(){var t,e,n;if(C.length)for(t=C.splice(0,C.length);e=t.pop();)e.keypath||(n=i(e.root,e.ref,e.parentFragment),void 0!==n?e.resolve(n):C.push(e))}t.push(function(){f=t.get,p=t.set});var c,f,p,d,g,v=!1,m=!1,_=0,y=null,w=[],b=[],E=[],x=[],S=[],A=[],T=[],k=[],O=[],N={},L=[],R=[],C=[],D=[];return c={start:function(t,e){this.addInstance(t),m||(_+=1,g=a(e,g))},end:function(){return m?void h():(--_||(m=!0,l(),m=!1,u()),g.init(),void(g=g._previous))},trigger:function(){return _||m?void h():(m=!0,l(),m=!1,void u())},focus:function(t){y=t},addInstance:function(t){t&&!D[t._guid]&&(D.push(t),D[D._guid]=!0)},addLiveQuery:function(t){w.push(t)},addDecorator:function(t){b.push(t)},addTransition:function(t){t._manager=g,g.push(t),E.push(t)},addObserver:function(t){x.push(t)},addAttribute:function(t){S.push(t)},addBinding:function(t){t.active=!0,A.push(t)},scheduleCssUpdate:function(){_||m?d=!0:e.update()},addEvaluator:function(t){v=!0,T.push(t)},addComputation:function(t){v=!0,k.push(t)},addSelectValue:function(t){v=!0,O.push(t)},addCheckbox:function(t){N[t.keypath]||(v=!0,L.push(t))},addRadio:function(t){v=!0,R.push(t)},addUnresolved:function(t){v=!0,C.push(t)},removeUnresolved:function(t){n(C,t)},detachWhenReady:function(t){g.detachQueue.push(t)}},t.runloop=c,c}(w,E,b,x,T,k,O,N),R=function(t,e,n){var r=[],i={tick:function(){var o,s,a;for(a=e(),n.start(),o=0;o<r.length;o+=1)s=r[o],s.tick(a)||r.splice(o--,1);n.end(),r.length?t(i.tick):i.running=!1},add:function(e){r.push(e),i.running||(i.running=!0,t(i.tick))},abort:function(t,e){for(var n,i=r.length;i--;)n=r[i],n.root===e&&n.keypath===t&&n.stop()}};return i}(_,y,L),C=function(){var t=Object.prototype.toString;return function(e){return"[object Array]"===t.call(e)}}(),D=function(t){return function(e){var n,r;if(!e||"object"!=typeof e)return e;if(t(e))return e.slice();n={};for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n}}(C),I={},U=function(t,e,n){switch(e){case"splice":return n;case"sort":case"reverse":return null;case"pop":return t.length?[-1]:null;case"push":return[t.length,0].concat(n);case"shift":return[0,1];case"unshift":return[0,0].concat(n)}},M=function(t,e){var n,r,i,o;return e?(n=+(e[0]<0?t.length+e[0]:e[0]),r=Math.max(0,e.length-2),i=void 0!==e[1]?e[1]:t.length-n,i=Math.min(i,t.length-n),o=r-i,{start:n,balance:o,added:r,removed:i}):null},P={TEXT:1,INTERPOLATOR:2,TRIPLE:3,SECTION:4,INVERTED:5,CLOSING:6,ELEMENT:7,PARTIAL:8,COMMENT:9,DELIMCHANGE:10,MUSTACHE:11,TAG:12,ATTRIBUTE:13,COMPONENT:15,NUMBER_LITERAL:20,STRING_LITERAL:21,ARRAY_LITERAL:22,OBJECT_LITERAL:23,BOOLEAN_LITERAL:24,GLOBAL:26,KEY_VALUE_PAIR:27,REFERENCE:30,REFINEMENT:31,MEMBER:32,PREFIX_OPERATOR:33,BRACKETED:34,CONDITIONAL:35,INFIX_OPERATOR:36,INVOCATION:40},j=function po(t,e,n){var r,i;if(n||(i=t._wrapped[e])&&i.teardown()!==!1&&(t._wrapped[e]=null),t._cache[e]=void 0,r=t._cacheMap[e])for(;r.length;)po(t,r.pop())},F=function(){var t=/^\s*[0-9]+\s*$/;return function(e){return t.test(e)?[]:{}}}(),B=function(t,e,n,r,i){function o(t,a,u,l){var h,c,f,p,d,g,v,m;e(t._cache[a],u)||(d=t._computations[a],g=t._wrapped[a],v=t._evaluators[a],d&&!d.setting&&d.set(u),g&&g.reset&&(m=g.reset(u)!==!1,m&&(u=g.get())),v&&(v.value=u),d||v||m||(h=a.split("."),c=h.pop(),f=h.join("."),g=t._wrapped[f],g&&g.set?g.set(c,u):(p=g?g.get():s(t,f),p||(p=n(c),o(t,f,p,!0)),p[c]=u)),r(t,a,m),l||(t._changes.push(a),i(t,a)))}var s;return t.push(function(){s=t.get}),t.set=o,o}(w,d,F,j,O),z=function(t,e,n,r){return function(i,o,s,a){var u,l,h,c,f,p,d,g,v,m;if(u=i.root,l=i.keypath,u._changes.push(l),"sort"===s||"reverse"===s)return void r(u,l,o);if(a){for(h=a.balance?o.length-Math.min(a.balance,0):a.added,f=a.start;h>f;f+=1)e(u,l+"."+f);if(c=function(e){e.keypath===l&&e.type===t.SECTION&&!e.inverted&&e.docFrag?e.splice(a):e.update()},u._deps.forEach(function(t){var e=t[l];e&&e.forEach(c)}),a.added&&a.removed)for(p=Math.max(a.added,a.removed),d=a.start,g=d+p,m=a.added===a.removed,f=d;g>f;f+=1)v=l+"."+f,n(u,v);m||(e(u,l+".length"),n(u,l+".length",!0))}}}(P,j,O,B),q=function(t,e,n,r,i){var o,s,a,u=[],l=["pop","push","reverse","shift","sort","splice","unshift"];return l.forEach(function(o){var s=function(){var e,s,a,u,l;for(e=n(this,o,Array.prototype.slice.call(arguments)),s=r(this,e),a=Array.prototype[o].apply(this,arguments),this._ractive.setting=!0,l=this._ractive.wrappers.length;l--;)u=this._ractive.wrappers[l],t.start(u.root),i(u,this,o,s),t.end();return this._ractive.setting=!1,a};e(u,o,{value:s})}),o={},o.__proto__?(s=function(t){t.__proto__=u},a=function(t){t.__proto__=Array.prototype}):(s=function(t){var n,r;for(n=l.length;n--;)r=l[n],e(t,r,{value:u[r],configurable:!0})},a=function(t){var e;for(e=l.length;e--;)delete t[l[e]]}),s.unpatch=a,s}(L,l,U,M,z),X=function(t,e,n){var r,i,o;return r={filter:function(t){return e(t)&&(!t._ractive||!t._ractive.setting)},wrap:function(t,e,n){return new i(t,e,n)}},i=function(e,r,i){this.root=e,this.value=r,this.keypath=i,r._ractive||(t(r,"_ractive",{value:{wrappers:[],instances:[],setting:!1},configurable:!0}),n(r)),r._ractive.instances[e._guid]||(r._ractive.instances[e._guid]=0,r._ractive.instances.push(e)),r._ractive.instances[e._guid]+=1,r._ractive.wrappers.push(this)},i.prototype={get:function(){return this.value},teardown:function(){var t,e,r,i,s;if(t=this.value,e=t._ractive,r=e.wrappers,i=e.instances,e.setting)return!1;if(s=r.indexOf(this),-1===s)throw new Error(o);if(r.splice(s,1),r.length){if(i[this.root._guid]-=1,!i[this.root._guid]){if(s=i.indexOf(this.root),-1===s)throw new Error(o);i.splice(s,1)}}else delete t._ractive,n.unpatch(this.value)}},o="Something went wrong in a rather interesting way",r}(l,C,q),H=function(t,e,n,r,i){function o(e,n,o){function s(e){var o,s;e.value=n,e.updating||(s=e.ractive,o=e.keypath,e.updating=!0,t.start(s),s._changes.push(o),r(s,o),i(s,o),t.end(),e.updating=!1)}var a,u,l,h,c,f;if(a=e.obj,u=e.prop,o&&!o.configurable){if("length"===u)return;throw new Error('Cannot use magic mode with property "'+u+'" - object is not configurable')}o&&(l=o.get,h=o.set),c=l||function(){return n},f=function(t){h&&h(t),n=l?l():t,f._ractiveWrappers.forEach(s)},f._ractiveWrappers=[e],Object.defineProperty(a,u,{get:c,set:f,enumerable:!0,configurable:!0})}var s,a;try{Object.defineProperty({},"test",{value:0})}catch(u){return!1}return s={filter:function(t,e,r){var i,o,s,a,u;return e?(i=e.split("."),o=i.pop(),s=i.join("."),(a=r._wrapped[s])&&!a.magic?!1:(u=r.get(s),n(u)&&/^[0-9]+$/.test(o)?!1:u&&("object"==typeof u||"function"==typeof u))):!1},wrap:function(t,e,n){return new a(t,e,n)}},a=function(t,e,n){var r,i,s,a;return this.magic=!0,this.ractive=t,this.keypath=n,this.value=e,r=n.split("."),this.prop=r.pop(),i=r.join("."),this.obj=i?t.get(i):t.data,s=this.originalDescriptor=Object.getOwnPropertyDescriptor(this.obj,this.prop),s&&s.set&&(a=s.set._ractiveWrappers)?void(-1===a.indexOf(this)&&a.push(this)):void o(this,e,s)},a.prototype={get:function(){return this.value},reset:function(t){this.updating||(this.updating=!0,this.obj[this.prop]=t,r(this.ractive,this.keypath),this.updating=!1)},set:function(t,n){this.updating||(this.obj[this.prop]||(this.updating=!0,this.obj[this.prop]=e(t),this.updating=!1),this.obj[this.prop][t]=n)},teardown:function(){var t,e,n,r,i;return this.updating?!1:(t=Object.getOwnPropertyDescriptor(this.obj,this.prop),e=t&&t.set,void(e&&(r=e._ractiveWrappers,i=r.indexOf(this),-1!==i&&r.splice(i,1),r.length||(n=this.obj[this.prop],Object.defineProperty(this.obj,this.prop,this.originalDescriptor||{writable:!0,enumerable:!0,configurable:!0}),this.obj[this.prop]=n))))}},s}(L,F,C,j,O),W=function(t,e){if(!t)return!1;var n,r;return n={filter:function(n,r,i){return t.filter(n,r,i)&&e.filter(n)},wrap:function(t,e,n){return new r(t,e,n)}},r=function(n,r,i){this.value=r,this.magic=!0,this.magicWrapper=t.wrap(n,r,i),this.arrayWrapper=e.wrap(n,r,i)},r.prototype={get:function(){return this.value},teardown:function(){this.arrayWrapper.teardown(),this.magicWrapper.teardown()},reset:function(t){return this.magicWrapper.reset(t)}},n}(H,X),V=function(t,e,n,r){function i(t,e){var n,r={};if(!e)return t;e+=".";for(n in t)t.hasOwnProperty(n)&&(r[e+n]=t[n]);return r}function o(t){var e;return s[t]||(e=t?t+".":"",s[t]=function(n,r){var o;return"string"==typeof n?(o={},o[e+n]=r,o):"object"==typeof n?e?i(n,t):n:void 0}),s[t]}var s={};return function(i,s,a,u){var l,h,c,f;for(l=i.adapt.length,h=0;l>h;h+=1){if(c=i.adapt[h],"string"==typeof c){if(!t[c])throw new Error('Missing adaptor "'+c+'"');c=i.adapt[h]=t[c]}if(c.filter(a,s,i))return f=i._wrapped[s]=c.wrap(i,a,s,o(s)),f.value=a,a}return u||(i.magic?r.filter(a,s,i)?i._wrapped[s]=r.wrap(i,a,s):n.filter(a,s,i)&&(i._wrapped[s]=n.wrap(i,a,s)):i.modifyArrays&&e.filter(a,s,i)&&(i._wrapped[s]=e.wrap(i,a,s))),a}}(I,X,H,W),J=function(){function t(t,e){var n,r,i;for(n=e.split(".");n.length;)n.pop(),r=n.join("."),i=t._depsMap[r]||(t._depsMap[r]=[]),void 0===i[e]&&(i[e]=0,i[i.length]=e),i[e]+=1,e=r}return function(e){var n,r,i,o,s;i=e.root,o=e.keypath,s=e.priority,n=i._deps[s]||(i._deps[s]={}),r=n[o]||(n[o]=[]),r.push(e),e.registered=!0,o&&t(i,o)}}(),G=function(){function t(t,e){var n,r,i;for(n=e.split(".");n.length;)n.pop(),r=n.join("."),i=t._depsMap[r],i[e]-=1,i[e]||(i.splice(i.indexOf(e),1),i[e]=void 0),e=r}return function(e){var n,r,i,o,s;if(i=e.root,o=e.keypath,s=e.priority,n=i._deps[s][o],r=n.indexOf(e),-1===r||!e.registered)throw new Error("Attempted to remove a dependant that was no longer registered! This should not happen. If you are seeing this bug in development please raise an issue at https://github.com/RactiveJS/Ractive/issues - thanks");n.splice(r,1),e.registered=!1,o&&t(i,o)}}(),K=function(t,e,n,r,i,o){var s,a;t.push(function(){s=t.get,a=t.set});var u=function(t,e,n,r,o){this.root=t,this.keypath=e,this.priority=o,this.otherInstance=n,this.otherKeypath=r,i(this),this.value=s(this.root,this.keypath)};return u.prototype={update:function(){var t;this.updating||this.counterpart&&this.counterpart.updating||(t=s(this.root,this.keypath),n(t)&&t._ractive&&t._ractive.setting||r(t,this.value)||(this.updating=!0,e.addInstance(this.otherInstance),a(this.otherInstance,this.otherKeypath,t),this.value=t,this.updating=!1))},reassign:function(t){o(this),o(this.counterpart),this.keypath=t,this.counterpart.otherKeypath=t,i(this),i(this.counterpart)},teardown:function(){o(this)}},function(t,e,n,r){var i,o,s,a,l,h;i=n+"="+r,s=t.bindings,s[i]||(s[i]=!0,o=t.instance,a=t.parentFragment.priority,l=new u(e,n,o,r,a),s.push(l),o.twoway&&(h=new u(o,r,e,n,1),s.push(h),l.counterpart=h,h.counterpart=l))}}(w,L,C,d,J,G),$=function(t,e,n){function r(t,r,i,o,s){n(r,o,s,!0),e(r.component,t,i,o)}var i;return t.push(function(){i=t.get}),function(t,e){var n,o,s,a,u;if(n=t._parent,o=t.component.parentFragment,o.indexRefs&&void 0!==(u=o.indexRefs[e]))return t.component.indexRefBindings[e]=e,u;do if(o.context&&(s=o.context+"."+e,a=i(n,s),void 0!==a))return r(n,t,s,e,a),a;while(o=o.parent);return a=i(n,e),void 0!==a?(r(n,t,e,e,a),a):void 0}}(w,K,B),Q={FAILED_LOOKUP:!0},Y=function(t,e,n,r,i,o){function s(t,e,n){var s,u,l,h,c=t._cache;return void 0===c[e]?((u=t._computations[e])?s=u.value:(l=t._wrapped[e])?s=l.value:e?s=(h=t._evaluators[e])?h.value:a(t,e):(r(t,"",t.data),s=t.data),c[e]=s):s=c[e],s===o&&(s=t._parent&&!t.isolated?i(t,e,n):void 0),n&&n.evaluateWrapped&&(l=t._wrapped[e])&&(s=l.get()),s}function a(t,i){var a,u,l,h,c,f,p,d;return a=i.split("."),u=a.pop(),l=a.join("."),h=s(t,l),(p=t._wrapped[l])&&(h=p.get()),null!==h&&void 0!==h?((c=t._cacheMap[l])?-1===c.indexOf(i)&&c.push(i):t._cacheMap[l]=[i],"object"!=typeof h||u in h?(d=!e.call(h,u),f=d?n(h[u]):h[u],f=r(t,i,f,!1),t._cache[i]=f,f):t._cache[i]=o):void 0}return t.get=s,s}(w,S,D,V,$,Q),Z=function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&"function"==typeof console.warn.apply?function(){console.warn.apply(console,arguments)}:function(){}}(),te=function(){var t=Object.prototype.toString;return function(e){return"object"==typeof e&&"[object Object]"===t.call(e)}}(),ee=function(t,e,n,r,i){var o,s,a;return t.push(function(){s=t.interpolate}),a=/^([+-]?[0-9]+\.?(?:[0-9]+)?)(px|em|ex|%|in|cm|mm|pt|pc)$/,o={number:function(t,e){var n;return i(t)&&i(e)?(t=+t,e=+e,n=e-t,n?function(e){return t+e*n}:function(){return t}):null},array:function(t,e){var r,i,o,a;if(!n(t)||!n(e))return null;for(r=[],i=[],a=o=Math.min(t.length,e.length);a--;)i[a]=s(t[a],e[a]);for(a=o;a<t.length;a+=1)r[a]=t[a];for(a=o;a<e.length;a+=1)r[a]=e[a];return function(t){for(var e=o;e--;)r[e]=i[e](t);return r}},object:function(t,n){var i,o,a,u,l;if(!r(t)||!r(n))return null;i=[],u={},a={};for(l in t)e.call(t,l)&&(e.call(n,l)?(i.push(l),a[l]=s(t[l],n[l])):u[l]=t[l]);for(l in n)e.call(n,l)&&!e.call(t,l)&&(u[l]=n[l]);return o=i.length,function(t){for(var e,n=o;n--;)e=i[n],u[e]=a[e](t);return u}},cssLength:function(t,e){var n,r,i,o,s,u,l,h;return 0!==t&&"string"!=typeof t||0!==e&&"string"!=typeof e?null:(n=a.exec(t),r=a.exec(e),i=n?n[2]:"",o=r?r[2]:"",i&&o&&i!==o?null:(l=i||o,s=n?+n[1]:0,u=r?+r[1]:0,h=u-s,h?function(t){return s+t*h+l}:function(){return s+l}))}}}(w,S,C,te,c),ne=function(t,e,n){function r(t){return function(){return t}}var i=function(t,i,o,s){if(t===i)return r(i);if(s){if(o.interpolators[s])return o.interpolators[s](t,i)||r(i);e('Missing "'+s+'" interpolator. You may need to download a plugin from [TODO]')}return n.number(t,i)||n.array(t,i)||n.object(t,i)||n.cssLength(t,i)||r(i)};return t.interpolate=i,i}(w,Z,ee),re=function(t,e,n,r){var i=function(t){var e;this.startTime=Date.now();for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);this.interpolator=n(this.from,this.to,this.root,this.interpolator),this.running=!0};return i.prototype={tick:function(){var n,i,o,s,a,u;return u=this.keypath,this.running?(s=Date.now(),n=s-this.startTime,n>=this.duration?(null!==u&&(e.start(this.root),r(this.root,u,this.to),e.end()),this.step&&this.step(1,this.to),this.complete(this.to),a=this.root._animations.indexOf(this),-1===a&&t("Animation was not found"),this.root._animations.splice(a,1),this.running=!1,!1):(i=this.easing?this.easing(n/this.duration):n/this.duration,null!==u&&(o=this.interpolator(i),e.start(this.root),r(this.root,u,o),e.end()),this.step&&this.step(i,o),!0)):!1},stop:function(){var e;this.running=!1,e=this.root._animations.indexOf(this),-1===e&&t("Animation was not found"),this.root._animations.splice(e,1)}},i}(Z,L,ne,B),ie=function(t,e,n,r,i,o){function s(e,s,a,l){var h,c,f,p;return s&&(s=n(s)),null!==s&&(p=i(e,s)),r.abort(s,e),t(p,a)?(l.complete&&l.complete(l.to),u):(l.easing&&(h="function"==typeof l.easing?l.easing:e.easing[l.easing],"function"!=typeof h&&(h=null)),c=void 0===l.duration?400:l.duration,f=new o({keypath:s,from:p,to:a,root:e,duration:c,easing:h,interpolator:l.interpolator,step:l.step,complete:l.complete}),r.add(f),e._animations.push(f),f)}var a=function(){},u={stop:a};return function(t,n,r){var i,o,u,l,h,c,f,p,d,g,v,m,_,y;if(i=new e(function(t){o=t}),"object"==typeof t){r=n||{},c=r.easing,f=r.duration,h=[],p=r.step,d=r.complete,(p||d)&&(v={},r.step=null,r.complete=null,g=function(t){return function(e,n){v[t]=n}});for(u in t)t.hasOwnProperty(u)&&((p||d)&&(m=g(u),r={easing:c,duration:f},p&&(r.step=m)),r.complete=d?m:a,h.push(s(this,u,t[u],r)));return(p||d)&&(y={easing:c,duration:f},p&&(y.step=function(t){p(t,v)}),d&&i.then(function(t){d(t,v)}),y.complete=o,_=s(this,null,null,y),h.push(_)),{stop:function(){for(var t;t=h.pop();)t.stop();_&&_.stop()}}}return r=r||{},r.complete&&i.then(r.complete),r.complete=o,l=s(this,t,n,r),i.stop=function(){l.stop()},i}}(d,g,v,R,Y,re),oe=function(){return this.fragment.detach()},se=function(t){return this.el?this.fragment.find(t):null},ae=function(t,e,n){var r,i,o,s,a,u,l;if(t){for(r=n("div"),i=["matches","matchesSelector"],l=function(t){return function(e,n){return e[t](n)}},a=i.length;a--;){if(o=i[a],r[o])return l(o);for(u=e.length;u--;)if(s=e[a]+o.substr(0,1).toUpperCase()+o.substring(1),r[s])return l(s)}return function(t,e){var n,r;for(n=(t.parentNode||t.document).querySelectorAll(e),r=n.length;r--;)if(n[r]===t)return!0;return!1}}}(u,m,a),ue=function(t){return function(e,n){var r=this._isComponentQuery?!this.selector||e.name===this.selector:t(e.node,this.selector);return r?(this.push(e.node||e.instance),n||this._makeDirty(),!0):void 0}}(ae),le=function(){var t,e,n;t=this._root[this._isComponentQuery?"liveComponentQueries":"liveQueries"],e=this.selector,n=t.indexOf(e),-1!==n&&(t.splice(n,1),t[e]=null)},he=function(){function t(t){var e;return(e=t.parentFragment)?e.owner:t.component&&(e=t.component.parentFragment)?e.owner:void 0}function e(e){var n,r;for(n=[e],r=t(e);r;)n.push(r),r=t(r);return n}return function(t,n){var r,i,o,s,a,u,l,h,c,f;for(r=e(t.component||t._ractive.proxy),i=e(n.component||n._ractive.proxy),o=r[r.length-1],s=i[i.length-1];o&&o===s;)r.pop(),i.pop(),a=o,o=r[r.length-1],s=i[i.length-1];if(o=o.component||o,s=s.component||s,c=o.parentFragment,f=s.parentFragment,c===f)return u=c.items.indexOf(o),l=f.items.indexOf(s),u-l||r.length-i.length;if(h=a.fragments)return u=h.indexOf(c),l=h.indexOf(f),u-l||r.length-i.length;throw new Error("An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/RactiveJS/Ractive/issues - thanks!")}}(),ce=function(t){return function(e,n){var r;return e.compareDocumentPosition?(r=e.compareDocumentPosition(n),2&r?1:-1):t(e,n)}}(he),fe=function(t,e){return function(){this.sort(this._isComponentQuery?e:t),this._dirty=!1}}(ce,he),pe=function(t){return function(){this._dirty||(t.addLiveQuery(this),this._dirty=!0)}}(L),de=function(t){var e=this.indexOf(this._isComponentQuery?t.instance:t);-1!==e&&this.splice(e,1)},ge=function(t,e,n,r,i,o){return function(s,a,u,l){var h=[];return t(h,{selector:{value:a},live:{value:u},_isComponentQuery:{value:l},_test:{value:e}}),u?(t(h,{cancel:{value:n},_root:{value:s},_sort:{value:r},_makeDirty:{value:i},_remove:{value:o},_dirty:{value:!1,writable:!0}}),h):h}}(h,ue,le,fe,pe,de),ve=function(t){return function(e,n){var r,i;return this.el?(n=n||{},r=this._liveQueries,(i=r[e])?n&&n.live?i:i.slice():(i=t(this,e,!!n.live,!1),i.live&&(r.push(e),r[e]=i),this.fragment.findAll(e,i),i)):[]}}(ge),me=function(t){return function(e,n){var r,i;return n=n||{},r=this._liveComponentQueries,(i=r[e])?n&&n.live?i:i.slice():(i=t(this,e,!!n.live,!0),i.live&&(r.push(e),r[e]=i),this.fragment.findAllComponents(e,i),i)}}(ge),_e=function(t){return this.fragment.findComponent(t)},ye=function(t){var e,n,r,i=this._subs[t];if(i)for(e=Array.prototype.slice.call(arguments,1),n=0,r=i.length;r>n;n+=1)i[n].apply(this,e)},we=function(t,e,n,r){var i,o={};t.push(function(){i=t.get});var s=function(t,e){this.root=t,this.ref=e,this.parentFragment=o,t._unresolvedImplicitDependencies[e]=!0,t._unresolvedImplicitDependencies.push(this),n.addUnresolved(this)};return s.prototype={resolve:function(){var t=this.root;r(t,this.ref),t._unresolvedImplicitDependencies[this.ref]=!1,e(t._unresolvedImplicitDependencies,this)},teardown:function(){n.removeUnresolved(this)}},s}(w,b,L,O),be=function(t,e,n){var r={isTopLevel:!0};return function(i){var o;return i=t(i),o=e(this,i,r),this._captured&&this._captured[i]!==!0&&(this._captured.push(i),this._captured[i]=!0,void 0===o&&this._unresolvedImplicitDependencies[i]!==!0&&new n(this,i)),o}}(v,Y,we),Ee=function(t){var e;return"undefined"!=typeof window&&document&&t?t.nodeType?t:"string"==typeof t&&(e=document.getElementById(t),!e&&document.querySelector&&(e=document.querySelector(t)),e&&e.nodeType)?e:t[0]&&t[0].nodeType?t[0]:null:null},xe=function(t){return function(e,n){if(e=t(e),n=t(n)||null,!e)throw new Error("You must specify a valid target to insert into");e.insertBefore(this.detach(),n),this.fragment.pNode=this.el=e}}(Ee),Se=function(t,e){var n,r,i,o;return n={},r=0,i=t.map(function(t,i){var s,a,u;a=r,u=e.length;do{if(s=e.indexOf(t,a),-1===s)return o=!0,-1;a=s+1}while(n[s]&&u>a);return s===r&&(r+=1),s!==i&&(o=!0),n[s]=!0,s}),i.unchanged=!o,i},Ae=function(t,e){return function(n,r,i,o){var s;n._changes.push(r),s=function(e){e.type===t.REFERENCE?e.update():e.keypath===r&&e.type===t.SECTION&&!e.inverted&&e.docFrag?e.merge(i):e.update()},n._deps.forEach(function(t){var e=t[r];e&&e.forEach(s)}),o||e(n,r+".length",!0)}}(P,O),Te=function(t,e,n,r,i,o,s){function a(t){return JSON.stringify(t)}function u(t){if(t===!0)return a;if("string"==typeof t)return l[t]||(l[t]=function(e){return e[t]}),l[t];if("function"==typeof t)return t;throw new Error("The `compare` option must be a function, or a string representing an identifying field (or `true` to use JSON.stringify)")}var l={};return function(a,l,h){var c,f,p,d,g,v,m,_;if(c=this.get(a),!n(c)||!n(l))return this.set(a,l,h&&h.complete);if(g=c.length===l.length,h&&h.compare){d=u(h.compare);try{f=c.map(d),p=l.map(d)}catch(y){if(this.debug)throw y;e("Merge operation: comparison failed. Falling back to identity checking"),f=c,p=l}}else f=c,p=l;return v=o(f,p),m=new r(function(t){_=t}),t.start(this,_),i(this,a,l,!0),s(this,a,v,g),t.end(),h&&h.complete&&m.then(h.complete),m}}(L,Z,C,g,B,Se,Ae),ke=function(t,e,n){var r=function(t,e,n,r){var i=this;this.root=t,this.keypath=e,this.callback=n,this.defer=r.defer,this.debug=r.debug,this.proxy={update:function(){i.reallyUpdate()}},this.priority=0,this.context=r&&r.context?r.context:t};return r.prototype={init:function(t){t!==!1?this.update():this.value=n(this.root,this.keypath)},update:function(){return this.defer&&this.ready?void t.addObserver(this.proxy):void this.reallyUpdate()},reallyUpdate:function(){var t,r;if(t=this.value,r=n(this.root,this.keypath),this.value=r,!this.updating){if(this.updating=!0,!e(r,t)||!this.ready)try{this.callback.call(this.context,r,t,this.keypath)}catch(i){if(this.debug||this.root.debug)throw i}this.updating=!1}}},r}(L,d,Y),Oe=function(t){return function(e,n){var r,i,o,s,a,u,l;for(r=n.split("."),s=[],u=function(n){var r,i;r=e._wrapped[n]?e._wrapped[n].get():e.get(n);for(i in r)!r.hasOwnProperty(i)||"_ractive"===i&&t(r)||a.push(n+"."+i)},l=function(t){return t+"."+i};i=r.shift();)"*"===i?(a=[],s.forEach(u),s=a):s[0]?s=s.map(l):s[0]=i;return o={},s.forEach(function(t){o[t]=e.get(t)}),o}}(C),Ne=function(t,e,n,r){var i,o=/\*/;return i=function(t,e,n,r){this.root=t,this.callback=n,this.defer=r.defer,this.debug=r.debug,this.keypath=e,this.regex=new RegExp("^"+e.replace(/\./g,"\\.").replace(/\*/g,"[^\\.]+")+"$"),this.values={},this.defer&&(this.proxies=[]),this.priority="pattern",this.context=r&&r.context?r.context:t},i.prototype={init:function(t){var e,n;if(e=r(this.root,this.keypath),t!==!1)for(n in e)e.hasOwnProperty(n)&&this.update(n);else this.values=e},update:function(e){var n;{if(!o.test(e))return this.defer&&this.ready?void t.addObserver(this.getProxy(e)):void this.reallyUpdate(e);n=r(this.root,e);for(e in n)n.hasOwnProperty(e)&&this.update(e)}},reallyUpdate:function(t){var r=n(this.root,t);if(this.updating)return void(this.values[t]=r);if(this.updating=!0,!e(r,this.values[t])||!this.ready){try{this.callback.call(this.context,r,this.values[t],t)}catch(i){if(this.debug||this.root.debug)throw i}this.values[t]=r}this.updating=!1},getProxy:function(t){var e=this;return this.proxies[t]||(this.proxies[t]={update:function(){e.reallyUpdate(t)}}),this.proxies[t]}},i}(L,d,Y,Oe),Le=function(t,e,n,r,i){var o=/\*/,s={};return function(a,u,l,h){var c,f;return u=t(u),h=h||s,o.test(u)?(c=new i(a,u,l,h),a._patternObservers.push(c),f=!0):c=new r(a,u,l,h),e(c),c.init(h.init),c.ready=!0,{cancel:function(){var t;f&&(t=a._patternObservers.indexOf(c),-1!==t&&a._patternObservers.splice(t,1)),n(c)}}}}(v,J,G,ke,Ne),Re=function(t,e){return function(n,r,i){var o,s,a,u;if(t(n)){i=r,s=n,o=[];for(n in s)s.hasOwnProperty(n)&&(r=s[n],o.push(this.observe(n,r,i)));return{cancel:function(){for(;o.length;)o.pop().cancel()}}}if("function"==typeof n)return i=r,r=n,n="",e(this,n,r,i);if(a=n.split(" "),1===a.length)return e(this,n,r,i);for(o=[],u=a.length;u--;)n=a[u],n&&o.push(e(this,n,r,i));return{cancel:function(){for(;o.length;)o.pop().cancel()}}}}(te,Le),Ce=function(t,e){var n,r;if(!e)if(t)this._subs[t]=[];else for(t in this._subs)delete this._subs[t];n=this._subs[t],n&&(r=n.indexOf(e),-1!==r&&n.splice(r,1))},De=function(t,e){var n,r,i=this;if("object"==typeof t){n=[];for(r in t)t.hasOwnProperty(r)&&n.push(this.on(r,t[r]));return{cancel:function(){for(var t;t=n.pop();)t.cancel()}}}return this._subs[t]?this._subs[t].push(e):this._subs[t]=[e],{cancel:function(){i.off(t,e)}}},Ie=function(){var t;try{Object.create(null),t=Object.create}catch(e){t=function(){var t=function(){};return function(e,n){var r;return null===e?{}:(t.prototype=e,r=new t,n&&Object.defineProperties(r,n),r)}}()}return t}(),Ue=function(t,e){return function(n,r){var i,o,s,a,u;if(n.owner=r.owner,s=n.parent=n.owner.parentFragment,n.root=r.root,n.pNode=r.pNode,n.pElement=r.pElement,n.context=r.context,n.owner.type===t.SECTION&&(n.index=r.index),s&&(a=s.indexRefs)){n.indexRefs=e(null);for(u in a)n.indexRefs[u]=a[u]}for(n.priority=s?s.priority+1:1,r.indexRef&&(n.indexRefs||(n.indexRefs={}),n.indexRefs[r.indexRef]=r.index),n.items=[],i=r.descriptor?r.descriptor.length:0,o=0;i>o;o+=1)n.items[n.items.length]=n.createItem({parentFragment:n,pElement:r.pElement,descriptor:r.descriptor[o],index:o})}}(P,Ie),Me=function(t,e){return t.substr(0,e.length+1)===e+"."},Pe=function(t){return function(e,n){return e===n||t(e,n)}}(Me),je=function(t){return function(e,n,r){return e===n?r:t(e,n)?e.replace(n+".",r+"."):void 0}}(Me),Fe=function(t,e){return function(n,r,i,o){n[r]&&!t(n[r],o)&&(n[r]=e(n[r],i,o))}}(Pe,je),Be=function(t){return function(e,n,r,i){void 0===this.html&&(t(this,"context",r,i),this.indexRefs&&void 0!==this.indexRefs[e]&&this.indexRefs[e]!==n&&(this.indexRefs[e]=n),this.items.forEach(function(t){t.reassign(e,n,r,i)}))}}(Fe),ze=function(t,e){return{init:t,reassign:e}}(Ue,Be),qe=function(t,e){function n(t){return o[t]||(o[t]=e(t))}var r,i,o={};try{e("table").innerHTML="foo"}catch(s){r=!0,i={TABLE:['<table class="x">',"</table>"],THEAD:['<table><thead class="x">',"</thead></table>"],TBODY:['<table><tbody class="x">',"</tbody></table>"],TR:['<table><tr class="x">',"</tr></table>"],SELECT:['<select class="x">',"</select>"]}}return function(e,o,s,a){var u,l,h=[];if(e)for(r&&(l=i[o])?(u=n("DIV"),u.innerHTML=l[0]+e+l[1],u=u.querySelector(".x")):s===t.svg?(u=n("DIV"),u.innerHTML='<svg class="x">'+e+"</svg>",u=u.querySelector(".x")):(u=n(o),u.innerHTML=e);u.firstChild;)h.push(u.firstChild),a.appendChild(u.firstChild);return h}}(s,a),Xe=function(){var t,e=this.node;return e&&(t=e.parentNode)?(t.removeChild(e),e):void 0},He=function(t,e){var n,r,i;return r=/</g,i=/>/g,n=function(e,n){this.type=t.TEXT,this.descriptor=e.descriptor,n&&(this.node=document.createTextNode(e.descriptor),n.appendChild(this.node))},n.prototype={detach:e,reassign:function(){},teardown:function(t){t&&this.detach()},firstNode:function(){return this.node},toString:function(){return(""+this.descriptor).replace(r,"&lt;").replace(i,"&gt;")}},n}(P,Xe),We=function(t,e){return function(n){n.keypath?e(n):t.removeUnresolved(n)}}(L,G),Ve=function(t){var e=function(e,n,r,i){this.root=e,this.ref=n,this.parentFragment=r,this.resolve=i,t.addUnresolved(this)};return e.prototype={teardown:function(){t.removeUnresolved(this)}},e}(L),Je=function(t,e,n,r,i){function o(t,e,r){var i,o,s;if(!a.test(t.toString()))return n(t,"_nowrap",{value:!0}),t;if(!t["_"+e._guid]){n(t,"_"+e._guid,{value:function(){var n,r,i,s;if(n=e._captured,n||(e._captured=[]),r=t.apply(e,arguments),e._captured.length)for(i=o.length;i--;)s=o[i],s.updateSoftDependencies(e._captured);return e._captured=n,r},writable:!0});for(i in t)t.hasOwnProperty(i)&&(t["_"+e._guid][i]=t[i]);t["_"+e._guid+"_evaluators"]=[]}return o=t["_"+e._guid+"_evaluators"],s=o.indexOf(r),-1===s&&o.push(r),t["_"+e._guid]}var s,a;return a=/this/,s=function(e,n,i,s,a){var u;this.evaluator=i,this.keypath=n,this.root=e,this.argNum=s,this.type=t.REFERENCE,this.priority=a,u=e.get(n),"function"==typeof u&&(u=o(u,e,i)),this.value=i.values[s]=u,r(this)},s.prototype={update:function(){var t=this.root.get(this.keypath);"function"!=typeof t||t._nowrap||(t=o(t,this.root,this.evaluator)),e(t,this.value)||(this.evaluator.values[this.argNum]=t,this.evaluator.bubble(),this.value=t)},teardown:function(){i(this)}},s}(P,d,l,J,G),Ge=function(t,e,n){var r=function(t,n,r){this.root=t,this.keypath=n,this.priority=r.priority,this.evaluator=r,e(this)};return r.prototype={update:function(){var e=this.root.get(this.keypath);t(e,this.value)||(this.evaluator.bubble(),this.value=e)},teardown:function(){n(this)}},r}(d,J,G),Ke=function(t,e,n,r,i,o,s,a){function u(t,e){var n,r;if(t=t.replace(/\$\{([0-9]+)\}/g,"_$1"),h[t])return h[t];for(r=[];e--;)r[e]="_"+e;return n=new Function(r.join(","),"return("+t+")"),h[t]=n,n}var l,h={};return l=function(t,e,n,r,i,o){var a=this;a.root=t,a.uniqueString=n,a.keypath=e,a.priority=o,a.fn=u(r,i.length),a.values=[],a.refs=[],i.forEach(function(e,n){e&&(e.indexRef?a.values[n]=e.value:a.refs.push(new s(t,e.keypath,a,n,o)))}),a.selfUpdating=a.refs.length<=1},l.prototype={bubble:function(){this.selfUpdating?this.update():this.deferred||(t.addEvaluator(this),this.deferred=!0)},update:function(){var t;if(this.evaluating)return this;this.evaluating=!0;try{t=this.fn.apply(null,this.values)}catch(s){this.root.debug&&e('Error evaluating "'+this.uniqueString+'": '+s.message||s),t=void 0}return n(t,this.value)||(this.value=t,r(this.root,this.keypath),o(this.root,this.keypath,t,!0),i(this.root,this.keypath)),this.evaluating=!1,this
},teardown:function(){for(;this.refs.length;)this.refs.pop().teardown();r(this.root,this.keypath),this.root._evaluators[this.keypath]=null},refresh:function(){this.selfUpdating||(this.deferred=!0);for(var t=this.refs.length;t--;)this.refs[t].update();this.deferred&&(this.update(),this.deferred=!1)},updateSoftDependencies:function(t){var e,n,r;for(this.softRefs||(this.softRefs=[]),e=this.softRefs.length;e--;)r=this.softRefs[e],t[r.keypath]||(this.softRefs.splice(e,1),this.softRefs[r.keypath]=!1,r.teardown());for(e=t.length;e--;)n=t[e],this.softRefs[n]||(r=new a(this.root,n,this),this.softRefs.push(r),this.softRefs[n]=!0);this.selfUpdating=this.refs.length+this.softRefs.length<=1}},l}(L,Z,d,j,O,V,Je,Ge),$e=function(t,e,n,r,i){function o(t,e){return t.replace(/\$\{([0-9]+)\}/g,function(t,n){return e[n]?e[n].value||e[n].keypath:"undefined"})}function s(t){return"${"+t.replace(/[\.\[\]]/g,"-")+"}"}var a=function(r,i,o,s){var a,u,l,h=this;return a=r.root,this.root=a,this.callback=s,this.owner=r,this.str=o.s,this.args=l=[],this.unresolved=[],this.pending=0,u=i.indexRefs,o.r&&o.r.length?(o.r.forEach(function(r,o){var s,c,f;return u&&void 0!==(s=u[r])?void(l[o]={indexRef:r,value:s}):(c=e(a,r,i))?void(l[o]={keypath:c}):(l[o]=void 0,h.pending+=1,f=new n(a,r,i,function(e){h.resolve(o,e),t(h.unresolved,f)}),void h.unresolved.push(f))}),this.ready=!0,void this.bubble()):(this.resolved=this.ready=!0,void this.bubble())};return a.prototype={bubble:function(){this.ready&&(this.uniqueString=o(this.str,this.args),this.keypath=s(this.uniqueString),this.createEvaluator(),this.callback(this.keypath))},teardown:function(){for(var t;t=this.unresolved.pop();)t.teardown()},resolve:function(t,e){this.args[t]={keypath:e},this.bubble(),this.resolved=!--this.pending},createEvaluator:function(){var t;this.root._evaluators[this.keypath]?this.root._evaluators[this.keypath].refresh():(t=new r(this.root,this.keypath,this.uniqueString,this.str,this.args,this.owner.priority),this.root._evaluators[this.keypath]=t,t.update())},reassign:function(t,e,n,r){var o;this.args.forEach(function(s){var a;s.keypath&&(a=i(s.keypath,n,r))?(s.keypath=a,o=!0):s.indexRef===t&&(s.value=e,o=!0)}),o&&this.bubble()}},a}(b,T,Ve,Ke,je),Qe=function(t,e,n,r,i,o,s){var a=function(i,o,a){var l,h,c,f,p,d=this;return l=i.root,h=i.parentFragment,this.ref=o.r,this.root=i.root,this.mustache=i,this.callback=a,this.pending=0,this.unresolved=[],p=this.members=[],this.indexRefMembers=[],this.keypathObservers=[],this.expressionResolvers=[],o.m.forEach(function(o,a){var g,v,m,_,y,w;return"string"==typeof o?void(d.members[a]=o):o.t===t.REFERENCE?(g=o.n,v=h.indexRefs,v&&void 0!==(m=v[g])?(p[a]=m,void d.indexRefMembers.push({ref:g,index:a})):(f=!0,_=function(t){var e=new u(l,t,i.priority,d,a);d.keypathObservers.push(e)},(c=n(l,g,h))?void _(c):(p[a]=void 0,d.pending+=1,y=new r(l,g,h,function(t){d.resolve(a,t),e(d.unresolved,y)}),d.unresolved.push(y),null))):(f=!0,d.pending+=1,w=new s(d,h,o,function(t){d.resolve(a,t),e(d.unresolved,w)}),void d.unresolved.push(w))}),f?(this.ready=!0,void this.bubble()):(c=this.getKeypath(),void a(c))};a.prototype={getKeypath:function(){return this.ref+"."+this.members.join(".")},bubble:function(){this.ready&&!this.pending&&this.callback(this.getKeypath())},resolve:function(t,e){var n=new u(this.root,e,this.mustache.priority,this,t);n.update(),this.keypathObservers.push(n),this.resolved=!--this.pending,this.bubble()},teardown:function(){for(var t;t=this.unresolved.pop();)t.teardown()},reassign:function(t,e){var n,r,i;for(r=this.indexRefMembers.length;r--;)i=this.indexRefMembers[r],i.ref===t&&(n=!0,this.members[i.index]=e);n&&this.bubble()}};var u=function(t,e,n,r,o){this.root=t,this.keypath=e,this.priority=n,this.resolver=r,this.index=o,i(this),this.update()};return u.prototype={update:function(){var t=this.resolver;t.members[this.index]=this.root.get(this.keypath),t.bubble()},teardown:function(){o(this)}},a}(P,b,T,Ve,J,G,$e),Ye=function(t,e,n,r){return function(i,o){var s,a,u,l,h,c,f;h=o.parentFragment,c=o.descriptor,i.root=h.root,i.parentFragment=h,i.descriptor=o.descriptor,i.index=o.index||0,i.priority=h.priority,i.type=o.descriptor.t,f=function(t){i.resolve(t)},(s=c.r)&&(u=h.indexRefs,u&&void 0!==(l=u[s])?(i.indexRef=s,i.value=l,i.render(i.value)):(a=e(i.root,s,i.parentFragment),void 0!==a?f(a):(i.ref=s,t.addUnresolved(i)))),o.descriptor.x&&(i.resolver=new r(i,h,o.descriptor.x,f)),o.descriptor.kx&&(i.resolver=new n(i,o.descriptor.kx,f)),i.descriptor.n&&!i.hasOwnProperty("value")&&i.render(void 0)}}(L,T,Qe,$e),Ze=function(t,e){var n={evaluateWrapped:!0};return function(){var r=e(this.root,this.keypath,n);t(r,this.value)||(this.render(r),this.value=r)}}(d,Y),tn=function(t,e,n){return function(r){var i;if(r!==this.keypath){if(this.registered&&(n(this),this.type===t.SECTION))for(i=this.fragments.length;i--;)this.fragments[i].reassign(null,null,this.keypath,r);this.keypath=r,e(this),this.update()}}}(P,J,G),en=function(t){return function(e,n,r,i){var o,s;if(this.resolver?this.resolver.reassign(e,n,r,i):this.keypath?(o=t(this.keypath,r,i),o&&this.resolve(o)):void 0!==e&&this.indexRef===e&&(this.value=n,this.render(n)),this.fragments)for(s=this.fragments.length;s--;)this.fragments[s].reassign(e,n,r,i)}}(je),nn=function(t,e,n,r){return{init:t,update:e,resolve:n,reassign:r}}(Ye,Ze,tn,en),rn=function(t,e,n,r){var i,o,s;return o=/</g,s=/>/g,i=function(e,r){this.type=t.INTERPOLATOR,r&&(this.node=document.createTextNode(""),r.appendChild(this.node)),n.init(this,e)},i.prototype={update:n.update,resolve:n.resolve,reassign:n.reassign,detach:r,teardown:function(t){t&&this.detach(),e(this)},render:function(t){this.node&&(this.node.data=void 0==t?"":t)},firstNode:function(){return this.node},toString:function(){var t=void 0!=this.value?""+this.value:"";return t.replace(o,"&lt;").replace(s,"&gt;")}},i}(P,We,nn,Xe),on=function(){var t=[];return function(e){var n,r,i,o,s,a,u,l,h=this;for(n=this.parentFragment,s=[],e.forEach(function(e,n){var i,o,a,u;return e===n?void(s[e]=h.fragments[n]):(void 0===r&&(r=n),-1===e?void t.push(h.fragments[n]):(i=h.fragments[n],o=e-n,a=h.keypath+"."+n,u=h.keypath+"."+e,i.reassign(h.descriptor.i,n,e,o,a,u),void(s[e]=i)))});u=t.pop();)u.teardown(!0);if(void 0===r&&(r=this.length),this.length=o=this.root.get(this.keypath).length,o!==r){for(a={descriptor:this.descriptor.f,root:this.root,pNode:n.pNode,owner:this},this.descriptor.i&&(a.indexRef=this.descriptor.i),i=r;o>i;i+=1)(u=s[i])?this.docFrag.appendChild(u.detach(!1)):(a.context=this.keypath+"."+i,a.index=i,u=this.createFragment(a)),this.fragments[i]=u;l=n.findNextNode(this),n.pNode.insertBefore(this.docFrag,l)}}}(),sn=function(t,e){function n(t,e,n){var r,i,o;if(i=e.length,i<t.length)for(o=t.fragments.splice(i,t.length-i);o.length;)o.pop().teardown(!0);else if(i>t.length)for(r=t.length;i>r;r+=1)n.context=t.keypath+"."+r,n.index=r,t.descriptor.i&&(n.indexRef=t.descriptor.i),t.fragments[r]=t.createFragment(n);t.length=i}function r(t,e,n){var r,i,o,s;for(o=t.hasKey||(t.hasKey={}),i=t.fragments.length;i--;)s=t.fragments[i],s.index in e||(t.fragments[i].teardown(!0),t.fragments.splice(i,1),o[s.index]=!1);for(r in e)o[r]||(n.context=t.keypath+"."+r,n.index=r,t.descriptor.i&&(n.indexRef=t.descriptor.i),t.fragments.push(t.createFragment(n)),o[r]=!0);t.length=t.fragments.length}function i(t,e){t.length||(e.context=t.keypath,e.index=0,t.fragments[0]=t.createFragment(e),t.length=1)}function o(e,n,r,i){var o,s,a,u;if(s=t(n)&&0===n.length,o=r?s||!n:n&&!s){if(e.length||(i.index=0,e.fragments[0]=e.createFragment(i),e.length=1),e.length>1)for(a=e.fragments.splice(1);u=a.pop();)u.teardown(!0)}else e.length&&(e.teardownFragments(!0),e.length=0)}return function(s,a){var u={descriptor:s.descriptor.f,root:s.root,pNode:s.parentFragment.pNode,pElement:s.parentFragment.pElement,owner:s};return s.descriptor.n?void o(s,a,!0,u):void(t(a)?n(s,a,u):e(a)||"function"==typeof a?s.descriptor.i?r(s,a,u):i(s,u):o(s,a,!1,u))}}(C,te),an=function(t,e){return function(n){var r,i;(i=this.root._wrapped[this.keypath])&&(n=i.get()),this.rendering||(this.rendering=!0,e(this,n),this.rendering=!1,(!this.docFrag||this.docFrag.childNodes.length)&&!this.initialising&&t&&(r=this.parentFragment.findNextNode(this),r&&r.parentNode===this.parentFragment.pNode?this.parentFragment.pNode.insertBefore(this.docFrag,r):this.parentFragment.pNode.appendChild(this.docFrag)))}}(u,sn),un=function(t,e,n,r){var i,o,s,a,u;for(s=t.descriptor.i,i=e;n>i;i+=1)o=t.fragments[i],a=t.keypath+"."+(i-r),u=t.keypath+"."+i,o.index=i,o.reassign(s,i,a,u)},ln=function(t){function e(t){t.teardown(!0)}function n(t,e,n){var r,i,o;for(t.rendering=!0,r={descriptor:t.descriptor.f,root:t.root,pNode:t.parentFragment.pNode,owner:t,indexRef:t.descriptor.i},i=e;n>i;i+=1)r.context=t.keypath+"."+i,r.index=i,t.fragments[i]=t.createFragment(r);o=t.fragments[n]?t.fragments[n].firstNode():t.parentFragment.findNextNode(t),t.parentFragment.pNode.insertBefore(t.docFrag,o),t.rendering=!1}return function(r){var i,o,s,a,u,l=this;if(i=r.balance){if(o=r.start,l.length+=i,0>i)return l.fragments.splice(o,-i).forEach(e),void t(l,o,l.length,i);s=o+r.removed,a=o+r.added,u=[s,0],u.length+=i,l.fragments.splice.apply(l.fragments,u),t(l,a,l.length,i),n(l,s,a)}}}(un),hn=function(t,e,n,r,i,o,s){var a,u;return s.push(function(){u=s.DomFragment}),a=function(n,r){this.type=t.SECTION,this.inverted=!!n.descriptor.n,this.fragments=[],this.length=0,r&&(this.docFrag=document.createDocumentFragment()),this.initialising=!0,e.init(this,n),r&&r.appendChild(this.docFrag),this.initialising=!1},a.prototype={update:e.update,resolve:e.resolve,reassign:e.reassign,splice:i,merge:n,detach:function(){var t,e;if(this.docFrag){for(e=this.fragments.length,t=0;e>t;t+=1)this.docFrag.appendChild(this.fragments[t].detach());return this.docFrag}},teardown:function(t){this.teardownFragments(t),o(this)},firstNode:function(){return this.fragments[0]?this.fragments[0].firstNode():this.parentFragment.findNextNode(this)},findNextNode:function(t){return this.fragments[t.index+1]?this.fragments[t.index+1].firstNode():this.parentFragment.findNextNode(this)},teardownFragments:function(t){for(var e;e=this.fragments.shift();)e.teardown(t)},render:r,createFragment:function(t){var e=new u(t);return this.docFrag&&this.docFrag.appendChild(e.docFrag),e},toString:function(){var t,e,n;for(t="",e=0,n=this.length,e=0;n>e;e+=1)t+=this.fragments[e].toString();return t},find:function(t){var e,n,r;for(n=this.fragments.length,e=0;n>e;e+=1)if(r=this.fragments[e].find(t))return r;return null},findAll:function(t,e){var n,r;for(r=this.fragments.length,n=0;r>n;n+=1)this.fragments[n].findAll(t,e)},findComponent:function(t){var e,n,r;for(n=this.fragments.length,e=0;n>e;e+=1)if(r=this.fragments[e].findComponent(t))return r;return null},findAllComponents:function(t,e){var n,r;for(r=this.fragments.length,n=0;r>n;n+=1)this.fragments[n].findAllComponents(t,e)}},a}(P,nn,on,an,ln,We,w),cn=function(t,e,n,r,i){var o=function(e,r){this.type=t.TRIPLE,r&&(this.nodes=[],this.docFrag=document.createDocumentFragment()),this.initialising=!0,n.init(this,e),r&&r.appendChild(this.docFrag),this.initialising=!1};return o.prototype={update:n.update,resolve:n.resolve,reassign:n.reassign,detach:function(){var t,e;if(this.docFrag){for(t=this.nodes.length,e=0;t>e;e+=1)this.docFrag.appendChild(this.nodes[e]);return this.docFrag}},teardown:function(t){t&&(this.detach(),this.docFrag=this.nodes=null),i(this)},firstNode:function(){return this.nodes[0]?this.nodes[0]:this.parentFragment.findNextNode(this)},render:function(t){var e,n;if(this.nodes){for(;this.nodes.length;)e=this.nodes.pop(),e.parentNode.removeChild(e);if(!t)return void(this.nodes=[]);n=this.parentFragment.pNode,this.nodes=r(t,n.tagName,n.namespaceURI,this.docFrag),this.initialising||n.insertBefore(this.docFrag,this.parentFragment.findNextNode(this)),"SELECT"===n.tagName&&n._ractive&&n._ractive.binding&&n._ractive.binding.update()}},toString:function(){return void 0!=this.value?this.value:""},find:function(t){var n,r,i,o;for(r=this.nodes.length,n=0;r>n;n+=1)if(i=this.nodes[n],1===i.nodeType){if(e(i,t))return i;if(o=i.querySelector(t))return o}return null},findAll:function(t,n){var r,i,o,s,a,u;for(i=this.nodes.length,r=0;i>r;r+=1)if(o=this.nodes[r],1===o.nodeType&&(e(o,t)&&n.push(o),s=o.querySelectorAll(t)))for(a=s.length,u=0;a>u;u+=1)n.push(s[u])}},o}(P,ae,nn,qe,We),fn=function(t){return function(e,n){return e.a&&e.a.xmlns?e.a.xmlns:"svg"===e.e?t.svg:n.namespaceURI||t.html}}(s),pn=function(){var t,e,n,r;return t="altGlyph altGlyphDef altGlyphItem animateColor animateMotion animateTransform clipPath feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence foreignObject glyphRef linearGradient radialGradient textPath vkern".split(" "),e="attributeName attributeType baseFrequency baseProfile calcMode clipPathUnits contentScriptType contentStyleType diffuseConstant edgeMode externalResourcesRequired filterRes filterUnits glyphRef gradientTransform gradientUnits kernelMatrix kernelUnitLength keyPoints keySplines keyTimes lengthAdjust limitingConeAngle markerHeight markerUnits markerWidth maskContentUnits maskUnits numOctaves pathLength patternContentUnits patternTransform patternUnits pointsAtX pointsAtY pointsAtZ preserveAlpha preserveAspectRatio primitiveUnits refX refY repeatCount repeatDur requiredExtensions requiredFeatures specularConstant specularExponent spreadMethod startOffset stdDeviation stitchTiles surfaceScale systemLanguage tableValues targetX targetY textLength viewBox viewTarget xChannelSelector yChannelSelector zoomAndPan".split(" "),n=function(t){for(var e={},n=t.length;n--;)e[t[n].toLowerCase()]=t[n];return e},r=n(t.concat(e)),function(t){var e=t.toLowerCase();return r[e]||e}}(),dn=function(t,e){return function(n,r){var i,o;if(i=r.indexOf(":"),-1===i||(o=r.substr(0,i),"xmlns"===o))n.name=n.element.namespace!==t.html?e(r):r,n.lcName=n.name.toLowerCase();else if(r=r.substring(i+1),n.name=e(r),n.lcName=n.name.toLowerCase(),n.namespace=t[o.toLowerCase()],!n.namespace)throw'Unknown namespace ("'+o+'")'}}(s,pn),gn=function(t){return function(e,n){var r,i=null===n.value?"":n.value;(r=n.pNode)&&(e.namespace?r.setAttributeNS(e.namespace,n.name,i):"style"===n.name&&r.style.setAttribute?r.style.setAttribute("cssText",i):"class"!==n.name||r.namespaceURI&&r.namespaceURI!==t.html?r.setAttribute(n.name,i):r.className=i,"id"===e.name&&(n.root.nodes[n.value]=r),"value"===e.name&&(r._ractive.value=n.value)),e.value=n.value}}(s),vn=function(t){var e={"accept-charset":"acceptCharset",accesskey:"accessKey",bgcolor:"bgColor","class":"className",codebase:"codeBase",colspan:"colSpan",contenteditable:"contentEditable",datetime:"dateTime",dirname:"dirName","for":"htmlFor","http-equiv":"httpEquiv",ismap:"isMap",maxlength:"maxLength",novalidate:"noValidate",pubdate:"pubDate",readonly:"readOnly",rowspan:"rowSpan",tabindex:"tabIndex",usemap:"useMap"};return function(n,r){var i;!n.pNode||n.namespace||r.pNode.namespaceURI&&r.pNode.namespaceURI!==t.html||(i=e[n.name]||n.name,void 0!==r.pNode[i]&&(n.propertyName=i),("boolean"==typeof r.pNode[i]||"value"===i)&&(n.useProperty=!0))}}(s),mn=function(t){return function(e){var n,r;return n=e.fragment.items,1===n.length&&(r=n[0],r.type===t.INTERPOLATOR&&(r.keypath||r.ref))?r:void 0}}(P),_n=function(t){return function(e,n){var r;if(!t(e)||!t(n))return!1;if(e.length!==n.length)return!1;for(r=e.length;r--;)if(e[r]!==n[r])return!1;return!0}}(C),yn=function(t,e,n,r,i,o){var s,a,u,l,h,c,f,p,d,g,v,m,_,y,w='For two-way binding to work, attribute value must be a single interpolator (e.g. value="{{foo}}")',b="You cannot set up two-way binding against an expression ";return s=function(){var t,n,r,i=this.pNode;return(t=this.interpolator)?t.keypath&&"${"===t.keypath.substr?(e(b+t.keypath),!1):(t.keypath||t.resolve(t.descriptor.r),this.keypath=t.keypath,(n=h(this))?(i._ractive.binding=this.element.binding=n,this.twoway=!0,r=this.root._twowayBindings[this.keypath]||(this.root._twowayBindings[this.keypath]=[]),r.push(n),!0):!1):(e(w),!1)},a=function(){t.start(this._ractive.root),this._ractive.binding.update(),t.end()},u={evaluateWrapped:!0},l=function(){var t=i(this._ractive.root,this._ractive.binding.keypath,u);this.value=void 0==t?"":t},h=function(t){var e=t.pNode;if("SELECT"===e.tagName)return e.multiple?new f(t,e):new p(t,e);if("checkbox"===e.type||"radio"===e.type){if("name"===t.propertyName){if("checkbox"===e.type)return new g(t,e);if("radio"===e.type)return new d(t,e)}return"checked"===t.propertyName?new v(t,e):null}if("value"!==t.lcName)throw new Error("Attempted to set up an illegal two-way binding. This error is unexpected - if you can, please file an issue at https://github.com/RactiveJS/Ractive, or contact @RactiveJS on Twitter. Thanks!");return"file"===e.type?new m(t,e):e.getAttribute("contenteditable")?new _(t,e):new y(t,e)},f=function(t,e){var n;c(this,t,e),e.addEventListener("change",a,!1),n=i(this.root,this.keypath),void 0===n&&this.update()},f.prototype={value:function(){var t,e,n,r,i,o;for(t=[],e=this.node.options,r=e.length,n=0;r>n;n+=1)i=e[n],i.selected&&(o=i._ractive?i._ractive.value:i.value,t.push(o));return t},update:function(){var e,r,i;return e=this.attr,r=e.value,i=this.value(),void 0!==r&&n(i,r)||(t.addBinding(e),e.value=i,o(this.root,this.keypath,i),t.trigger()),this},deferUpdate:function(){this.deferred!==!0&&(t.addAttribute(this),this.deferred=!0)},teardown:function(){this.node.removeEventListener("change",a,!1)}},p=function(t,e){var n;c(this,t,e),e.addEventListener("change",a,!1),n=i(this.root,this.keypath),void 0===n&&this.update()},p.prototype={value:function(){var t,e,n,r,i;for(t=this.node.options,n=t.length,e=0;n>e;e+=1)if(r=t[e],t[e].selected)return i=r._ractive?r._ractive.value:r.value},update:function(){var e=this.value();return t.addBinding(this.attr),this.attr.value=e,o(this.root,this.keypath,e),t.trigger(),this},deferUpdate:function(){this.deferred!==!0&&(t.addAttribute(this),this.deferred=!0)},teardown:function(){this.node.removeEventListener("change",a,!1)}},d=function(e,n){var r;this.radioName=!0,c(this,e,n),n.name="{{"+e.keypath+"}}",n.addEventListener("change",a,!1),n.attachEvent&&n.addEventListener("click",a,!1),r=i(this.root,this.keypath),void 0!==r?n.checked=r==n._ractive.value:t.addRadio(this)},d.prototype={value:function(){return this.node._ractive?this.node._ractive.value:this.node.value},update:function(){var e=this.node;e.checked&&(t.addBinding(this.attr),o(this.root,this.keypath,this.value()),t.trigger())},teardown:function(){this.node.removeEventListener("change",a,!1),this.node.removeEventListener("click",a,!1)}},g=function(e,n){var r,o;this.checkboxName=!0,c(this,e,n),n.name="{{"+this.keypath+"}}",n.addEventListener("change",a,!1),n.attachEvent&&n.addEventListener("click",a,!1),r=i(this.root,this.keypath),void 0!==r?(o=-1!==r.indexOf(n._ractive.value),n.checked=o):t.addCheckbox(this)},g.prototype={changed:function(){return this.node.checked!==!!this.checked},update:function(){this.checked=this.node.checked,t.addBinding(this.attr),o(this.root,this.keypath,r(this.root,this.keypath)),t.trigger()},teardown:function(){this.node.removeEventListener("change",a,!1),this.node.removeEventListener("click",a,!1)}},v=function(t,e){c(this,t,e),e.addEventListener("change",a,!1),e.attachEvent&&e.addEventListener("click",a,!1)},v.prototype={value:function(){return this.node.checked},update:function(){t.addBinding(this.attr),o(this.root,this.keypath,this.value()),t.trigger()},teardown:function(){this.node.removeEventListener("change",a,!1),this.node.removeEventListener("click",a,!1)}},m=function(t,e){c(this,t,e),e.addEventListener("change",a,!1)},m.prototype={value:function(){return this.attr.pNode.files},update:function(){o(this.attr.root,this.attr.keypath,this.value()),t.trigger()},teardown:function(){this.node.removeEventListener("change",a,!1)}},_=function(t,e){c(this,t,e),e.addEventListener("change",a,!1),this.root.lazy||(e.addEventListener("input",a,!1),e.attachEvent&&e.addEventListener("keyup",a,!1))},_.prototype={update:function(){t.addBinding(this.attr),o(this.root,this.keypath,this.node.innerHTML),t.trigger()},teardown:function(){this.node.removeEventListener("change",a,!1),this.node.removeEventListener("input",a,!1),this.node.removeEventListener("keyup",a,!1)}},y=function(t,e){c(this,t,e),e.addEventListener("change",a,!1),this.root.lazy||(e.addEventListener("input",a,!1),e.attachEvent&&e.addEventListener("keyup",a,!1)),this.node.addEventListener("blur",l,!1)},y.prototype={value:function(){var t=this.attr.pNode.value;return+t+""===t&&-1===t.indexOf("e")&&(t=+t),t},update:function(){var e=this.attr,n=this.value();t.addBinding(e),o(e.root,e.keypath,n),t.trigger()},teardown:function(){this.node.removeEventListener("change",a,!1),this.node.removeEventListener("input",a,!1),this.node.removeEventListener("keyup",a,!1),this.node.removeEventListener("blur",l,!1)}},c=function(t,e,n){t.attr=e,t.node=n,t.root=e.root,t.keypath=e.keypath},s}(L,Z,_n,x,Y,B),wn=function(t,e,n){var r,i,o,s,a,u,l,h,c,f,p,d;return r=function(){var t;if(!this.ready)return this;if(t=this.pNode,"SELECT"===t.tagName&&"value"===this.lcName)return this.update=o,this.deferredUpdate=s,this.update();if(this.isFileInputValue)return this.update=i,this;if(this.twoway&&"name"===this.lcName){if("radio"===t.type)return this.update=l,this.update();if("checkbox"===t.type)return this.update=h,this.update()}return"style"===this.lcName&&t.style.setAttribute?(this.update=c,this.update()):"class"!==this.lcName||t.namespaceURI&&t.namespaceURI!==e.html?t.getAttribute("contenteditable")&&"value"===this.lcName?(this.update=p,this.update()):(this.update=d,this.update()):(this.update=f,this.update())},i=function(){return this},s=function(){this.deferredUpdate=this.pNode.multiple?u:a,this.deferredUpdate()},o=function(){return t.addSelectValue(this),this},a=function(){var t,e,n,r,i=this.fragment.getValue();for(this.value=this.pNode._ractive.value=i,t=this.pNode.options,r=t.length;r--;)if(e=t[r],n=e._ractive?e._ractive.value:e.value,n==i)return e.selected=!0,this;return this},u=function(){var t,e,r,i,o=this.fragment.getValue();for(n(o)||(o=[o]),t=this.pNode.options,e=t.length;e--;)r=t[e],i=r._ractive?r._ractive.value:r.value,r.selected=-1!==o.indexOf(i);return this.value=o,this},l=function(){var t,e;return t=this.pNode,e=this.fragment.getValue(),t.checked=e==t._ractive.value,this},h=function(){var t,e;return t=this.pNode,e=this.fragment.getValue(),n(e)?(t.checked=-1!==e.indexOf(t._ractive.value),this):(t.checked=e==t._ractive.value,this)},c=function(){var t,e;return t=this.pNode,e=this.fragment.getValue(),void 0===e&&(e=""),e!==this.value&&(t.style.setAttribute("cssText",e),this.value=e),this},f=function(){var t,e;return t=this.pNode,e=this.fragment.getValue(),void 0===e&&(e=""),e!==this.value&&(t.className=e,this.value=e),this},p=function(){var t,e;return t=this.pNode,e=this.fragment.getValue(),void 0===e&&(e=""),e!==this.value&&(this.active||(t.innerHTML=e),this.value=e),this},d=function(){var t,e,n;if(t=this.pNode,e=this.fragment.getValue(),this.isValueAttribute&&(t._ractive.value=e),void 0==e&&(e=""),e!==this.value){if(this.useProperty)return this.active||(t[this.propertyName]=e),"OPTION"===t.tagName&&t.selected&&(n=this.element.select.binding)&&n.update(),this.value=e,this;if(this.namespace)return t.setAttributeNS(this.namespace,this.name,e),this.value=e,this;"id"===this.lcName&&(void 0!==this.value&&(this.root.nodes[this.value]=void 0),this.root.nodes[e]=t),t.setAttribute(this.name,e),this.value=e}return this},r}(L,s,C),bn=function(t){var e;return e=this.str.substr(this.pos,t.length),e===t?(this.pos+=t.length,t):null},En=function(){var t=/^\s+/;return function(){var e=t.exec(this.remaining());return e?(this.pos+=e[0].length,e[0]):null}}(),xn=function(t){return function(e){var n=t.exec(e.str.substring(e.pos));return n?(e.pos+=n[0].length,n[1]||n[0]):null}},Sn=function(t){var e,n,r;return e=t(/^(?=.)[^"'\\]+?(?:(?!.)|(?=["'\\]))/),n=t(/^\\(?:['"\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/),r=t(/^\\(?:\r\n|[\u000A\u000D\u2028\u2029])/),function(t){return function(i){var o,s,a,u;for(o=i.pos,s='"',a=!1;!a;)u=e(i)||n(i)||i.getStringMatch(t),u?s+='"'===u?'\\"':"\\'"===u?"'":u:(u=r(i),u?s+="\\u"+("000"+u.charCodeAt(1).toString(16)).slice(-4):a=!0);return s+='"',JSON.parse(s)}}}(xn),An=function(t){return t('"')}(Sn),Tn=function(t){return t("'")}(Sn),kn=function(t,e,n){return function(r){var i,o;return i=r.pos,r.getStringMatch('"')?(o=n(r),r.getStringMatch('"')?{t:t.STRING_LITERAL,v:o}:(r.pos=i,null)):r.getStringMatch("'")?(o=e(r),r.getStringMatch("'")?{t:t.STRING_LITERAL,v:o}:(r.pos=i,null)):null}}(P,An,Tn),On=function(t,e){var n=e(/^(?:[+-]?)(?:(?:(?:0|[1-9]\d*)?\.\d+)|(?:(?:0|[1-9]\d*)\.)|(?:0|[1-9]\d*))(?:[eE][+-]?\d+)?/);return function(e){var r;return(r=n(e))?{t:t.NUMBER_LITERAL,v:r}:null}}(P,xn),Nn=function(t){return t(/^[a-zA-Z_$][a-zA-Z_$0-9]*/)}(xn),Ln=function(t,e,n){var r=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;return function(i){var o;return(o=t(i))?r.test(o.v)?o.v:'"'+o.v.replace(/"/g,'\\"')+'"':(o=e(i))?o.v:(o=n(i))?o:void 0}}(kn,On,Nn),Rn=function(t,e,n,r){function i(t){var e,n,i;return t.allowWhitespace(),(e=r(t))?(i={key:e},t.allowWhitespace(),t.getStringMatch(":")?(t.allowWhitespace(),(n=t.getToken())?(i.value=n.v,i):null):null):null}var o,s,a,u,l,h;return s={"true":!0,"false":!1,undefined:void 0,"null":null},a=new RegExp("^(?:"+Object.keys(s).join("|")+")"),u=/^(?:[+-]?)(?:(?:(?:0|[1-9]\d*)?\.\d+)|(?:(?:0|[1-9]\d*)\.)|(?:0|[1-9]\d*))(?:[eE][+-]?\d+)?/,l=/\$\{([^\}]+)\}/g,h=/^\$\{([^\}]+)\}/,o=function(t,e){this.str=t,this.values=e,this.pos=0,this.result=this.getToken()},o.prototype={remaining:function(){return this.str.substring(this.pos)},getStringMatch:t,getToken:function(){return this.allowWhitespace(),this.getPlaceholder()||this.getSpecial()||this.getNumber()||this.getString()||this.getObject()||this.getArray()},getPlaceholder:function(){var t;return this.values?(t=h.exec(this.remaining()))&&this.values.hasOwnProperty(t[1])?(this.pos+=t[0].length,{v:this.values[t[1]]}):void 0:null},getSpecial:function(){var t;return(t=a.exec(this.remaining()))?(this.pos+=t[0].length,{v:s[t[0]]}):void 0},getNumber:function(){var t;return(t=u.exec(this.remaining()))?(this.pos+=t[0].length,{v:+t[0]}):void 0},getString:function(){var t,e=n(this);return e&&(t=this.values)?{v:e.v.replace(l,function(e,n){return t[n]||n})}:e},getObject:function(){var t,e;if(!this.getStringMatch("{"))return null;for(t={};e=i(this);){if(t[e.key]=e.value,this.allowWhitespace(),this.getStringMatch("}"))return{v:t};if(!this.getStringMatch(","))return null}return null},getArray:function(){var t,e;if(!this.getStringMatch("["))return null;for(t=[];e=this.getToken();){if(t.push(e.v),this.getStringMatch("]"))return{v:t};if(!this.getStringMatch(","))return null}return null},allowWhitespace:e},function(t,e){var n=new o(t,e);return n.result?{value:n.result.v,remaining:n.remaining()}:null}}(bn,En,kn,Ln),Cn=function(t,e,n){function r(t){return"string"==typeof t?t:JSON.stringify(t)}var i=function(e){this.type=t.INTERPOLATOR,n.init(this,e)};return i.prototype={update:n.update,resolve:n.resolve,reassign:n.reassign,render:function(t){this.value=t,this.parentFragment.bubble()},teardown:function(){e(this)},toString:function(){return void 0==this.value?"":r(this.value)}},i}(P,We,nn),Dn=function(t,e,n,r,i){var o,s;return i.push(function(){s=i.StringFragment}),o=function(n){this.type=t.SECTION,this.fragments=[],this.length=0,e.init(this,n)},o.prototype={update:e.update,resolve:e.resolve,reassign:e.reassign,teardown:function(){this.teardownFragments(),r(this)},teardownFragments:function(){for(;this.fragments.length;)this.fragments.shift().teardown();this.length=0},bubble:function(){this.value=this.fragments.join(""),this.parentFragment.bubble()},render:function(t){var e;(e=this.root._wrapped[this.keypath])&&(t=e.get()),n(this,t),this.parentFragment.bubble()},createFragment:function(t){return new s(t)},toString:function(){return this.fragments.join("")}},o}(P,nn,sn,We,w),In=function(t){var e=function(e){this.type=t.TEXT,this.text=e};return e.prototype={toString:function(){return this.text},reassign:function(){},teardown:function(){}},e}(P),Un=function(t,e){return function(){var n,r,i,o,s,a,u;if(!this.argsList||this.dirty){if(n={},r=0,o=this.root._guid,u=function(t){return t.map(function(t){var e,i,s;return t.text?t.text:t.fragments?t.fragments.map(function(t){return u(t.items)}).join(""):(e=o+"-"+r++,s=(i=t.root._wrapped[t.keypath])?i.value:t.value,n[e]=s,"${"+e+"}")}).join("")},i=u(this.items),a=e("["+i+"]",n))this.argsList=a.value;else{if(s="Could not parse directive arguments ("+this.toString()+"). If you think this is a bug, please file an issue at http://github.com/RactiveJS/Ractive/issues",this.root.debug)throw new Error(s);t(s),this.argsList=[i]}this.dirty=!1}return this.argsList}}(Z,Rn),Mn=function(t,e,n,r,i,o,s,a){var u=function(t){n.init(this,t)};return u.prototype={reassign:n.reassign,createItem:function(e){if("string"==typeof e.descriptor)return new o(e.descriptor);switch(e.descriptor.t){case t.INTERPOLATOR:return new r(e);case t.TRIPLE:return new r(e);case t.SECTION:return new i(e);default:throw"Something went wrong in a rather interesting way"}},bubble:function(){this.dirty=!0,this.owner.bubble()},teardown:function(){var t,e;for(t=this.items.length,e=0;t>e;e+=1)this.items[e].teardown()},getValue:function(){var e;return 1===this.items.length&&this.items[0].type===t.INTERPOLATOR&&(e=this.items[0].value,void 0!==e)?e:this.toString()},isSimple:function(){var e,n,r;if(void 0!==this.simple)return this.simple;for(e=this.items.length;e--;)if(n=this.items[e],n.type!==t.TEXT){if(n.type!==t.INTERPOLATOR)return this.simple=!1;if(r)return!1;r=!0}return this.simple=!0},toString:function(){return this.items.join("")},toJSON:function(){var t,n=this.getValue();return"string"==typeof n&&(t=e(n),n=t?t.value:n),n},toArgsList:s},a.StringFragment=u,u}(P,Rn,ze,Cn,Dn,In,Un,w),Pn=function(t,e,n,r,i,o,s,a,u){var l=function(t){return this.type=e.ATTRIBUTE,this.element=t.element,n(this,t.name),null===t.value||"string"==typeof t.value?void r(this,t):(this.root=t.root,this.pNode=t.pNode,this.parentFragment=this.element.parentFragment,this.fragment=new u({descriptor:t.value,root:this.root,owner:this}),this.interpolator=o(this),void(this.pNode&&("value"===this.name&&(this.isValueAttribute=!0,"INPUT"===this.pNode.tagName&&"file"===this.pNode.type&&(this.isFileInputValue=!0)),i(this,t),this.selfUpdating=this.fragment.isSimple(),this.ready=!0)))};return l.prototype={bind:s,update:a,updateBindings:function(){this.keypath=this.interpolator.keypath||this.interpolator.ref,"name"===this.propertyName&&(this.pNode.name="{{"+this.keypath+"}}")},reassign:function(t,e,n,r){this.fragment&&(this.fragment.reassign(t,e,n,r),this.twoway&&this.updateBindings())},teardown:function(){var t;if(this.boundEvents)for(t=this.boundEvents.length;t--;)this.pNode.removeEventListener(this.boundEvents[t],this.updateModel,!1);this.fragment&&this.fragment.teardown()},bubble:function(){this.selfUpdating?this.update():!this.deferred&&this.ready&&(t.addAttribute(this),this.deferred=!0)},toString:function(){var t,e;if(null===this.value)return this.name;if("value"!==this.name||"select"!==this.element.lcName)return"name"===this.name&&"input"===this.element.lcName&&(e=this.interpolator)?"name={{"+(e.keypath||e.ref)+"}}":this.fragment?(t=this.fragment.toString(),this.name+"="+JSON.stringify(t)):this.name+"="+JSON.stringify(this.value)}},l}(L,P,dn,gn,vn,mn,yn,wn,Mn),jn=function(t){return function(e,n,r){var i=new t({element:e,name:n,value:r,root:e.root,pNode:e.node});e.attributes.push(e.attributes[n]=i),"name"!==n&&i.update()}}(Pn),Fn=function(t){return function(e,n){var r;e.attributes=[];
for(r in n)n.hasOwnProperty(r)&&t(e,r,n[r]);return e.attributes}}(jn),Bn=function(t){for(var e=[],n=t.length;n--;)e[n]=t[n];return e},zn=function(t){return function(e,n){return e.matchingStaticNodes[n]||(e.matchingStaticNodes[n]=t(e.node.querySelectorAll(n))),e.matchingStaticNodes[n]}}(Bn),qn=function(t,e,n,r,i){function o(t){var e,n,i,o,s,a,u;i=t.node,e=t.root;do for(n=e._liveQueries,u=n.length;u--;)o=n[u],s=n[o],a=r(t,o),s.push.apply(s,a);while(e=e._parent)}var s,a,u;return i.push(function(){s=i.DomFragment}),a=function(){var t=this.node,e=this.fragment.toString();t.styleSheet?t.styleSheet.cssText=e:t.innerHTML=e},u=function(){this.node.type&&"text/javascript"!==this.node.type||t("Script tag was updated. This does not cause the code to be re-evaluated!"),this.node.text=this.fragment.toString()},function(t,r,i,l){return"script"===t.lcName||"style"===t.lcName?(t.fragment=new n({descriptor:i.f,root:t.root,owner:t}),void(l&&("script"===t.lcName?(t.bubble=u,t.node.text=t.fragment.toString()):(t.bubble=a,t.bubble())))):void("string"!=typeof i.f||r&&r.namespaceURI&&r.namespaceURI!==e.html?(t.fragment=new s({descriptor:i.f,root:t.root,pNode:r,owner:t,pElement:t}),l&&r.appendChild(t.fragment.docFrag)):(t.html=i.f,l&&(r.innerHTML=t.html,t.matchingStaticNodes={},o(t))))}}(Z,s,Mn,zn,w),Xn=function(t,e){var n=function(n,r,i){var o,s,a,u=this;if(u.root=r,u.node=i.node,o=n.n||n,"string"!=typeof o&&(s=new e({descriptor:o,root:r,owner:i}),o=s.toString(),s.teardown()),n.a?u.params=n.a:n.d&&(u.fragment=new e({descriptor:n.d,root:r,owner:i}),u.params=u.fragment.toArgsList(),u.fragment.bubble=function(){this.dirty=!0,u.params=this.toArgsList(),u.ready&&u.update()}),u.fn=r.decorators[o],!u.fn){if(a='Missing "'+o+'" decorator. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#decorators',r.debug)throw new Error(a);t(a)}};return n.prototype={init:function(){var t,e;if(this.params?(e=[this.node].concat(this.params),t=this.fn.apply(this.root,e)):t=this.fn.call(this.root,this.node),!t||!t.teardown)throw new Error("Decorator definition must return an object with a teardown method");this.actual=t,this.ready=!0},update:function(){this.actual.update?this.actual.update.apply(this.root,this.params):(this.actual.teardown(!0),this.init())},teardown:function(t){this.actual.teardown(),!t&&this.fragment&&this.fragment.teardown()}},n}(Z,Mn),Hn=function(t,e){return function(n,r,i){var o=new e(n,r,i);o.fn&&(i.decorator=o,t.addDecorator(i.decorator))}}(L,Xn),Wn=function(t,e){var n,r,i,o,s,a,u,l,h;return n=function(t,e,n,i){var o,s;o=t.node._ractive.events,s=o[e]||(o[e]=new r(t,e,i)),s.add(n)},r=function(e,n){var r;this.element=e,this.root=e.root,this.node=e.node,this.name=n,this.proxies=[],(r=this.root.events[n])?this.custom=r(this.node,h(n)):("on"+n in this.node||t('Missing "'+this.name+'" event. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#events'),this.node.addEventListener(n,l,!1))},r.prototype={add:function(t){this.proxies.push(new i(this.element,this.root,t))},teardown:function(){var t;for(this.custom?this.custom.teardown():this.node.removeEventListener(this.name,l,!1),t=this.proxies.length;t--;)this.proxies[t].teardown()},fire:function(t){for(var e=this.proxies.length;e--;)this.proxies[e].fire(t)}},i=function(t,n,r){var i;return this.root=n,i=r.n||r,this.n="string"==typeof i?i:new e({descriptor:r.n,root:this.root,owner:t}),r.a?(this.a=r.a,void(this.fire=s)):r.d?(this.d=new e({descriptor:r.d,root:this.root,owner:t}),void(this.fire=a)):void(this.fire=o)},i.prototype={teardown:function(){this.n.teardown&&this.n.teardown(),this.d&&this.d.teardown()},bubble:function(){}},o=function(t){this.root.fire(this.n.toString(),t)},s=function(t){this.root.fire.apply(this.root,[this.n.toString(),t].concat(this.a))},a=function(t){var e=this.d.toArgsList();"string"==typeof e&&(e=e.substr(1,e.length-2)),this.root.fire.apply(this.root,[this.n.toString(),t].concat(e))},l=function(t){var e=this._ractive;e.events[t.type].fire({node:this,original:t,index:e.index,keypath:e.keypath,context:e.root.get(e.keypath)})},u={},h=function(t){return u[t]?u[t]:u[t]=function(e){var n=e.node._ractive;e.index=n.index,e.keypath=n.keypath,e.context=n.root.get(n.keypath),n.events[t].fire(e)}},n}(Z,Mn),Vn=function(t){return function(e,n){var r,i,o;for(i in n)if(n.hasOwnProperty(i))for(o=i.split("-"),r=o.length;r--;)t(e,o[r],n[i])}}(Wn),Jn=function(t){var e,n,r,i,o;e=t.root;do for(n=e._liveQueries,r=n.length;r--;)i=n[r],o=n[i],o._test(t)&&(t.liveQueries||(t.liveQueries=[])).push(o);while(e=e._parent)},Gn=function(){if(this._inited)throw new Error("Cannot initialize a transition more than once");this._inited=!0,this._fn.apply(this.root,[this].concat(this.params))},Kn=function(t,e,n){var r,i;if(t)return r={},i=n("div").style,function(t){var n,o,s;if(!r[t])if(void 0!==i[t])r[t]=t;else for(s=t.charAt(0).toUpperCase()+t.substring(1),n=e.length;n--;)if(o=e[n],void 0!==i[o+s]){r[t]=o+s;break}return r[t]}}(u,m,a),$n=function(t,e,n,r){var i;if(e)return i=window.getComputedStyle||t.getComputedStyle,function(t){var e,i,o,s,a;if(e=window.getComputedStyle(this.node),"string"==typeof t)return a=e[r(t)],"0px"===a&&(a=0),a;if(!n(t))throw new Error("Transition#getStyle must be passed a string, or an array of strings representing CSS properties");for(i={},o=t.length;o--;)s=t[o],a=e[r(s)],"0px"===a&&(a=0),i[s]=a;return i}}(r,u,C,Kn),Qn=function(t){return function(e,n){var r;if("string"==typeof e)this.node.style[t(e)]=n;else for(r in e)e.hasOwnProperty(r)&&(this.node.style[t(r)]=e[r]);return this}}(Kn),Yn=function(t){return t.replace(/-([a-zA-Z])/g,function(t,e){return e.toUpperCase()})},Zn=function(t,e,n){function r(t){return t}var i=function(i){var o;this.duration=i.duration,this.step=i.step,this.complete=i.complete,"string"==typeof i.easing?(o=i.root.easing[i.easing],o||(t('Missing easing function ("'+i.easing+'"). You may need to download a plugin from [TODO]'),o=r)):o="function"==typeof i.easing?i.easing:r,this.easing=o,this.start=e(),this.end=this.start+this.duration,this.running=!0,n.add(this)};return i.prototype={tick:function(t){var e,n;return this.running?t>this.end?(this.step&&this.step(1),this.complete&&this.complete(1),!1):(e=t-this.start,n=this.easing(e/this.duration),this.step&&this.step(n),!0):!1},stop:function(){this.abort&&this.abort(),this.running=!1}},i}(Z,y,R),tr=function(t){var e=new RegExp("^-(?:"+t.join("|")+")-");return function(t){return t.replace(e,"")}}(m),er=function(t){var e=new RegExp("^(?:"+t.join("|")+")([A-Z])");return function(t){var n;return t?(e.test(t)&&(t="-"+t),n=t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})):""}}(m),nr=function(t,e,n,r,i,o,s,a,u){var l,h,c,f,p,d,g,v={},m={};if(t)return l=n("div").style,function(){void 0!==l.transition?(h="transition",c="transitionend",f=!0):void 0!==l.webkitTransition?(h="webkitTransition",c="webkitTransitionEnd",f=!0):f=!1}(),h&&(p=h+"Duration",d=h+"Property",g=h+"TimingFunction"),function(t,n,l,h,f,_){setTimeout(function(){var y,w,b,E;E=function(){w&&b&&_()},y=t.node.namespaceURI+t.node.tagName,t.node.style[d]=h.map(s).map(u).join(","),t.node.style[g]=u(l.easing||"linear"),t.node.style[p]=l.duration/1e3+"s",f=function(e){var n;n=h.indexOf(r(a(e.propertyName))),-1!==n&&h.splice(n,1),h.length||(t.root.fire(t.name+":end"),t.node.removeEventListener(c,f,!1),b=!0,E())},t.node.addEventListener(c,f,!1),setTimeout(function(){for(var a,u,p,d,g=h.length,_=[];g--;)d=h[g],a=y+d,v[a]?t.node.style[s(d)]=n[d]:u=t.getStyle(d),void 0===v[a]&&(t.node.style[s(d)]=n[d],v[a]=t.getStyle(d)!=n[d],m[a]=!v[a]),m[a]&&(p=h.indexOf(d),-1===p?e("Something very strange happened with transitions. If you see this message, please let @RactiveJS know. Thanks!"):h.splice(p,1),t.node.style[s(d)]=u,_.push({name:s(d),interpolator:i(u,n[d])}));_.length?new o({root:t.root,duration:l.duration,easing:r(l.easing),step:function(e){var n,r;for(r=_.length;r--;)n=_[r],t.node.style[n.name]=n.interpolator(e)},complete:function(){w=!0,E()}}):w=!0,h.length||(t.node.removeEventListener(c,f,!1),b=!0,E())},0)},l.delay||0)}}(u,Z,a,Yn,ne,Zn,Kn,tr,er),rr=function(t,e,n,r,i,o){var s;if(e)return s=window.getComputedStyle||t.getComputedStyle,function(t,e,s,a){var u,l=this;"string"==typeof t?(u={},u[t]=e):(u=t,a=s,s=e),s||(n('The "'+l.name+'" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340'),s=l,a=l.complete);var h=new r(function(t){var e,n,r,a,h,c,f,p;if(!s.duration)return l.setStyle(u),void t();for(e=Object.keys(u),n=[],r=window.getComputedStyle(l.node),h={},f=e.length;f--;)p=e[f],a=r[i(p)],"0px"===a&&(a=0),a!=u[p]&&(n.push(p),l.node.style[i(p)]=a);return n.length?void o(l,u,s,n,c,t):void t()});return a&&(n("t.animateStyle returns a Promise as of 0.4.0. Transition authors should do t.animateStyle(...).then(callback)"),h.then(a)),h}}(r,u,Z,g,Kn,nr),ir=function(t,e){var n;for(n in e)!e.hasOwnProperty(n)||n in t||(t[n]=e[n]);return t},or=function(t){return function(e,n){return"number"==typeof e?e={duration:e}:"string"==typeof e?e="slow"===e?{duration:600}:"fast"===e?{duration:200}:{duration:400}:e||(e={}),t(e,n)}}(ir),sr=function(){this.originalStyle?this.node.setAttribute("style",this.originalStyle):(this.node.getAttribute("style"),this.node.removeAttribute("style"))},ar=function(t,e,n,r,i,o,s,a){var u;return u=function(n,r,i,o){var s,a,u,l=this;if(this.root=r,this.node=i.node,this.isIntro=o,this.originalStyle=this.node.getAttribute("style"),l.complete=function(t){!t&&l.isIntro&&l.resetStyle(),l.node._ractive.transition=null,l._manager.remove(l)},s=n.n||n,"string"!=typeof s&&(a=new e({descriptor:s,root:this.root,owner:i}),s=a.toString(),a.teardown()),this.name=s,n.a?this.params=n.a:n.d&&(a=new e({descriptor:n.d,root:this.root,owner:i}),this.params=a.toArgsList(),a.teardown()),this._fn=r.transitions[s],!this._fn){if(u='Missing "'+s+'" transition. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#transitions',r.debug)throw new Error(u);return void t(u)}},u.prototype={init:n,getStyle:r,setStyle:i,animateStyle:o,processParams:s,resetStyle:a},u}(Z,Mn,Gn,$n,Qn,rr,or,sr),ur=function(t,e){return function(n,r,i,o){var s,a,u;!r.transitionsEnabled||r._parent&&!r._parent.transitionsEnabled||(s=new e(n,r,i,o),s._fn&&(a=s.node,(u=a._ractive.transition)&&u.complete(),a._ractive.transition=s,t.addTransition(s)))}}(L,ar),lr=function(t,e,n,r,i,o,s,a,u,l,h,c,f,p,d,g,v){function m(t){do if("select"===t.lcName)return t;while(t=t.parent)}return function(_,y,w){var b,E,x,S,A,T,k,O,N,L,R,C;if(_.type=e.ELEMENT,b=_.parentFragment=y.parentFragment,E=b.pNode,x=_.descriptor=y.descriptor,_.parent=y.pElement,_.root=L=b.root,_.index=y.index,_.lcName=x.e.toLowerCase(),_.eventListeners=[],_.customEventListeners=[],_.cssDetachQueue=[],E&&(S=_.namespace=u(x,E),A=S!==n.html?v(x.e):x.e,_.node=s(A,S),L.css&&E===L.el&&_.node.setAttribute("data-rvcguid",L.constructor._guid||L._guid),i(_.node,"_ractive",{value:{proxy:_,keypath:a(b),index:b.indexRefs,events:r(null),root:L}})),T=h(_,x.a),x.f){if(_.node&&_.node.getAttribute("contenteditable")&&_.node.innerHTML){if(C="A pre-populated contenteditable element should not have children",L.debug)throw new Error(C);o(C)}c(_,_.node,x,w)}w&&x.v&&p(_,x.v),w&&(L.twoway&&(_.bind(),_.node.getAttribute("contenteditable")&&_.node._ractive.binding&&_.node._ractive.binding.update()),T.name&&!T.name.twoway&&T.name.update(),"IMG"===_.node.tagName&&((k=_.attributes.width)||(O=_.attributes.height))&&_.node.addEventListener("load",N=function(){k&&(_.node.width=k.value),O&&(_.node.height=O.value),_.node.removeEventListener("load",N,!1)},!1),w.appendChild(_.node),x.o&&f(x.o,L,_),x.t1&&g(x.t1,L,_,!0),"OPTION"===_.node.tagName&&("SELECT"===E.tagName&&(R=E._ractive.binding)&&R.deferUpdate(),T.value||l(_,"value",x.f),_.node._ractive.value==E._ractive.value&&(_.node.selected=!0)),_.node.autofocus&&t.focus(_.node)),"option"===_.lcName&&(_.select=m(_.parent)),d(_)}}(L,P,s,Ie,l,Z,a,A,fn,jn,Fn,qn,Hn,Vn,Jn,ur,pn),hr=function(t,e){function n(t){var e,n,r,i,o;for(i=t.liveQueries.length;i--;)if(e=t.liveQueries[i],n=e.selector,e._remove(t.node),t.matchingStaticNodes&&(r=t.matchingStaticNodes[n]))for(o=r.length;o--;)e.remove(r[o])}return function(r){var i,o,s;for(r&&(this.willDetach=!0,t.detachWhenReady(this)),this.fragment&&this.fragment.teardown(!1);this.attributes.length;)this.attributes.pop().teardown();if(this.node){for(i in this.node._ractive.events)this.node._ractive.events[i].teardown();(o=this.node._ractive.binding)&&(o.teardown(),s=this.root._twowayBindings[o.attr.keypath],s.splice(s.indexOf(o),1))}this.decorator&&this.decorator.teardown(),this.descriptor.t2&&e(this.descriptor.t2,this.root,this,!1),this.liveQueries&&n(this)}}(L,ur),cr=function(t){return function(e,n,r,i){var o,s,a,u,l,h,c,f,p;for(o=this.attributes.length;o--;)this.attributes[o].reassign(e,n,r,i);if(s=this.node._ractive){t(s,"keypath",r,i),void 0!=e&&(s.index[e]=n);for(a in s.events)for(u=s.events[a].proxies,o=u.length;o--;)l=u[o],"object"==typeof l.n&&l.a.reassign(e,n,r,i),l.d&&l.d.reassign(e,n,r,i);(h=s.binding)&&h.keypath.substr(0,r.length)===r&&(c=s.root._twowayBindings[h.keypath],c.splice(c.indexOf(h),1),h.keypath=h.keypath.replace(r,i),c=s.root._twowayBindings[h.keypath]||(s.root._twowayBindings[h.keypath]=[]),c.push(h))}if(this.fragment&&this.fragment.reassign(e,n,r,i),f=this.liveQueries)for(p=this.root,o=f.length;o--;)f[o]._makeDirty()}}(Fe),fr="area base br col command doctype embed hr img input keygen link meta param source track wbr".split(" "),pr=function(t,e){function n(t){var n,r,i,o,s;if(n=t.attributes.value.value,r=t.select.attributes.value,i=r.interpolator){if(o=t.root.get(i.keypath||i.ref),o==n)return!0;if(t.select.attributes.multiple&&e(o))for(s=o.length;s--;)if(o[s]==n)return!0}}function r(t){var e,n,r,i;return e=t.attributes,n=e.type,r=e.value,i=e.name,n&&"radio"===n.value&&r&&i.interpolator&&r.value===i.interpolator.value?!0:void 0}return function(){var e,i,o,s;for(e="<"+(this.descriptor.y?"!doctype":this.descriptor.e),o=this.attributes.length,i=0;o>i;i+=1)(s=this.attributes[i].toString())&&(e+=" "+s);return"option"===this.lcName&&n(this)&&(e+=" selected"),"input"===this.lcName&&r(this)&&(e+=" checked"),e+=">",this.html?e+=this.html:this.fragment&&(e+=this.fragment.toString()),-1===t.indexOf(this.descriptor.e)&&(e+="</"+this.descriptor.e+">"),this.stringifying=!1,e}}(fr,C),dr=function(t){return function(e){var n;return t(this.node,e)?this.node:this.html&&(n=this.node.querySelector(e))?n:this.fragment&&this.fragment.find?this.fragment.find(e):void 0}}(ae),gr=function(t){return function(e,n){var r,i;n._test(this,!0)&&n.live&&(this.liveQueries||(this.liveQueries=[])).push(n),this.html&&(r=t(this,e),n.push.apply(n,r),n.live&&!i&&(this.liveQueries||(this.liveQueries=[])).push(n)),this.fragment&&this.fragment.findAll(e,n)}}(zn),vr=function(t){return this.fragment?this.fragment.findComponent(t):void 0},mr=function(t,e){this.fragment&&this.fragment.findAllComponents(t,e)},_r=function(){var t=this.attributes;if(this.node&&(this.binding&&(this.binding.teardown(),this.binding=null),!(this.node.getAttribute("contenteditable")&&t.value&&t.value.bind())))switch(this.descriptor.e){case"select":case"textarea":return void(t.value&&t.value.bind());case"input":if("radio"===this.node.type||"checkbox"===this.node.type){if(t.name&&t.name.bind())return;if(t.checked&&t.checked.bind())return}if(t.value&&t.value.bind())return}},yr=function(t,e,n,r,i,o,s,a,u,l,h){var c=function(t,e){n(this,t,e)};return c.prototype={detach:function(){var n;if(this.node)return this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.node;if(this.cssDetachQueue.length){for(t.start();n===this.cssDetachQueue.pop();)e.remove(n);t.end()}},teardown:r,reassign:i,firstNode:function(){return this.node},findNextNode:function(){return null},bubble:function(){},toString:o,find:s,findAll:a,findComponent:u,findAllComponents:l,bind:h},c}(L,E,lr,hr,cr,pr,dr,gr,vr,mr,_r),wr={missingParser:"Missing Ractive.parse - cannot parse template. Either preparse or use the version that includes the parser"},br={},Er=function(t){var e,n,r;for(r="";t.length;){if(e=t.indexOf("<!--"),n=t.indexOf("-->"),-1===e&&-1===n){r+=t;break}if(-1!==e&&-1===n)throw"Illegal HTML - expected closing comment sequence ('-->')";if(-1!==n&&-1===e||e>n)throw"Illegal HTML - unexpected closing comment sequence ('-->')";r+=t.substr(0,e),t=t.substring(n+3)}return r},xr=function(t){return function(e){var n,r,i,o,s,a;for(s=/^\s*\r?\n/,a=/\r?\n\s*$/,n=2;n<e.length;n+=1)r=e[n],i=e[n-1],o=e[n-2],r.type===t.TEXT&&i.type===t.MUSTACHE&&i.mustacheType!==t.PARTIAL&&o.type===t.TEXT&&a.test(o.value)&&s.test(r.value)&&(i.mustacheType!==t.INTERPOLATOR&&i.mustacheType!==t.TRIPLE&&(o.value=o.value.replace(a,"\n")),r.value=r.value.replace(s,""),""===r.value&&e.splice(n--,1));return e}}(P),Sr=function(t){return function(e){var n,r,i,o;for(n=0;n<e.length;n+=1)r=e[n],i=e[n-1],o=e[n+1],(r.mustacheType===t.COMMENT||r.mustacheType===t.DELIMCHANGE)&&(e.splice(n,1),i&&o&&i.type===t.TEXT&&o.type===t.TEXT&&(i.value+=o.value,e.splice(n,1)),n-=1);return e}}(P),Ar=function(t){var e=t(/^[^\s=]+/);return function(t){var n,r,i;return t.getStringMatch("=")?(n=t.pos,t.allowWhitespace(),(r=e(t))?(t.allowWhitespace(),(i=e(t))?(t.allowWhitespace(),t.getStringMatch("=")?[r,i]:(t.pos=n,null)):(t.pos=n,null)):(t.pos=n,null)):null}}(xn),Tr=function(t){var e={"#":t.SECTION,"^":t.INVERTED,"/":t.CLOSING,">":t.PARTIAL,"!":t.COMMENT,"&":t.TRIPLE};return function(t){var n=e[t.str.charAt(t.pos)];return n?(t.pos+=1,n):null}}(P),kr=function(t,e,n){function r(e){for(var n=[];e.t===t.MEMBER&&e.r.t===t.REFINEMENT;)n.unshift(e.r),e=e.x;return e.t!==t.REFERENCE?null:{r:e.n,m:n}}var i=e(/^\s*:\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/),o=/^[0-9][1-9]*$/;return function(e,s){var a,u,l,h,c,f,p,d,g;if(a=e.pos,u={type:s?t.TRIPLE:t.MUSTACHE},!(s||((h=e.getExpression())&&(u.mustacheType=t.INTERPOLATOR,e.allowWhitespace(),e.getStringMatch(e.delimiters[1])?e.pos-=e.delimiters[1].length:(e.pos=a,h=null)),h||(l=n(e),l===t.TRIPLE?u={type:t.TRIPLE}:u.mustacheType=l||t.INTERPOLATOR,l!==t.COMMENT&&l!==t.CLOSING||(f=e.remaining(),p=f.indexOf(e.delimiters[1]),-1===p)))))return u.ref=f.substr(0,p),e.pos+=p,u;if(!h&&(e.allowWhitespace(),h=e.getExpression(),f=e.remaining(),d=s?e.tripleDelimiters[1]:e.delimiters[1],f.substr(0,d.length)!==d&&":"!==f.charAt(0)&&(e.pos=a,f=e.remaining(),p=f.indexOf(e.delimiters[1]),-1!==p)))return u.ref=f.substr(0,p).trim(),e.pos+=p,u;for(;h.t===t.BRACKETED&&h.x;)h=h.x;return h.t===t.REFERENCE?u.ref=h.n:h.t===t.NUMBER_LITERAL&&o.test(h.v)?u.ref=h.v:(g=r(h))?u.keypathExpression=g:u.expression=h,c=i(e),null!==c&&(u.indexRef=c),u}}(P,xn,Tr),Or=function(t,e,n){function r(r,i){var o,s,a=r.pos;return s=i?r.tripleDelimiters:r.delimiters,r.getStringMatch(s[0])?(o=e(r))?r.getStringMatch(s[1])?(r[i?"tripleDelimiters":"delimiters"]=o,{type:t.MUSTACHE,mustacheType:t.DELIMCHANGE}):(r.pos=a,null):(r.allowWhitespace(),o=n(r,i),null===o?(r.pos=a,null):(r.allowWhitespace(),r.getStringMatch(s[1])?o:(r.pos=a,null))):null}return function(){var t=this.tripleDelimiters[0].length>this.delimiters[0].length;return r(this,t)||r(this,!t)}}(P,Ar,kr),Nr=function(t){return function(){var e,n,r;if(!this.getStringMatch("<!--"))return null;if(n=this.remaining(),r=n.indexOf("-->"),-1===r)throw new Error('Unexpected end of input (expected "-->" to close comment)');return e=n.substr(0,r),this.pos+=r+3,{type:t.COMMENT,content:e}}}(P),Lr=function(t,e){var n,r,i;for(n=e.length;n--;){if(r=t.indexOf(e[n]),!r)return 0;-1!==r&&(!i||i>r)&&(i=r)}return i||-1},Rr=function(t,e,n){var r,i,o,s,a,u,l,h,c,f,p,d,g;return r=function(){return i(this)||o(this)},i=function(e){var n,r,i,o;return n=e.pos,e.inside?null:e.getStringMatch("<")?(r={type:t.TAG},e.getStringMatch("!")&&(r.doctype=!0),r.name=s(e),r.name?(i=a(e),i&&(r.attrs=i),e.allowWhitespace(),e.getStringMatch("/")&&(r.selfClosing=!0),e.getStringMatch(">")?(o=r.name.toLowerCase(),("script"===o||"style"===o)&&(e.inside=o),r):(e.pos=n,null)):(e.pos=n,null)):null},o=function(e){var n,r,i;if(n=e.pos,i=function(t){throw new Error("Unexpected character "+e.remaining().charAt(0)+" (expected "+t+")")},!e.getStringMatch("<"))return null;if(r={type:t.TAG,closing:!0},e.getStringMatch("/")||i('"/"'),r.name=s(e),r.name||i("tag name"),e.getStringMatch(">")||i('">"'),e.inside){if(r.name.toLowerCase()!==e.inside)return e.pos=n,null;e.inside=null}return r},s=e(/^[a-zA-Z]{1,}:?[a-zA-Z0-9\-]*/),a=function(t){var e,n,r;if(e=t.pos,!t.getStringMatch(" ")&&!t.getStringMatch("\n"))return null;if(t.allowWhitespace(),r=u(t),!r)return t.pos=e,null;for(n=[];null!==r;)n.push(r),t.allowWhitespace(),r=u(t);return n},u=function(t){var e,n,r;return(n=l(t))?(e={name:n},r=h(t),r&&(e.value=r),e):null},l=e(/^[^\s"'>\/=]+/),h=function(t){var e,n;return e=t.pos,t.allowWhitespace(),t.getStringMatch("=")?(t.allowWhitespace(),n=g(t,"'")||g(t,'"')||c(t),null===n?(t.pos=e,null):n):(t.pos=e,null)},p=e(/^[^\s"'=<>`]+/),f=function(e){var n,r,i;return n=e.pos,(r=p(e))?(-1!==(i=r.indexOf(e.delimiters[0]))&&(r=r.substr(0,i),e.pos=n+r.length),{type:t.TEXT,value:r}):null},c=function(t){var e,n;for(e=[],n=t.getMustache()||f(t);null!==n;)e.push(n),n=t.getMustache()||f(t);return e.length?e:null},g=function(t,e){var n,r,i;if(n=t.pos,!t.getStringMatch(e))return null;for(r=[],i=t.getMustache()||d(t,e);null!==i;)r.push(i),i=t.getMustache()||d(t,e);return t.getStringMatch(e)?r:(t.pos=n,null)},d=function(e,r){var i,o,s;if(i=e.pos,s=e.remaining(),o=n(s,[r,e.delimiters[0],e.delimiters[1]]),-1===o)throw new Error("Quoted attribute value must have a closing quote");return o?(e.pos+=o,{type:t.TEXT,value:s.substr(0,o)}):null},r}(P,xn,Lr),Cr=function(t,e){return function(){var n,r,i;return r=this.remaining(),i=this.inside?"</"+this.inside:"<",(n=this.inside&&!this.interpolate[this.inside]?r.indexOf(i):e(r,[i,this.delimiters[0],this.tripleDelimiters[0]]))?(-1===n&&(n=r.length),this.pos+=n,{type:t.TEXT,value:r.substr(0,n)}):null}}(P,Lr),Dr=function(t){return function(e){var n=e.remaining();return"true"===n.substr(0,4)?(e.pos+=4,{t:t.BOOLEAN_LITERAL,v:"true"}):"false"===n.substr(0,5)?(e.pos+=5,{t:t.BOOLEAN_LITERAL,v:"false"}):null}}(P),Ir=function(t,e){return function(n){var r,i,o;return r=n.pos,n.allowWhitespace(),i=e(n),null===i?(n.pos=r,null):(n.allowWhitespace(),n.getStringMatch(":")?(n.allowWhitespace(),o=n.getExpression(),null===o?(n.pos=r,null):{t:t.KEY_VALUE_PAIR,k:i,v:o}):(n.pos=r,null))}}(P,Ln),Ur=function(t){return function e(n){var r,i,o,s;return r=n.pos,o=t(n),null===o?null:(i=[o],n.getStringMatch(",")?(s=e(n),s?i.concat(s):(n.pos=r,null)):i)}}(Ir),Mr=function(t,e){return function(n){var r,i;return r=n.pos,n.allowWhitespace(),n.getStringMatch("{")?(i=e(n),n.allowWhitespace(),n.getStringMatch("}")?{t:t.OBJECT_LITERAL,m:i}:(n.pos=r,null)):(n.pos=r,null)}}(P,Ur),Pr=function go(t){var e,n,r,i;if(e=t.pos,t.allowWhitespace(),r=t.getExpression(),null===r)return null;if(n=[r],t.allowWhitespace(),t.getStringMatch(",")){if(i=go(t),null===i)return t.pos=e,null;n=n.concat(i)}return n},jr=function(t,e){return function(n){var r,i;return r=n.pos,n.allowWhitespace(),n.getStringMatch("[")?(i=e(n),n.getStringMatch("]")?{t:t.ARRAY_LITERAL,m:i}:(n.pos=r,null)):(n.pos=r,null)}}(P,Pr),Fr=function(t,e,n,r,i){return function(o){var s=t(o)||e(o)||n(o)||r(o)||i(o);return s}}(On,Dr,kn,Mr,jr),Br=function(t,e,n){var r,i,o,s;return r=e(/^\.[a-zA-Z_$0-9]+/),i=function(t){var e=o(t);return e?"."+e:null},o=e(/^\[(0|[1-9][0-9]*)\]/),s=/^(?:Array|Date|RegExp|decodeURIComponent|decodeURI|encodeURIComponent|encodeURI|isFinite|isNaN|parseFloat|parseInt|JSON|Math|NaN|undefined|null)$/,function(e){var o,a,u,l,h,c,f;for(o=e.pos,a="";e.getStringMatch("../");)a+="../";if(a||(l=e.getStringMatch(".")||""),u=n(e)||"",!a&&!l&&s.test(u))return{t:t.GLOBAL,v:u};if("this"!==u||a||l||(u=".",o+=3),h=(a||l)+u,!h)return null;for(;c=r(e)||i(e);)h+=c;return e.getStringMatch("(")&&(f=h.lastIndexOf("."),-1!==f?(h=h.substr(0,f),e.pos=o+h.length):e.pos-=1),{t:t.REFERENCE,n:h}}}(P,xn,Nn),zr=function(t){return function(e){var n,r;return n=e.pos,e.getStringMatch("(")?(e.allowWhitespace(),(r=e.getExpression())?(e.allowWhitespace(),e.getStringMatch(")")?{t:t.BRACKETED,x:r}:(e.pos=n,null)):(e.pos=n,null)):null}}(P),qr=function(t,e,n){return function(r){return t(r)||e(r)||n(r)}}(Fr,Br,zr),Xr=function(t,e){return function(n){var r,i,o;if(r=n.pos,n.allowWhitespace(),n.getStringMatch(".")){if(n.allowWhitespace(),i=e(n))return{t:t.REFINEMENT,n:i};n.expected("a property name")}return n.getStringMatch("[")?(n.allowWhitespace(),o=n.getExpression(),o||n.expected("an expression"),n.allowWhitespace(),n.getStringMatch("]")||n.expected('"]"'),{t:t.REFINEMENT,x:o}):null}}(P,Nn),Hr=function(t,e,n,r){return function(i){var o,s,a,u;if(s=e(i),!s)return null;for(;s;)if(o=i.pos,a=r(i))s={t:t.MEMBER,x:s,r:a};else{if(!i.getStringMatch("("))break;if(i.allowWhitespace(),u=n(i),i.allowWhitespace(),!i.getStringMatch(")")){i.pos=o;break}s={t:t.INVOCATION,x:s},u&&(s.o=u)}return s}}(P,qr,Pr,Xr),Wr=function(t,e){var n,r;return r=function(e,n){return function(r){var i,o;return r.getStringMatch(e)?(i=r.pos,r.allowWhitespace(),o=r.getExpression(),o||r.expected("an expression"),{s:e,o:o,t:t.PREFIX_OPERATOR}):n(r)}},function(){var t,i,o,s,a;for(s="! ~ + - typeof".split(" "),a=e,t=0,i=s.length;i>t;t+=1)o=r(s[t],a),a=o;n=a}(),n}(P,Hr),Vr=function(t,e){var n,r;return r=function(e,n){return function(r){var i,o,s;if(o=n(r),!o)return null;for(;;){if(i=r.pos,r.allowWhitespace(),!r.getStringMatch(e))return r.pos=i,o;if("in"===e&&/[a-zA-Z_$0-9]/.test(r.remaining().charAt(0)))return r.pos=i,o;if(r.allowWhitespace(),s=n(r),!s)return r.pos=i,o;o={t:t.INFIX_OPERATOR,s:e,o:[o,s]}}}},function(){var t,i,o,s,a;for(s="* / % + - << >> >>> < <= > >= in instanceof == != === !== & ^ | && ||".split(" "),a=e,t=0,i=s.length;i>t;t+=1)o=r(s[t],a),a=o;n=a}(),n}(P,Wr),Jr=function(t,e){return function(n){var r,i,o,s;return(i=e(n))?(r=n.pos,n.allowWhitespace(),n.getStringMatch("?")?(n.allowWhitespace(),(o=n.getExpression())?(n.allowWhitespace(),n.getStringMatch(":")?(n.allowWhitespace(),s=n.getExpression(),s?{t:t.CONDITIONAL,o:[i,o,s]}:(n.pos=r,i)):(n.pos=r,i)):(n.pos=r,i)):(n.pos=r,i)):null}}(P,Vr),Gr=function(t){return function(){return t(this)}}(Jr),Kr=function(t,e,n,r,i,o,s){var a;return a=function(t,e){var n;for(this.str=t,this.pos=0,this.delimiters=e.delimiters,this.tripleDelimiters=e.tripleDelimiters,this.interpolate=e.interpolate,this.tokens=[];this.pos<this.str.length;)n=this.getToken(),null===n&&this.remaining()&&this.fail(),this.tokens.push(n)},a.prototype={getToken:function(){var t=this.getMustache()||this.getComment()||this.getTag()||this.getText();return t},getMustache:t,getComment:e,getTag:n,getText:r,getExpression:i,allowWhitespace:o,getStringMatch:s,remaining:function(){return this.str.substring(this.pos)},fail:function(){var t,e;throw t=this.str.substr(0,this.pos).substr(-20),20===t.length&&(t="..."+t),e=this.remaining().substr(0,20),20===e.length&&(e+="..."),new Error("Could not parse template: "+(t?t+"<- ":"")+"failed at character "+this.pos+" ->"+e)},expected:function(t){var e=this.remaining().substr(0,40);throw 40===e.length&&(e+="..."),new Error('Tokenizer failed: unexpected string "'+e+'" (expected '+t+")")}},a}(Or,Nr,Rr,Cr,Gr,En,bn),$r=function(t,e,n,r,i){return function(o,s){var a,u;return s=s||{},s.stripComments!==!1&&(o=e(o)),a=new i(o,{delimiters:s.delimiters||t.defaults.delimiters,tripleDelimiters:s.tripleDelimiters||t.defaults.tripleDelimiters,interpolate:{script:s.interpolateScripts!==!1?!0:!1,style:s.interpolateStyles!==!1?!0:!1}}),u=a.tokens,n(u),r(u),u}}(i,Er,xr,Sr,Kr),Qr=function(t){var e,n,r,i,o,s,a,u,l;return e=function(t,e){this.text=e?t.value:t.value.replace(l," ")},e.prototype={type:t.TEXT,toJSON:function(){return this.decoded||(this.decoded=u(this.text))},toString:function(){return this.text}},n={quot:34,amp:38,apos:39,lt:60,gt:62,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,copy:169,ordf:170,laquo:171,not:172,shy:173,reg:174,macr:175,deg:176,plusmn:177,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,sup1:185,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,Agrave:192,Aacute:193,Acirc:194,Atilde:195,Auml:196,Aring:197,AElig:198,Ccedil:199,Egrave:200,Eacute:201,Ecirc:202,Euml:203,Igrave:204,Iacute:205,Icirc:206,Iuml:207,ETH:208,Ntilde:209,Ograve:210,Oacute:211,Ocirc:212,Otilde:213,Ouml:214,times:215,Oslash:216,Ugrave:217,Uacute:218,Ucirc:219,Uuml:220,Yacute:221,THORN:222,szlig:223,agrave:224,aacute:225,acirc:226,atilde:227,auml:228,aring:229,aelig:230,ccedil:231,egrave:232,eacute:233,ecirc:234,euml:235,igrave:236,iacute:237,icirc:238,iuml:239,eth:240,ntilde:241,ograve:242,oacute:243,ocirc:244,otilde:245,ouml:246,divide:247,oslash:248,ugrave:249,uacute:250,ucirc:251,uuml:252,yacute:253,thorn:254,yuml:255,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},r=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376],i=new RegExp("&("+Object.keys(n).join("|")+");?","g"),o=/&#x([0-9]+);?/g,s=/&#([0-9]+);?/g,a=function(t){return t?10===t?32:128>t?t:159>=t?r[t-128]:55296>t?t:57343>=t?65533:65535>=t?t:65533:65533},u=function(t){var e;return e=t.replace(i,function(t,e){return n[e]?String.fromCharCode(n[e]):t}),e=e.replace(o,function(t,e){return String.fromCharCode(a(parseInt(e,16)))}),e=e.replace(s,function(t,e){return String.fromCharCode(a(e))})},l=/\s+/g,e}(P),Yr=function(t,e){return function(n,r){return n.type===t.TEXT?(this.pos+=1,new e(n,r)):null}}(P,Qr),Zr=function(t){var e;return e=function(t){this.content=t.content},e.prototype={toJSON:function(){return{t:t.COMMENT,f:this.content}},toString:function(){return"<!--"+this.content+"-->"}},e}(P),ti=function(t,e){return function(n){return n.type===t.COMMENT?(this.pos+=1,new e(n,this.preserveWhitespace)):null}}(P,Zr),ei=function(t,e){function n(t){return JSON.stringify(String(t))}function r(n,i){var o,s;if(n.t===t.REFERENCE&&-1===i.indexOf(n.n)&&i.unshift(n.n),s=n.o||n.m)if(e(s))r(s,i);else for(o=s.length;o--;)r(s[o],i);n.x&&r(n.x,i),n.r&&r(n.r,i),n.v&&r(n.v,i)}function i(e,r){var o=function(t){return i(t,r)};switch(e.t){case t.BOOLEAN_LITERAL:case t.GLOBAL:case t.NUMBER_LITERAL:return e.v;case t.STRING_LITERAL:return n(e.v);case t.ARRAY_LITERAL:return"["+(e.m?e.m.map(o).join(","):"")+"]";case t.OBJECT_LITERAL:return"{"+(e.m?e.m.map(o).join(","):"")+"}";
case t.KEY_VALUE_PAIR:return e.k+":"+i(e.v,r);case t.PREFIX_OPERATOR:return("typeof"===e.s?"typeof ":e.s)+i(e.o,r);case t.INFIX_OPERATOR:return i(e.o[0],r)+("in"===e.s.substr(0,2)?" "+e.s+" ":e.s)+i(e.o[1],r);case t.INVOCATION:return i(e.x,r)+"("+(e.o?e.o.map(o).join(","):"")+")";case t.BRACKETED:return"("+i(e.x,r)+")";case t.MEMBER:return i(e.x,r)+i(e.r,r);case t.REFINEMENT:return e.n?"."+e.n:"["+i(e.x,r)+"]";case t.CONDITIONAL:return i(e.o[0],r)+"?"+i(e.o[1],r)+":"+i(e.o[2],r);case t.REFERENCE:return"${"+r.indexOf(e.n)+"}";default:throw new Error("Could not stringify expression token. This error is unexpected")}}var o=function(t){this.refs=[],r(t,this.refs),this.str=i(t,this.refs)};return o.prototype={toJSON:function(){return this.json||(this.json={r:this.refs,s:this.str}),this.json}},o}(P,te),ni=function(t,e){function n(n){return n.n?n.n:n.x.t===t.STRING_LITERAL||n.x.t===t.NUMBER_LITERAL?n.x.v:n.x.t===t.REFERENCE?n.x:new e(n.x).toJSON()}var r;return r=function(t){this.json={r:t.r,m:t.m.map(n)}},r.prototype={toJSON:function(){return this.json}},r}(P,ei),ri=function(t,e,n){var r=function(r,i){this.type=r.type===t.TRIPLE?t.TRIPLE:r.mustacheType,r.ref&&(this.ref=r.ref),r.keypathExpression&&(this.keypathExpr=new e(r.keypathExpression)),r.expression&&(this.expr=new n(r.expression)),i.pos+=1};return r.prototype={toJSON:function(){var t;return this.json?this.json:(t={t:this.type},this.ref&&(t.r=this.ref),this.keypathExpr&&(t.kx=this.keypathExpr.toJSON()),this.expr&&(t.x=this.expr.toJSON()),this.json=t,t)},toString:function(){return!1}},r}(P,ni,ei),ii=function(t){var e,n,r,i="";if(!t)return"";for(n=0,r=t.length;r>n;n+=1){if(e=t[n].toString(),e===!1)return!1;i+=e}return i},oi=function(t){return function(e,n,r){var i,o;return r||n||(i=t(e),i===!1)?o=e.map(function(t){return t.toJSON(n)}):i}}(ii),si=function(t,e,n,r,i){function o(t,n){var r=t.ref,i=e(n.ref.trim());if(r&&i&&(t.indexRef&&(r+=":"+t.indexRef),r.substr(0,i.length)!==i))throw new Error("Could not parse template: Illegal closing section {{/"+i+"}}. Expected {{/"+t.ref+"}}.")}var s=function(e,n){var s;for(this.ref=e.ref,this.indexRef=e.indexRef,this.inverted=e.mustacheType===t.INVERTED,e.keypathExpression&&(this.keypathExpr=new r(e.keypathExpression)),e.expression&&(this.expr=new i(e.expression)),n.pos+=1,this.items=[],s=n.next();s;){if(s.mustacheType===t.CLOSING){o(this,s),n.pos+=1;break}this.items.push(n.getStub()),s=n.next()}};return s.prototype={toJSON:function(e){var r;return this.json?this.json:(r={t:t.SECTION},this.ref&&(r.r=this.ref),this.indexRef&&(r.i=this.indexRef),this.inverted&&(r.n=!0),this.expr&&(r.x=this.expr.toJSON()),this.keypathExpr&&(r.kx=this.keypathExpr.toJSON()),this.items.length&&(r.f=n(this.items,e)),this.json=r,r)},toString:function(){return!1}},s}(P,v,oi,ni,ei),ai=function(t,e,n){return function(r){return r.type===t.MUSTACHE||r.type===t.TRIPLE?r.mustacheType===t.SECTION||r.mustacheType===t.INVERTED?new n(r,this):new e(r,this):void 0}}(P,ri,si),ui={li:["li"],dt:["dt","dd"],dd:["dt","dd"],p:"address article aside blockquote dir div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr menu nav ol p pre section table ul".split(" "),rt:["rt","rp"],rp:["rp","rt"],optgroup:["optgroup"],option:["option","optgroup"],thead:["tbody","tfoot"],tbody:["tbody","tfoot"],tr:["tr"],td:["td","th"],th:["td","th"]},li=function(t){function e(n){var r,i;if("object"!=typeof n)return n;if(t(n))return n.map(e);r={};for(i in n)n.hasOwnProperty(i)&&(r[i]=e(n[i]));return r}return function(t){var n,r,i,o,s,a;for(i={},n=[],r=[],s=t.length,o=0;s>o;o+=1)if(a=t[o],"intro"===a.name){if(i.intro)throw new Error("An element can only have one intro transition");i.intro=a}else if("outro"===a.name){if(i.outro)throw new Error("An element can only have one outro transition");i.outro=a}else if("intro-outro"===a.name){if(i.intro||i.outro)throw new Error("An element can only have one intro and one outro transition");i.intro=a,i.outro=e(a)}else"proxy-"===a.name.substr(0,6)?(a.name=a.name.substring(6),r.push(a)):"on-"===a.name.substr(0,3)?(a.name=a.name.substring(3),r.push(a)):"decorator"===a.name?i.decorator=a:n.push(a);return i.attrs=n,i.proxies=r,i}}(C),hi=function(t,e){return function(n){var r,i,o,s,a,u,l,h;for(a=function(){throw new Error("Illegal directive")},n.name&&n.value||a(),r={directiveType:n.name},i=n.value,u=[],l=[];i.length;)if(o=i.shift(),o.type===t.TEXT){if(s=o.value.indexOf(":"),-1!==s){s&&u.push({type:t.TEXT,value:o.value.substr(0,s)}),o.value.length>s+1&&(l[0]={type:t.TEXT,value:o.value.substring(s+1)});break}u.push(o)}else u.push(o);return l=l.concat(i),r.name=1===u.length&&u[0].type===t.TEXT?u[0].value:u,l.length&&(1===l.length&&l[0].type===t.TEXT?(h=e("["+l[0].value+"]"),r.args=h?h.value:l[0].value):r.dynamicArgs=l),r}}(P,Rn),ci=function(t,e){var n;return n=function(t,e){var n;for(this.tokens=t||[],this.pos=0,this.options=e,this.result=[];n=this.getStub();)this.result.push(n)},n.prototype={getStub:function(){var t=this.next();return t?this.getText(t)||this.getMustache(t):null},getText:t,getMustache:e,next:function(){return this.tokens[this.pos]}},n}(Yr,ai),fi=function(t,e,n){var r;return r=function(e){var n=new t(e);this.stubs=n.result},r.prototype={toJSON:function(t){var e;return this["json_"+t]?this["json_"+t]:e=this["json_"+t]=n(this.stubs,t)},toString:function(){return void 0!==this.str?this.str:(this.str=e(this.stubs),this.str)}},r}(ci,ii,oi),pi=function(t){return function(e){var n,r;if("string"==typeof e.name){if(!e.args&&!e.dynamicArgs)return e.name;r=e.name}else r=new t(e.name).toJSON();return n={n:r},e.args?(n.a=e.args,n):(e.dynamicArgs&&(n.d=new t(e.dynamicArgs).toJSON()),n)}}(fi),di=function(t,e,n){return function(r){var i,o,s,a,u,l,h;if(this["json_"+r])return this["json_"+r];if(i={t:t.ELEMENT,e:this.tag},this.doctype&&(i.y=1),this.attributes&&this.attributes.length)for(i.a={},l=this.attributes.length,u=0;l>u;u+=1){if(h=this.attributes[u],o=h.name,i.a[o])throw new Error("You cannot have multiple attributes with the same name");s=null===h.value?null:h.value.toJSON(r),i.a[o]=s}if(this.items&&this.items.length&&(i.f=e(this.items,r)),this.proxies&&this.proxies.length)for(i.v={},l=this.proxies.length,u=0;l>u;u+=1)a=this.proxies[u],i.v[a.directiveType]=n(a);return this.intro&&(i.t1=n(this.intro)),this.outro&&(i.t2=n(this.outro)),this.decorator&&(i.o=n(this.decorator)),this["json_"+r]=i,i}}(P,oi,pi),gi=function(t,e){var n;return n="a abbr acronym address applet area b base basefont bdo big blockquote body br button caption center cite code col colgroup dd del dfn dir div dl dt em fieldset font form frame frameset h1 h2 h3 h4 h5 h6 head hr html i iframe img input ins isindex kbd label legend li link map menu meta noframes noscript object ol p param pre q s samp script select small span strike strong style sub sup textarea title tt u ul var article aside audio bdi canvas command data datagrid datalist details embed eventsource figcaption figure footer header hgroup keygen mark meter nav output progress ruby rp rt section source summary time track video wbr".split(" "),function(){var r,i,o,s,a,u,l,h;if(void 0!==this.str)return this.str;if(-1===n.indexOf(this.tag.toLowerCase()))return this.str=!1;if(this.proxies||this.intro||this.outro||this.decorator)return this.str=!1;if(l=t(this.items),l===!1)return this.str=!1;if(h=-1!==e.indexOf(this.tag.toLowerCase()),r="<"+this.tag,this.attributes)for(i=0,o=this.attributes.length;o>i;i+=1){if(a=this.attributes[i].name,-1!==a.indexOf(":"))return this.str=!1;if("id"===a||"intro"===a||"outro"===a)return this.str=!1;if(s=" "+a,null!==this.attributes[i].value){if(u=this.attributes[i].value.toString(),u===!1)return this.str=!1;""!==u&&(s+="=",s+=/[\s"'=<>`]/.test(u)?'"'+u.replace(/"/g,"&quot;")+'"':u)}r+=s}return this.selfClosing&&!h?(r+="/>",this.str=r):(r+=">",h?this.str=r:(r+=l,r+="</"+this.tag+">",this.str=r))}}(ii,fr),vi=function(t,e,n,r,i,o,s,a,u){var l,h,c,f,p,d=/^\s+/,g=/\s+$/;return l=function(s,a,l){var h,c,f,v,m,_,y;if(a.pos+=1,_=function(t){return{name:t.name,value:t.value?new u(t.value):null}},this.tag=s.name,y=s.name.toLowerCase(),"rv-"===y.substr(0,3)&&(n('The "rv-" prefix for components has been deprecated. Support will be removed in a future version'),this.tag=this.tag.substring(3)),l=l||"pre"===y||"style"===y||"script"===y,s.attrs&&(f=i(s.attrs),c=f.attrs,v=f.proxies,a.options.sanitize&&a.options.sanitize.eventAttributes&&(c=c.filter(p)),c.length&&(this.attributes=c.map(_)),v.length&&(this.proxies=v.map(o)),f.intro&&(this.intro=o(f.intro)),f.outro&&(this.outro=o(f.outro)),f.decorator&&(this.decorator=o(f.decorator))),s.doctype&&(this.doctype=!0),s.selfClosing&&(this.selfClosing=!0),-1!==e.indexOf(y)&&(this.isVoid=!0),!this.selfClosing&&!this.isVoid){for(this.siblings=r[y],this.items=[],h=a.next();h&&h.mustacheType!==t.CLOSING;){if(h.type===t.TAG){if(h.closing){h.name.toLowerCase()===y&&(a.pos+=1);break}if(this.siblings&&-1!==this.siblings.indexOf(h.name.toLowerCase()))break}this.items.push(a.getStub(l)),h=a.next()}l||(m=this.items[0],m&&m.type===t.TEXT&&(m.text=m.text.replace(d,""),m.text||this.items.shift()),m=this.items[this.items.length-1],m&&m.type===t.TEXT&&(m.text=m.text.replace(g,""),m.text||this.items.pop()))}},l.prototype={toJSON:s,toString:a},h="a abbr acronym address applet area b base basefont bdo big blockquote body br button caption center cite code col colgroup dd del dfn dir div dl dt em fieldset font form frame frameset h1 h2 h3 h4 h5 h6 head hr html i iframe img input ins isindex kbd label legend li link map menu meta noframes noscript object ol p param pre q s samp script select small span strike strong style sub sup textarea title tt u ul var article aside audio bdi canvas command data datagrid datalist details embed eventsource figcaption figure footer header hgroup keygen mark meter nav output progress ruby rp rt section source summary time track video wbr".split(" "),c="li dd rt rp optgroup option tbody tfoot tr td th".split(" "),f=/^on[a-zA-Z]/,p=function(t){var e=!f.test(t.name);return e},l}(P,fr,Z,ui,li,hi,di,gi,fi),mi=function(t){return function(e){return this.options.sanitize&&this.options.sanitize.elements&&-1!==this.options.sanitize.elements.indexOf(e.name.toLowerCase())?null:new t(e,this,this.preserveWhitespace)}}(vi),_i=function(t,e,n,r,i){var o;return o=function(t,e){var n,r;for(this.tokens=t||[],this.pos=0,this.options=e,this.preserveWhitespace=e.preserveWhitespace,r=[];n=this.getStub();)r.push(n);this.result=i(r,e.noStringify,!0)},o.prototype={getStub:function(t){var e=this.next();return e?this.getText(e,this.preserveWhitespace||t)||this.getComment(e)||this.getMustache(e)||this.getElement(e):null},getText:t,getComment:e,getMustache:n,getElement:r,next:function(){return this.tokens[this.pos]}},o}(Yr,ti,ai,mi,oi),yi=function(t,e,n){var r,i,o,s,a;return i=/^\s*$/,o=/<!--\s*\{\{\s*>\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*}\}\s*-->/,s=/<!--\s*\{\{\s*\/\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*}\}\s*-->/,r=function(r,s){var u,l,h;return s=s||{},o.test(r)?a(r,s):(s.sanitize===!0&&(s.sanitize={elements:"applet base basefont body frame frameset head html isindex link meta noframes noscript object param script style title".split(" "),eventAttributes:!0}),u=t(r,s),s.preserveWhitespace||(h=u[0],h&&h.type===e.TEXT&&i.test(h.value)&&u.shift(),h=u[u.length-1],h&&h.type===e.TEXT&&i.test(h.value)&&u.pop()),l=new n(u,s).result,"string"==typeof l?[l]:l)},a=function(t,e){var n,i,a,u,l,h;for(a={},n="",i=t;l=o.exec(i);){if(u=l[1],n+=i.substr(0,l.index),i=i.substring(l.index+l[0].length),h=s.exec(i),!h||h[1]!==u)throw new Error("Inline partials must have a closing delimiter, and cannot be nested");a[u]=r(i.substr(0,h.index),e),i=i.substring(h.index+h[0].length)}return{main:r(n,e),partials:a}},r}($r,P,_i),wi=function(){function t(t,e){var r=n.exec(e)[0];return null===t||r.length<t.length?r:t}var e=/^\s*$/,n=/^\s*/;return function(n){var r,i,o,s;return r=n.split("\n"),i=r[0],void 0!==i&&e.test(i)&&r.shift(),o=r[r.length-1],void 0!==o&&e.test(o)&&r.pop(),s=r.reduce(t,null),s&&(n=r.map(function(t){return t.replace(s,"")}).join("\n")),n}}(),bi=function(t,e,n,r,i,o,s){var a,u,l,h;return a=function(r,a){var c,f,p;if(f=l(r,a))return f;if(e&&(c=document.getElementById(a),c&&"SCRIPT"===c.tagName)){if(!o)throw new Error(t.missingParser);u(o(s(c.text),r.parseOptions),a,i)}if(f=i[a],!f){if(p='Could not find descriptor for partial "'+a+'"',r.debug)throw new Error(p);return n(p),[]}return h(f)},l=function(e,n){var r;if(e.partials[n]){if("string"==typeof e.partials[n]){if(!o)throw new Error(t.missingParser);r=o(e.partials[n],e.parseOptions),u(r,n,e.partials)}return h(e.partials[n])}},u=function(t,e,n){var i;if(r(t)){n[e]=t.main;for(i in t.partials)t.partials.hasOwnProperty(i)&&(n[i]=t.partials[i])}else n[e]=t},h=function(t){return 1===t.length&&"string"==typeof t[0]?t[0]:t},a}(wr,u,Z,te,br,yi,wi),Ei=function(t,e){var n;return e?n=t.split("\n").map(function(t,n){return n?e+t:t}).join("\n"):t},xi=function(t,e,n,r){var i,o;return r.push(function(){o=r.DomFragment}),i=function(n,r){var i,s=this.parentFragment=n.parentFragment;if(this.type=t.PARTIAL,this.name=n.descriptor.r,this.index=n.index,!n.descriptor.r)throw new Error("Partials must have a static reference (no expressions). This may change in a future version of Ractive.");i=e(s.root,n.descriptor.r),this.fragment=new o({descriptor:i,root:s.root,pNode:s.pNode,owner:this}),r&&r.appendChild(this.fragment.docFrag)},i.prototype={firstNode:function(){return this.fragment.firstNode()},findNextNode:function(){return this.parentFragment.findNextNode(this)},detach:function(){return this.fragment.detach()},reassign:function(t,e,n,r){return this.fragment.reassign(t,e,n,r)},teardown:function(t){this.fragment.teardown(t)},toString:function(){var e,r,i,o;return e=this.fragment.toString(),r=this.parentFragment.items[this.index-1],r&&r.type===t.TEXT?(i=r.descriptor.split("\n").pop(),(o=/^\s+$/.exec(i))?n(e,o[0]):e):e},find:function(t){return this.fragment.find(t)},findAll:function(t,e){return this.fragment.findAll(t,e)},findComponent:function(t){return this.fragment.findComponent(t)},findAllComponents:function(t,e){return this.fragment.findAllComponents(t,e)}},i}(P,bi,Ei,w),Si=function(t,e){var n=function(t,n,r){this.parentFragment=t.parentFragment,this.component=t,this.key=n,this.fragment=new e({descriptor:r,root:t.root,owner:this}),this.selfUpdating=this.fragment.isSimple(),this.value=this.fragment.getValue()};return n.prototype={bubble:function(){this.selfUpdating?this.update():!this.deferred&&this.ready&&(t.addAttribute(this),this.deferred=!0)},update:function(){var t=this.fragment.getValue();this.component.instance.set(this.key,t),this.value=t},teardown:function(){this.fragment.teardown()}},n}(L,Mn),Ai=function(t,e,n,r,i){function o(o,s,a,u){var l,h,c,f,p,d;return c=o.root,f=o.parentFragment,"string"==typeof a?(h=e(a),h?h.value:a):null===a?!0:1===a.length&&a[0].t===t.INTERPOLATOR&&a[0].r?f.indexRefs&&void 0!==f.indexRefs[d=a[0].r]?(o.indexRefBindings[d]=s,f.indexRefs[d]):(p=n(c,a[0].r,f)||a[0].r,u.push({childKeypath:s,parentKeypath:p}),r(c,p)):(l=new i(o,s,a),o.complexParameters.push(l),l.value)}return function(t,e,n,r){var i,s,a;i={},t.complexParameters=[];for(s in n)n.hasOwnProperty(s)&&(a=o(t,s,n[s],r),(void 0!==a||void 0===e[s])&&(i[s]=a));return i}}(P,Rn,T,Y,Si),Ti=function(){function t(t,e){var n,r,i;if(n=t.adapt.length?t.adapt.map(function(e){return"object"==typeof e?e:t.adaptors[e]||e}):[],r=e.length)for(i=0;r>i;i+=1)-1===n.indexOf(e[i])&&n.push(e[i]);return n}return function(e,n,r,i,o){var s,a,u,l,h;return a=e.parentFragment,l=e.root,u={content:o||[]},h=t(l,n.defaults.adapt,n.adaptors),s=new n({el:a.pNode,append:!0,data:r,partials:u,magic:l.magic||n.defaults.magic,modifyArrays:l.modifyArrays,_parent:l,_component:e,adapt:h}),i&&(s.insert(i),s.fragment.pNode=s.el=a.pNode),s}}(),ki=function(t,e,n){return function(r,i){i.forEach(function(i){var o,s;t(r,r.root,i.parentKeypath,i.childKeypath),o=e(r.instance,i.childKeypath),s=e(r.root,i.parentKeypath),void 0!==o&&void 0===s&&n(r.root,i.parentKeypath,o)})}}(K,Y,B),Oi=function(t){function e(e,r,i,o){if("string"!=typeof o){if(r.debug)throw new Error(n);return void t(n)}e.on(i,function(){var t=Array.prototype.slice.call(arguments);t.unshift(o),r.fire.apply(r,t)})}var n="Components currently only support simple events - you cannot include arguments. Sorry!";return function(t,n){var r;for(r in n)n.hasOwnProperty(r)&&e(t.instance,t.root,r,n[r])}}(Z),Ni=function(t){var e,n;for(e=t.root;e;)(n=e._liveComponentQueries[t.name])&&n.push(t.instance),e=e._parent},Li=function(t,e,n,r,i,o,s){return function(a,u,l){var h,c,f,p,d;if(h=a.parentFragment=u.parentFragment,c=h.root,a.root=c,a.type=t.COMPONENT,a.name=u.descriptor.e,a.index=u.index,a.indexRefBindings={},a.bindings=[],f=c.components[u.descriptor.e],!f)throw new Error('Component "'+u.descriptor.e+'" not found');d=[],p=n(a,f.data||{},u.descriptor.a,d),r(a,f,p,l,u.descriptor.f),i(a,d),o(a,u.descriptor.v),(u.descriptor.t1||u.descriptor.t2||u.descriptor.o)&&e('The "intro", "outro" and "decorator" directives have no effect on components'),s(a)}}(P,Z,Ai,Ti,ki,Oi,Ni),Ri=function(t,e){function n(t){var e,n;e=t.root;do(n=e._liveComponentQueries[t.name])&&n._remove(t);while(e=e._parent)}var r=function(e,n){t(this,e,n)};return r.prototype={firstNode:function(){return this.instance.fragment.firstNode()},findNextNode:function(){return this.parentFragment.findNextNode(this)},detach:function(){return this.instance.fragment.detach()},teardown:function(t){for(;this.complexParameters.length;)this.complexParameters.pop().teardown();for(;this.bindings.length;)this.bindings.pop().teardown();n(this),this.shouldDestroy=t,this.instance.teardown()},reassign:function(t,n,r,i){var o,s,a=this.instance,u=a._parent;this.bindings.forEach(function(o){var s;o.root===u&&(o.keypath===t&&a.set(o.otherKeypath,n),(s=e(o.keypath,r,i))&&o.reassign(s))}),(o=this.indexRefBindings[t])&&a.set(o,n),(s=this.root._liveComponentQueries[this.name])&&s._makeDirty()},toString:function(){return this.instance.fragment.toString()},find:function(t){return this.instance.fragment.find(t)},findAll:function(t,e){return this.instance.fragment.findAll(t,e)},findComponent:function(t){return t&&t!==this.name?this.instance.fragment?this.instance.fragment.findComponent(t):null:this.instance},findAllComponents:function(t,e){e._test(this,!0),this.instance.fragment&&this.instance.fragment.findAllComponents(t,e)}},r}(Li,je),Ci=function(t,e){var n=function(e,n){this.type=t.COMMENT,this.descriptor=e.descriptor,n&&(this.node=document.createComment(e.descriptor.f),n.appendChild(this.node))};return n.prototype={detach:e,teardown:function(t){t&&this.detach()},firstNode:function(){return this.node},toString:function(){return"<!--"+this.descriptor.f+"-->"}},n}(P,Xe),Di=function(t,e,n,r,i,o,s,a,u,l,h,c,f){var p=function(t){t.pNode&&(this.docFrag=document.createDocumentFragment()),"string"==typeof t.descriptor?(this.html=t.descriptor,this.docFrag&&(this.nodes=r(this.html,t.pNode.tagName,t.pNode.namespaceURI,this.docFrag))):n.init(this,t)};return p.prototype={reassign:n.reassign,detach:function(){var t,e;if(this.docFrag){if(this.nodes)for(t=this.nodes.length,e=0;t>e;e+=1)this.docFrag.appendChild(this.nodes[e]);else if(this.items)for(t=this.items.length,e=0;t>e;e+=1)this.docFrag.appendChild(this.items[e].detach());return this.docFrag}},createItem:function(e){if("string"==typeof e.descriptor)return new i(e,this.docFrag);switch(e.descriptor.t){case t.INTERPOLATOR:return new o(e,this.docFrag);case t.SECTION:return new s(e,this.docFrag);case t.TRIPLE:return new a(e,this.docFrag);case t.ELEMENT:return this.root.components[e.descriptor.e]?new h(e,this.docFrag):new u(e,this.docFrag);case t.PARTIAL:return new l(e,this.docFrag);case t.COMMENT:return new c(e,this.docFrag);default:throw new Error("Something very strange happened. Please file an issue at https://github.com/RactiveJS/Ractive/issues. Thanks!")}},teardown:function(t){var e;if(this.nodes&&t)for(;e=this.nodes.pop();)e.parentNode.removeChild(e);else if(this.items)for(;this.items.length;)this.items.pop().teardown(t);this.nodes=this.items=this.docFrag=null},firstNode:function(){return this.items&&this.items[0]?this.items[0].firstNode():this.nodes?this.nodes[0]||null:null},findNextNode:function(t){var e=t.index;return this.items[e+1]?this.items[e+1].firstNode():this.owner===this.root?this.owner.component?this.owner.component.findNextNode():null:this.owner.findNextNode(this)},toString:function(){var t,e,n,r;if(this.html)return this.html;if(t="",!this.items)return t;for(n=this.items.length,e=0;n>e;e+=1)r=this.items[e],t+=r.toString();return t},find:function(t){var n,r,i,o,s;if(this.nodes){for(r=this.nodes.length,n=0;r>n;n+=1)if(o=this.nodes[n],1===o.nodeType){if(e(o,t))return o;if(s=o.querySelector(t))return s}return null}if(this.items){for(r=this.items.length,n=0;r>n;n+=1)if(i=this.items[n],i.find&&(s=i.find(t)))return s;return null}},findAll:function(t,n){var r,i,o,s,a,u,l;if(this.nodes){for(i=this.nodes.length,r=0;i>r;r+=1)if(s=this.nodes[r],1===s.nodeType&&(e(s,t)&&n.push(s),a=s.querySelectorAll(t)))for(u=a.length,l=0;u>l;l+=1)n.push(a[l])}else if(this.items)for(i=this.items.length,r=0;i>r;r+=1)o=this.items[r],o.findAll&&o.findAll(t,n);return n},findComponent:function(t){var e,n,r,i;if(this.items){for(e=this.items.length,n=0;e>n;n+=1)if(r=this.items[n],r.findComponent&&(i=r.findComponent(t)))return i;return null}},findAllComponents:function(t,e){var n,r,i;if(this.items)for(r=this.items.length,n=0;r>n;n+=1)i=this.items[n],i.findAllComponents&&i.findAllComponents(t,e);return e}},f.DomFragment=p,p}(P,ae,ze,qe,He,rn,hn,cn,yr,xi,Ri,Ci,w),Ii=function(t,e,n){function r(t){for(var e;e=t._childInitQueue.pop();)e.instance.init&&e.instance.init(e.options),r(e.instance)}return function(i,o){if(this._rendering=!0,t.start(this,o),!this._initing)throw new Error("You cannot call ractive.render() directly!");this.constructor.css&&e.add(this.constructor),this.fragment=new n({descriptor:this.template,root:this,owner:this,pNode:i}),i&&i.appendChild(this.fragment.docFrag),this._parent&&this._parent._rendering||r(this),delete this._rendering,t.end()}}(L,E,Di),Ui=function(t){return function(){return t("renderHTML() has been deprecated and will be removed in a future version. Please use toHTML() instead"),this.toHTML()}}(Z),Mi=function(t,e,n,r){return function(i,o){var s,a,u;if("function"==typeof i?(o=i,i={}):i=i||{},"object"!=typeof i)throw new Error("The reset method takes either no arguments, or an object containing new data");return s=new t(function(t){a=t}),o&&s.then(o),e.start(this,a),(u=this._wrapped[""])&&u.reset?u.reset(i)===!1&&(this.data=i):this.data=i,n(this,""),r(this,""),e.end(),this.fire("reset",i),s}}(g,L,j,O),Pi=function(t,e,n,r,i){return function(o,s,a){var u,l,h;if(l=new r(function(t){h=t}),t.start(this,h),e(o)){u=o,a=s;for(o in u)u.hasOwnProperty(o)&&(s=u[o],o=n(o),i(this,o,s))}else o=n(o),i(this,o,s);return t.end(),a&&l.then(a.bind(this)),l}}(L,te,v,g,B),ji=function(t){return function(e,n){return t(this,e,void 0===n?-1:-n)}}(f),Fi=function(t,e,n,r,i){return function(o){var s,a,u,l,h,c,f,p;if(this.fire("teardown"),l=!this.component||this.component.shouldDestroy,this.constructor.css)if(l)h=o,o=function(){h&&h.call(this),e.remove(this.constructor)};else{c=this.component.parentFragment;do c.owner.type===t.ELEMENT&&c.owner.willDetach&&(f=c.owner);while(!f&&(c=c.parent));if(!f)throw new Error("A component is being torn down but doesn't have a nearest detaching element... this shouldn't happen!");f.cssDetachQueue.push(this.constructor)}for(a=new r(function(t){u=t}),n.start(this,u),this.fragment.teardown(l);this._animations[0];)this._animations[0].stop();for(s in this._cache)i(this,s);for(;p=this._unresolvedImplicitDependencies.pop();)p.teardown();return n.end(),o&&a.then(o.bind(this)),a}}(P,E,L,g,j),Bi=function(){return this.fragment.toString()},zi=function(t,e){var n;{if("string"==typeof t)return n=this.get(t),this.set(t,!n,e);if(this.debug)throw new Error("Bad arguments")}},qi=function(t,e,n,r){return function(i,o){var s,a;return"function"==typeof i?(o=i,i=""):i=i||"",s=new e(function(t){a=t}),t.start(this,a),n(this,i),r(this,i),t.end(),this.fire("update",i),o&&s.then(o.bind(this)),s}}(L,g,j,O),Xi=function(t,e,n){function r(t,i,o,s,a){var u,l,h,c,f,p;if(u=t._twowayBindings[i])for(h=u.length;h--;)c=u[h],(!c.radioName||c.node.checked)&&(c.checkboxName?c.changed()&&s[i]!==!0&&(s[i]=!0,s.push(i)):(f=c.attr.value,p=c.value(),e(f,p)||n(f,p)||(o[i]=p)));if(a&&(l=t._depsMap[i]))for(h=l.length;h--;)r(t,l[h],o,s,a)}return function(e,n){var i,o,s;if("string"!=typeof e&&(e="",n=!0),r(this,e,i={},o=[],n),s=o.length)for(;s--;)e=o[s],i[e]=t(this,e);this.set(i)}}(x,_n,d),Hi=function(t,e,n,r,i,o,s,a,u,l,h,c,f,p,d,g,v,m,_,y,w,b,E,x){return{add:t,animate:e,detach:n,find:r,findAll:i,findAllComponents:o,findComponent:s,fire:a,get:u,insert:l,merge:h,observe:c,off:f,on:p,render:d,renderHTML:g,reset:v,set:m,subtract:_,teardown:y,toHTML:w,toggle:b,update:E,updateModel:x}}(p,ie,oe,se,ve,me,_e,ye,be,xe,Te,Re,Ce,De,Ii,Ui,Mi,Pi,ji,Fi,Bi,zi,qi,Xi),Wi={},Vi={linear:function(t){return t},easeIn:function(t){return Math.pow(t,3)},easeOut:function(t){return Math.pow(t-1,3)+1},easeInOut:function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)}},Ji=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e,n;return e=16*Math.random()|0,n="x"==t?e:3&e|8,n.toString(16)})},Gi=function(t){for(var e,n,r=Array.prototype.slice.call(arguments,1);n=r.shift();)for(e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t},Ki=["adaptors","components","decorators","easing","events","interpolators","partials","transitions","data"],$i=function(){function t(t){return t.trim?t.trim():t.replace(/^\s+/,"").replace(/\s+$/,"")}function e(t){return t.str}var n=/(?:^|\})?\s*([^\{\}]+)\s*\{/g,r=/\/\*.*?\*\//g,i=/((?:(?:\[[^\]+]\])|(?:[^\s\+\>\~:]))+)((?::[^\s\+\>\~]+)?\s*[\s\+\>\~]?)\s*/g;return function(o,s){var a,u;return u=function(t){var n,r,o,a,u,l,h,c,f=[];for(n=[];r=i.exec(t);)n.push({str:r[0],base:r[1],modifiers:r[2]});for(a='[data-rvcguid="'+s+'"]',u=n.map(e),c=n.length;c--;)h=u.slice(),o=n[c],h[c]=o.base+a+o.modifiers||"",l=u.slice(),l[c]=a+" "+l[c],f.push(h.join(" "),l.join(" "));return f.join(", ")},a=o.replace(r,"").replace(n,function(e,n){var r,i;return r=n.split(",").map(t),i=r.map(u).join(", ")+" ",e.replace(n,i)})}}(),Qi=function(t,e,n,r){return function(i,o){t.forEach(function(t){o[t]&&(i[t]=e(o[t]))}),n(i,"defaults",{value:e(o.defaults)}),o.css&&n(i,"css",{value:o.defaults.noCssTransform?o.css:r(o.css,i._guid)})}}(Ki,Ie,l,$i),Yi=function(t,e){return/_super/.test(t)?function(){var n,r=this._super;return this._super=e,n=t.apply(this,arguments),this._super=r,n}:t},Zi=function(t,e){var n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},to=function(t,e,n,r,i,o){var s={};return e.concat(t.keys).forEach(function(t){s[t]=!0}),function(a,u){var l,h;e.forEach(function(t){var e=u[t];e&&(a[t]?i(a[t],e):a[t]=e)}),t.keys.forEach(function(t){var e=u[t];void 0!==e&&(a.defaults[t]="function"==typeof e&&"function"==typeof a[t]?r(e,a[t]):u[t])});for(l in u)!s[l]&&u.hasOwnProperty(l)&&(h=u[l],a.prototype[l]="function"==typeof h&&"function"==typeof a.prototype[l]?r(h,a.prototype[l]):h);u.css&&n(a,"css",{value:a.defaults.noCssTransform?u.css:o(u.css,a._guid)})}}(i,Ki,l,Yi,Zi,$i),eo=function(t,e){return function(n,r){t(n.defaults.template)&&(n.partials||(n.partials={}),e(n.partials,n.defaults.template.partials),r.partials&&e(n.partials,r.partials),n.defaults.template=n.defaults.template.main)}}(te,Zi),no=function(t,e,n){return function(r){var i;if("string"==typeof r.defaults.template){if(!n)throw new Error(t.missingParser);if("#"===r.defaults.template.charAt(0)&&e){if(i=document.getElementById(r.defaults.template.substring(1)),!i||"SCRIPT"!==i.tagName)throw new Error("Could not find template element ("+r.defaults.template+")");r.defaults.template=n(i.innerHTML,r)}else r.defaults.template=n(r.defaults.template,r.defaults)}}}(wr,u,yi),ro=function(t,e){return function(n){var r;if(n.partials)for(r in n.partials)if(n.partials.hasOwnProperty(r)&&"string"==typeof n.partials[r]){if(!e)throw new Error(t.missingParser);n.partials[r]=e(n.partials[r],n)}}}(wr,yi),io=function(){function t(t){var n="var __ractive=this;return("+t.replace(e,function(t,e){return'__ractive.get("'+e+'")'})+")";return new Function(n)}var e=/\$\{([^\}]+)\}/g;return function(e){return"function"==typeof e?{get:e}:"string"==typeof e?{get:t(e)}:("object"==typeof e&&"string"==typeof e.get&&(e={get:t(e.get),set:e.set}),e)}}(),oo=function(t,e,n){var r=function(t,n){this.root=t.ractive,this.keypath=n,this.priority=0,this.computation=t,e(this)};return r.prototype={update:function(){var e;e=this.root.get(this.keypath),t(e,this.value)||this.computation.bubble()},teardown:function(){n(this)}},r}(d,J,G),so=function(t,e,n,r){function i(t,e,n){var i,o,s;for(i=e.length;i--;)o=e[i],n[o.keypath]||(e.splice(i,1),e[o.keypath]=null,o.teardown());for(i=n.length;i--;)s=n[i],e[s]||(o=new r(t,s),e.push(e[s]=o))}var o=function(t,e,n){this.ractive=t,this.key=e,this.getter=n.get,this.setter=n.set,this.watchers=[],this.update()};return o.prototype={set:function(t){if(this.setting)return void(this.value=t);if(!this.setter)throw new Error("Computed properties without setters are read-only in the current version");this.setter.call(this.ractive,t)},update:function(){var e,r,o,s;e=this.ractive,r=e._captured,r||(e._captured=[]);try{o=this.getter.call(e)}catch(a){e.debug&&t('Failed to compute "'+this.key+'": '+a.message||a),s=!0}i(this,this.watchers,e._captured),e._captured=r,s||(this.setting=!0,this.value=o,n(e,this.key,o),this.setting=!1),this.deferred=!1},bubble:function(){this.watchers.length<=1?this.update():this.deferred||(e.addComputation(this),this.deferred=!0)}},o}(Z,L,B,oo),ao=function(t,e){return function(n,r){var i,o;for(i in r)o=t(r[i]),n._computations[i]=new e(n,i,o)}}(io,so),uo=function(t,e,n,r,i,o,s,a,u,l,h,c,f,p,d,g,v){var m=["adapt","modifyArrays","magic","twoway","lazy","debug","isolated"];return function(_,y){var w,b,E,x,S,A,T;if(c(y.adaptors)&&(i("The `adaptors` option, to indicate which adaptors should be used with a given Ractive instance, has been deprecated in favour of `adapt`. See [TODO] for more information"),y.adapt=y.adaptors,delete y.adaptors),w=_.constructor.defaults,n.keys.forEach(function(t){void 0===y[t]&&(y[t]=w[t])}),m.forEach(function(t){_[t]=y[t]}),"string"==typeof _.adapt&&(_.adapt=[_.adapt]),_.magic&&!d)throw new Error("Getters and setters (magic mode) are not supported in this browser");if(u(_,{_initing:{value:!0,writable:!0},_guid:{value:f()},_subs:{value:o(null),configurable:!0},_cache:{value:{}},_cacheMap:{value:o(null)},_deps:{value:[]},_depsMap:{value:o(null)},_patternObservers:{value:[]},_evaluators:{value:o(null)},_computations:{value:o(null)},_twowayBindings:{value:{}},_animations:{value:[]},nodes:{value:{}},_wrapped:{value:o(null)},_liveQueries:{value:[]},_liveComponentQueries:{value:[]},_childInitQueue:{value:[]},_changes:{value:[]},_unresolvedImplicitDependencies:{value:[]}}),y._parent&&y._component&&(u(_,{_parent:{value:y._parent},component:{value:y._component}}),y._component.instance=_),y.el&&(_.el=l(y.el),!_.el&&_.debug))throw new Error("Could not find container element");if(y.eventDefinitions&&(i("ractive.eventDefinitions has been deprecated in favour of ractive.events. Support will be removed in future versions"),y.events=y.eventDefinitions),r.forEach(function(t){_.constructor[t]?_[t]=s(o(_.constructor[t]),y[t]):y[t]&&(_[t]=y[t])}),_.data||(_.data={}),T=w.computed?s(o(w.computed),y.computed):y.computed,T&&v(_,T),b=y.template,"string"==typeof b){if(!g)throw new Error(e.missingParser);if("#"===b.charAt(0)&&t){if(E=document.getElementById(b.substring(1)),!E)throw new Error("Could not find template element ("+b+")");x=g(E.innerHTML,y)}else x=g(b,y)}else x=b;h(x)&&(a(_.partials,x.partials),x=x.main),x&&1===x.length&&"string"==typeof x[0]&&(x=x[0]),_.template=x,s(_.partials,y.partials),_.parseOptions={preserveWhitespace:y.preserveWhitespace,sanitize:y.sanitize,stripComments:y.stripComments},_.transitionsEnabled=y.noIntro?!1:y.transitionsEnabled,t&&!_.el&&(_.el=document.createDocumentFragment()),_.el&&!y.append&&(_.el.innerHTML=""),S=new p(function(t){A=t
}),_.render(_.el,A),y.complete&&S.then(y.complete.bind(_)),_.transitionsEnabled=y.transitionsEnabled,_._initing=!1}}(u,wr,i,Ki,Z,Ie,Gi,ir,h,Ee,te,C,Ji,g,H,yi,ao),lo=function(t,e,n){return function(r,i,o){t.keys.forEach(function(t){var n=o[t],r=i.defaults[t];"function"==typeof n&&"function"==typeof r&&(o[t]=e(n,r))}),r.beforeInit&&r.beforeInit(o),n(r,o),o._parent&&o._parent._rendering?o._parent._childInitQueue.push({instance:r,options:o}):r.init&&r.init(o)}}(i,Yi,uo),ho=function(t,e,n,r,i,o,s,a,u,l,h){var c;return h.push(function(){c=h.Ractive}),function(h){var f,p,d,g=this;if(h.prototype instanceof c&&(h=r({},h,h.prototype,h.defaults)),f=function(t){l(this,f,t||{})},f.prototype=t(g.prototype),f.prototype.constructor=f,e(f,{extend:{value:g.extend},_guid:{value:n()}}),i(f,g),o(f,h),f.adaptors&&(d=f.defaults.adapt.length))for(;d--;)p=f.defaults.adapt[d],"string"==typeof p&&(f.defaults.adapt[d]=f.adaptors[p]||p);return h.template&&(a(f),s(f,h),u(f)),f}}(Ie,h,Ji,Gi,Qi,to,eo,no,ro,lo,w),co=function(t,e,n,r,i,o,s,a,u,l,h,c,f,p){var d=function(t){f(this,t)};return d.prototype=r,n(d,{partials:{value:i},adaptors:{value:o},easing:{value:a},transitions:{value:{}},events:{value:{}},components:{value:s},decorators:{value:{}},interpolators:{value:u},defaults:{value:t.defaults},svg:{value:e},VERSION:{value:"0.4.0"}}),d.eventDefinitions=d.events,d.prototype.constructor=d,d.Promise=l,d.extend=h,d.parse=c,p.Ractive=d,d}(i,o,h,Hi,br,I,Wi,Vi,ee,g,ho,yi,uo,w),fo=function(t,e){for(var n="function";e.length;)e.pop()();if(typeof Date.now!==n||typeof String.prototype.trim!==n||typeof Object.keys!==n||typeof Array.prototype.indexOf!==n||typeof Array.prototype.forEach!==n||typeof Array.prototype.map!==n||typeof Array.prototype.filter!==n||"undefined"!=typeof window&&typeof window.addEventListener!==n)throw new Error("It looks like you're attempting to use Ractive.js in an older browser. You'll need to use one of the 'legacy builds' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.");return"undefined"!=typeof window&&window.Node&&!window.Node.prototype.contains&&window.HTMLElement&&window.HTMLElement.prototype.contains&&(window.Node.prototype.contains=window.HTMLElement.prototype.contains),t}(co,w,r);"undefined"!=typeof e&&e.exports?e.exports=fo:"function"==typeof define&&define.amd&&define(function(){return fo}),t.Ractive=fo,fo.noConflict=function(){return t.Ractive=n,fo}}("undefined"!=typeof window?window:this)},{}],18:[function(t,e){function n(){}function r(t){var e={}.toString.call(t);switch(e){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function i(){if(v.XMLHttpRequest&&("file:"!=v.location.protocol||!v.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}return!1}function o(t){return t===Object(t)}function s(t){if(!o(t))return t;var e=[];for(var n in t)null!=t[n]&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&")}function a(t){for(var e,n,r={},i=t.split("&"),o=0,s=i.length;s>o;++o)n=i[o],e=n.split("="),r[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return r}function u(t){var e,n,r,i,o=t.split(/\r?\n/),s={};o.pop();for(var a=0,u=o.length;u>a;++a)n=o[a],e=n.indexOf(":"),r=n.slice(0,e).toLowerCase(),i=m(n.slice(e+1)),s[r]=i;return s}function l(t){return t.split(/ *; */).shift()}function h(t){return g(t.split(/ *; */),function(t,e){var n=e.split(/ *= */),r=n.shift(),i=n.shift();return r&&i&&(t[r]=i),t},{})}function c(t,e){e=e||{},this.req=t,this.xhr=this.req.xhr,this.text=this.xhr.responseText,this.setStatusProperties(this.xhr.status),this.header=this.headers=u(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text):null}function f(t,e){var n=this;d.call(this),this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var e=new c(n);"HEAD"==t&&(e.text=null),n.callback(null,e)})}function p(t,e){return"function"==typeof e?new f("GET",t).end(e):1==arguments.length?new f("GET",t):new f(t,e)}var d=t("emitter"),g=t("reduce"),v="undefined"==typeof window?this:window,m="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};p.serializeObject=s,p.parseString=a,p.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},p.serialize={"application/x-www-form-urlencoded":s,"application/json":JSON.stringify},p.parse={"application/x-www-form-urlencoded":a,"application/json":JSON.parse},c.prototype.get=function(t){return this.header[t.toLowerCase()]},c.prototype.setHeaderProperties=function(){var t=this.header["content-type"]||"";this.type=l(t);var e=h(t);for(var n in e)this[n]=e[n]},c.prototype.parseBody=function(t){var e=p.parse[this.type];return e?e(t):null},c.prototype.setStatusProperties=function(t){var e=t/100|0;this.status=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.clientError=4==e,this.serverError=5==e,this.error=4==e||5==e?this.toError():!1,this.accepted=202==t,this.noContent=204==t||1223==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.notFound=404==t,this.forbidden=403==t},c.prototype.toError=function(){var t=this.req,e=t.method,n=t.url,r="cannot "+e+" "+n+" ("+this.status+")",i=new Error(r);return i.status=this.status,i.method=e,i.url=n,i},p.Response=c,d(f.prototype),f.prototype.use=function(t){return t(this),this},f.prototype.timeout=function(t){return this._timeout=t,this},f.prototype.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},f.prototype.abort=function(){return this.aborted?void 0:(this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this)},f.prototype.set=function(t,e){if(o(t)){for(var n in t)this.set(n,t[n]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},f.prototype.getHeader=function(t){return this._header[t.toLowerCase()]},f.prototype.type=function(t){return this.set("Content-Type",p.types[t]||t),this},f.prototype.accept=function(t){return this.set("Accept",p.types[t]||t),this},f.prototype.auth=function(t,e){var n=btoa(t+":"+e);return this.set("Authorization","Basic "+n),this},f.prototype.query=function(t){return"string"!=typeof t&&(t=s(t)),t&&this._query.push(t),this},f.prototype.field=function(t,e){return this._formData||(this._formData=new FormData),this._formData.append(t,e),this},f.prototype.attach=function(t,e,n){return this._formData||(this._formData=new FormData),this._formData.append(t,e,n),this},f.prototype.send=function(t){var e=o(t),n=this.getHeader("Content-Type");if(e&&o(this._data))for(var r in t)this._data[r]=t[r];else"string"==typeof t?(n||this.type("form"),n=this.getHeader("Content-Type"),this._data="application/x-www-form-urlencoded"==n?this._data?this._data+"&"+t:t:(this._data||"")+t):this._data=t;return e?(n||this.type("json"),this):this},f.prototype.callback=function(t,e){var n=this._callback;return 2==n.length?n(t,e):t?this.emit("error",t):void n(e)},f.prototype.crossDomainError=function(){var t=new Error("Origin is not allowed by Access-Control-Allow-Origin");t.crossDomain=!0,this.callback(t)},f.prototype.timeoutError=function(){var t=this._timeout,e=new Error("timeout of "+t+"ms exceeded");e.timeout=t,this.callback(e)},f.prototype.withCredentials=function(){return this._withCredentials=!0,this},f.prototype.end=function(t){var e=this,o=this.xhr=i(),s=this._query.join("&"),a=this._timeout,u=this._formData||this._data;if(this._callback=t||n,o.onreadystatechange=function(){return 4==o.readyState?0==o.status?e.aborted?e.timeoutError():e.crossDomainError():void e.emit("end"):void 0},o.upload&&(o.upload.onprogress=function(t){t.percent=t.loaded/t.total*100,e.emit("progress",t)}),a&&!this._timer&&(this._timer=setTimeout(function(){e.abort()},a)),s&&(s=p.serializeObject(s),this.url+=~this.url.indexOf("?")?"&"+s:"?"+s),o.open(this.method,this.url,!0),this._withCredentials&&(o.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof u&&!r(u)){var l=p.serialize[this.getHeader("Content-Type")];l&&(u=l(u))}for(var h in this.header)null!=this.header[h]&&o.setRequestHeader(h,this.header[h]);return this.emit("request",this),o.send(u),this},p.Request=f,p.get=function(t,e,n){var r=p("GET",t);return"function"==typeof e&&(n=e,e=null),e&&r.query(e),n&&r.end(n),r},p.head=function(t,e,n){var r=p("HEAD",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},p.del=function(t,e){var n=p("DELETE",t);return e&&n.end(e),n},p.patch=function(t,e,n){var r=p("PATCH",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},p.post=function(t,e,n){var r=p("POST",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},p.put=function(t,e,n){var r=p("PUT",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},e.exports=p},{emitter:19,reduce:20}],19:[function(t,e){function n(t){return t?r(t):void 0}function r(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},n.prototype.once=function(t,e){function n(){r.off(t,n),e.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},n.fn=e,this.on(t,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[t];if(!n)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===e||r.fn===e){n.splice(i,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks[t];if(n){n=n.slice(0);for(var r=0,i=n.length;i>r;++r)n[r].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],20:[function(t,e){e.exports=function(t,e,n){for(var r=0,i=t.length,o=3==arguments.length?n:t[r++];i>r;)o=e.call(null,o,t[r],++r,t);return o}},{}]},{},[4]);